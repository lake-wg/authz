<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>Lightweight Authorization using Ephemeral Diffie-Hellman Over COSE (ELA)</title>
<meta content="Göran Selander" name="author">
<meta content="John Preuß Mattsson" name="author">
<meta content="Mališa Vučinić" name="author">
<meta content="Geovane Fedrecheski" name="author">
<meta content="Michael Richardson" name="author">
<meta content="
       Ephemeral Diffie-Hellman Over COSE (EDHOC) is a lightweight authenticated key exchange protocol intended for use in constrained scenarios.
This document specifies Lightweight Authorization using EDHOC (ELA).
The procedure allows authorizing enrollment of new devices using the extension point defined in EDHOC.
ELA is applicable to zero-touch onboarding of new devices to a constrained network leveraging trust anchors installed at manufacture time. 
    " name="description">
<meta content="xml2rfc 3.29.0" name="generator">
<meta content="Internet-Draft" name="keyword">
<meta content="draft-ietf-lake-authz-latest" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.29.0
    Python 3.12.11
    ConfigArgParse 1.7
    google-i18n-address 3.1.1
    intervaltree 3.1.0
    Jinja2 3.1.6
    lxml 5.3.1
    platformdirs 4.3.8
    pycountry 24.6.1
    PyYAML 6.0.2
    requests 2.32.4
    setuptools 80.9.0
    wcwidth 0.2.13
-->
<link href="draft-ietf-lake-authz.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}

@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Lora SemiBold'), local('Lora-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C8A, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-cyrillic.woff2') format('woff2');
  unicode-range: U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-greek.woff2') format('woff2');
  unicode-range: U+0370-0377, U+037A-037F, U+0384-038A, U+038C, U+038E-03A1, U+03A3-03FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-02BA, U+02BD-02C5, U+02C7-02CC, U+02CE-02D7, U+02DD-02FF, U+0304, U+0308, U+0329, U+1D00-1DBF, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C8A, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-greek.woff2') format('woff2');
  unicode-range: U+0370-0377, U+037A-037F, U+0384-038A, U+038C, U+038E-03A1, U+03A3-03FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-02BA, U+02BD-02C5, U+02C7-02CC, U+02CE-02D7, U+02DD-02FF, U+0304, U+0308, U+0329, U+1D00-1DBF, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

:root {
  color-scheme: light dark;
  --background-color: #fff;
  --text-color: #222;
  --title-color: #191919;
  --link-color: #2a6496;
  --highlight-color: #f9f9f9;
  --line-color: #eee;
  --pilcrow-weak: #ddd;
  --pilcrow-strong: #bbb;
  --small-font-size: 14.5px;
  --font-mono: 'Oxygen Mono', monospace;
  --font-title: "Sofia Sans Semi Condensed", sans-serif;
  scrollbar-color: #bbb #eee;
}
body {
  max-width: 600px;
  margin: 75px auto;
  padding: 0 5px;
  color: var(--text-color);
  background-color: var(--background-color);
  font: 16px/22px "Lora", serif;
  scroll-behavior: smooth;
}

.ears {
  display: none;
}

/* headings */
section {
  clear: both;
}
.section-number {
  padding-right: 0.5em;
}
h1, h2, h3, h4, h5, h6 {
  font-family: var(--font-title);
  font-weight: 680;
  margin: 0.8em 0 0.3em;
  font-size-adjust: 0.5;
  color: var(--title-color);
}
h1#title {
  font-size: 32px;
  line-height: 40px;
  clear: both;
}
h1#title, h1#rfcnum {
  margin: 1.5em 0 0.2em;
}
h1#rfcnum + h1#title {
  margin: 0.2em 0;
}

h1, h2, h3 {
  font-size: 22px;
  line-height: 27px;
}
h4, h5, h6 {
  font-size: 20px;
  line-height: 24px;
}

/* general structure */
.author {
  padding-bottom: 0.3em;
  vertical-align: top;
}
#abstract+p {
  font-size: 18px;
  line-height: 24px;
}
#abstract+p code, #abstract+p samp, #abstract+p tt {
  font-size: 16px;
  line-height: 0;
}

p {
  padding: 0;
  margin: 0.5em 0;
  text-align: left;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignRight.art-text pre {
  padding: 0;
  width: auto;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
/* font-family isn't space-separated, but =~ will have to do */
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignCenter.art-text pre {
  padding: 0;
  width: auto;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 0.5em 2em;
  & :is(ol, ul) {
    margin-left: 1em;
  }
}
li {
  margin: 0 0 0.25em 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
  & li {
    margin-top: 0.5em;
  }
}
:is(ul, ol).compact, .ulCompact, .olCompact {
  margin: 0 0 0 2em;
  & li {
    margin: 0;
    & :first-child { margin-top: 0; }
    & :last-child { margin-bottom: 0; }
  }
}

/* definition lists */
dl {
  clear: left;
  --indent: 3ch;
  /* --indent: attr(indent ch); not supported in any browser, but we can dream */
  &.olPercent {
    --indent: 5ch;
    & > dt {
      min-width: calc(var(--indent) - 2ch);
    }
  }
  &.olPercent > dt {
    float: none;
  }

  dl > dd > & {
    margin-top: 0.5em;
    margin-bottom: 0;
  }
}
dl:not(.dlNewline) > dt {
  float: left;
  margin-right: 2ch;
  min-width: 8ch;
}
dl > dd {
  margin-bottom: .8em;
  margin-left: var(--indent) !important; /* stupid element overrides */
  min-height: 2ex;
}
:is(dl.compact, .dlCompact) > dd {
  margin-bottom: 0;
  & > :is(:first-child, .break:first-child + *) {
    margin-top: 0;
  }
  & > :is(:last-child) {
    margin-bottom: 0;
  }
}
:is(dd, span).break {
  display: none;
}

/* links */
a, a[href].selfRef:hover {
  text-decoration: none;
}
a[href] {
  color: var(--link-color);
}
a[href].selfRef, .iref + a[href].internal {
  color: var(--text-color);
}
a[href]:hover {
  text-decoration: underline;
}
a[href].selfRef:hover {
  background-color: var(--highlight-color);
}
a.xref:is(.cite, .auto), :is(#status-of-memo, #copyright) a {
  white-space: nowrap;
}

/* Figures */
tt, code, pre {
  background-color: var(--highlight-color);
  font: 14px/22px var(--font-mono);
}
tt, code {
  /* changing the font for inline elements leads to different ascender
     and descender heights; as we want to retain baseline alignment,
     remove leading to avoid altering the final height of lines
     note: this fails if these blocks take an entire line,
     a different solution would be great */
  line-height: 0;
}
:is(h1, h2, h3, h4, h5, h6) :is(tt, code) {
  font-size: 84%;
}
pre {
  border: 1px solid var(--line-color);
  font-size: 13.5px;
  line-height: 16px;
  letter-spacing: -0.2px;
  margin: 5px;
  padding: 5px;
}
img {
  max-width: 100%;
}
figure {
  margin: 0.5em 0;
  padding: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption, caption {
  font-style: italic;
  margin: 0.5em 1.5em;
  text-align: left;
  caption-side: bottom;
}
@media screen {
  /* Auto-collapse boilerplate. */
  :is(#status-of-memo, #copyright) p {
    margin: -2px 0;
    max-height: 0;
    transition: max-height 2s ease, margin 0.5s ease 0.5s;
    overflow: hidden;
  }
  :is(#status-of-memo, #copyright):hover p,
  :is(#status-of-memo, #copyright) h2:target ~ p {
    margin: 0.5em 0;
    max-height: 500px;
    overflow: auto;
  }
  pre, svg {
    display: inline-block;
    /* In the horizontal direction, sometimes people make over-sized figures.
       Scrollbars for those is therefore necessary: auto adds them as necessary..
       In the vertical direction, the line-height can combine with the font
       asender/descender height to produce scrollbars: hidden avoids that. */
    overflow: auto hidden;
  }
  pre {
    max-width: 100%;
    width: calc(100% - 22px - 1em);
  }
  svg {
    max-width: calc(100% - 22px - 1em);
  }
  figure pre {
    display: block;
    width: calc(100% - 25px);
  }
  :is(pre, svg) + .pilcrow {
    display: inline-block;
    vertical-align: text-bottom;
    padding-bottom: 8px;
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 0 2em;
  font-style: italic;
}
blockquote {
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: auto;
  max-width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
}
table.right {
  margin-left: auto;
}
table.center {
  margin-left: auto;
  margin-right: auto;
}
table.left {
  margin-right: auto;
}
table .text-left {
  text-align: left;
}
table .text-center {
  text-align: center;
}
table .text-right {
  text-align: right;
}

thead, tbody {
  border: 1px solid var(--line-color);
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 5px 10px;
}
th {
  background-color: var(--line-color);
}
:is(tr:nth-child(2n), thead+tbody > tr:nth-child(2n+1)) > td {
  background-color: var(--background-color);
}
:is(tr:nth-child(2n+1), thead+tbody > tr:nth-child(2n)) > td {
  background-color: var(--highlight-color);
}
table caption {
  margin: 0;
  padding: 3px 0 3px 1em;
}
table p {
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  margin-left: 3px;
  opacity: 0.2;
  user-select: none;
  &[href] {
    color: var(--pilcrow-weak);
    &:hover { text-decoration: none; }
  }
}
@media not print {
  :hover > a.pilcrow {
    opacity: 1;
  }
  a.pilcrow[href]:hover {
    color: var(--pilcrow-strong);
    background-color: transparent;
  }
}
@media print {
  a.pilcrow {
    display: none;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid var(--line-color);
}
.bcp14 {
  font-variant: small-caps;
  font-weight: 600;
  font-size: var(--small-font-size);
}
.role {
  font-variant: all-small-caps;
}
sub, sup {
  line-height: 1;
  font-size: 80%;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: var(--small-font-size);
  line-height: 18px;
  --identifier-width: 15ch;
  & dt {
    width: var(--identifier-width);
    min-width: var(--identifier-width);
    clear: left;
    float: left;
    text-align: right;
    margin-right: 1ch;
  }
  & dd {
    margin: 0;
    margin-left: calc(1em + var(--identifier-width)) !important;
    min-width: 5em;
  }
  & .authors {
    & .author {
      display: inline-block;
      margin-right: 1.5em;
    }
    & .org {
      font-style: italic;
    }
  }
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #999;
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;

  & nav {
    & ul {
      margin: 0 0.5em 0 0;
      padding: 0;
      list-style: none;
    }
    & li {
      line-height: 1.3em;
      margin: 2px 0;
      padding-left: 1.2em;
      text-indent: -1.2em;
    }
  }
  & a.xref {
    white-space: normal;
  }
}

.references {
  & > dt {
    text-align: right;
    font-weight: bold;
    min-width: 10ch;
    margin-right: 1.5ch;
    &:target::before {
      content: "⇒";
      margin: 0 10px 0 -25px;
    }
  }
  & > dd {
    margin-left: 12ch !important;
    overflow: visible;
    & .refInstance {
      margin-bottom: 0.8em;
    }
    & .ascii {
      margin-bottom: 0.25em;
    }
  }
}

#rfc\.index\.index + ul {
  margin-left: 0;
}

/* authors */
address.vcard {
  font-style: normal;
  max-width: 20em;
  margin: 1em auto 1em 0;

  & .nameRole {
    font-weight: 700;
    margin-left: 0;
  }
  & .label {
    margin: 0.5em 0;
  }
  & .type {
    display: none;
  }
  & .alternative-contact {
    margin: 0.5em 0 0.25em 0;
  }
  & .non-ascii {
    margin: 0 0 0 2em;
  }
  & div.left {
    text-align: left;
  }
  & div.right {
    text-align: right;
  }
}

hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}
@media (min-width: 500px) {
  #authors-addresses > section {
    column-count: 2;
    column-gap: 20px;
  }
  #authors-addresses > section > h2 {
    column-span: all;
  }
  /* hack for break-inside: avoid-column */
  #authors-addresses address {
    display: inline-block;
    break-inside: avoid-column;
  }
}

/* Comments */
.rfcEditorRemove p:first-of-type {
  font-style: italic;
}
.cref {
  background-color: rgba(249, 232, 105, 0.3);
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}

@media screen {
  #toc nav {
    font-family: var(--font-title);
    font-weight: 360;
    & > ul { margin-bottom: 2em; }
    & ul {
      margin: 0 0 0 4px;
      & :is(p, li) {
        margin: 2px 0;
      }
    }
  }
  #toc a.toplink {
    float: right;
  }
}
@media not screen {
  #toc a.toplink {
    display: none;
  }
}


/* TOC layout for smaller screens */
@media screen and (max-width: 929px) {
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 1px 0 0 0;
    margin: 0;
    border-bottom: 1px solid #ccc;
    opacity: 0.6;
  }
  #toc h2 {
    margin: 0;
    padding: 2px 0 2px 6px;
    padding-right: 1em;
    font-size: 18px;
    line-height: 24px;
    min-width: 190px;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
    &::before { /* css hamburger */
      float: right;
      position: relative;
      width: 1em;
      height: 1px;
      left: -164px;
      margin: 8px 0 0 0;
      background: white none repeat scroll 0 0;
      box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
      content: "";
    }
  }
  #toc nav {
    display: none;
    background-color: var(--background-color);
    padding: 0.5em 1em 1em;
    overflow: auto;
    overscroll-behavior: contain;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
  #toc.active {
    opacity: 1;
    & nav { display: block; }
  }
  /* Make the collapsed ToC header render white on gray also when it's a link */
  #toc h2 a,
  #toc h2 a:is(:link, :focus, :hover),
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
  #toc a.toplink {
    margin: 2px 0.5em 0;
  }
}

/* TOC layout for wide screens */
@media screen and (min-width: 930px) {
  body {
    padding-right: 360px;
    padding-right: calc(min(180px + 20%, 500px));
  }
  #toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 480px);
    width: 312px;
    margin: 0;
    padding: 0;
    z-index: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 2em;
    overflow: auto;
    overscroll-behavior: contain;
    scrollbar-width: thin;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
  #toc a.toplink {
    margin: 8px 0.5em 0;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre, .vcard {
    page-break-inside: avoid;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  :is(h2, h3, h4, h5, h6)+*, dd {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
}

/* Dark mode. */
@media (prefers-color-scheme: dark) {
:root {
  --background-color: #121212;
  --text-color: #f0f0f0;
  --title-color: #fff;
  --link-color: #4da4f0;
  --highlight-color: #282828;
  --line-color: #444;
  --pilcrow-weak: #444;
  --pilcrow-strong: #666;
  scrollbar-color: #777 #333;
}
}

/* SVG Trick: a prefix match works because only black and white are allowed */
svg :is([stroke="black"], [stroke^="#000"]) {
  stroke: var(--text-color);
}
svg :is([stroke="white"], [stroke^="#fff"]) {
  stroke: var(--background-color);
}
svg :is([fill="black"], [fill^="#000"], :not([fill])) {
  fill: var(--text-color);
}
svg :is([fill="white"], [fill^="#fff"]) {
  fill: var(--background-color);
}
</style>

</head>
<body class="xml2rfc">
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">ELA</td>
<td class="right">July 2025</td>
</tr></thead>
<tfoot><tr>
<td class="left">Selander, et al.</td>
<td class="center">Expires 8 January 2026</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">LAKE Working Group</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-ietf-lake-authz-latest</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2025-07-07" class="published">7 July 2025</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Standards Track</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2026-01-08">8 January 2026</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">G. Selander</div>
<div class="org">Ericsson AB</div>
</div>
<div class="author">
      <div class="author-name">J. Preuß Mattsson</div>
<div class="org">Ericsson AB</div>
</div>
<div class="author">
      <div class="author-name">M. Vučinić</div>
<div class="org">INRIA</div>
</div>
<div class="author">
      <div class="author-name">G. Fedrecheski</div>
<div class="org">INRIA</div>
</div>
<div class="author">
      <div class="author-name">M. Richardson</div>
<div class="org">Sandelman Software Works</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">Lightweight Authorization using Ephemeral Diffie-Hellman Over COSE (ELA)</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">Ephemeral Diffie-Hellman Over COSE (EDHOC) is a lightweight authenticated key exchange protocol intended for use in constrained scenarios.
This document specifies Lightweight Authorization using EDHOC (ELA).
The procedure allows authorizing enrollment of new devices using the extension point defined in EDHOC.
ELA is applicable to zero-touch onboarding of new devices to a constrained network leveraging trust anchors installed at manufacture time.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<section class="note rfcEditorRemove" id="section-note.1">
      <h2 id="name-about-this-document">
<a href="#name-about-this-document" class="section-name selfRef">About This Document</a>
      </h2>
<p id="section-note.1-1">This note is to be removed before publishing as an RFC.<a href="#section-note.1-1" class="pilcrow">¶</a></p>
<p id="section-note.1-2">
        The latest revision of this draft can be found at <span><a href="https://lake-wg.github.io/authz/draft-ietf-lake-authz.html">https://lake-wg.github.io/authz/draft-ietf-lake-authz.html</a></span>.
        Status information for this document may be found at <span><a href="https://datatracker.ietf.org/doc/draft-ietf-lake-authz/">https://datatracker.ietf.org/doc/draft-ietf-lake-authz/</a></span>.<a href="#section-note.1-2" class="pilcrow">¶</a></p>
<p id="section-note.1-3">
        Discussion of this document takes place on the
        Lightweight Authenticated Key Exchange Working Group mailing list (<span><a href="mailto:lake@ietf.org">mailto:lake@ietf.org</a></span>),
        which is archived at <span><a href="https://mailarchive.ietf.org/arch/browse/lake/">https://mailarchive.ietf.org/arch/browse/lake/</a></span>.
        Subscribe at <span><a href="https://www.ietf.org/mailman/listinfo/lake/">https://www.ietf.org/mailman/listinfo/lake/</a></span>.<a href="#section-note.1-3" class="pilcrow">¶</a></p>
<p id="section-note.1-4">Source for this draft and an issue tracker can be found at
        <span><a href="https://github.com/lake-wg/authz">https://github.com/lake-wg/authz</a></span>.<a href="#section-note.1-4" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 8 January 2026.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2025 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="auto internal xref">1</a>.  <a href="#name-introduction" class="internal xref">Introduction</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1" class="keepWithNext"><a href="#section-1.1" class="auto internal xref">1.1</a>.  <a href="#name-terminology" class="internal xref">Terminology</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1" class="keepWithNext"><a href="#section-2" class="auto internal xref">2</a>.  <a href="#name-protocol-outline" class="internal xref">Protocol Outline</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="auto internal xref">3</a>.  <a href="#name-assumptions" class="internal xref">Assumptions</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1"><a href="#section-3.1" class="auto internal xref">3.1</a>.  <a href="#name-device-u" class="internal xref">Device (U)</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a href="#section-3.2" class="auto internal xref">3.2</a>.  <a href="#name-domain-authenticator-v" class="internal xref">Domain Authenticator (V)</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.3">
                <p id="section-toc.1-1.3.2.3.1"><a href="#section-3.3" class="auto internal xref">3.3</a>.  <a href="#name-enrollment-server-w" class="internal xref">Enrollment Server (W)</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="auto internal xref">4</a>.  <a href="#name-the-protocol" class="internal xref">The Protocol</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="auto internal xref">4.1</a>.  <a href="#name-overview" class="internal xref">Overview</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="auto internal xref">4.2</a>.  <a href="#name-reuse-of-edhoc" class="internal xref">Reuse of EDHOC</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3">
                <p id="section-toc.1-1.4.2.3.1"><a href="#section-4.3" class="auto internal xref">4.3</a>.  <a href="#name-stateless-operation-of-v" class="internal xref">Stateless Operation of V</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.4">
                <p id="section-toc.1-1.4.2.4.1"><a href="#section-4.4" class="auto internal xref">4.4</a>.  <a href="#name-device-enrollment-server-u-" class="internal xref">Device &lt;-&gt; Enrollment Server (U &lt;-&gt; W)</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.5">
                <p id="section-toc.1-1.4.2.5.1"><a href="#section-4.5" class="auto internal xref">4.5</a>.  <a href="#name-device-authenticator-u-v" class="internal xref">Device &lt;-&gt; Authenticator (U &lt;-&gt; V)</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.6">
                <p id="section-toc.1-1.4.2.6.1"><a href="#section-4.6" class="auto internal xref">4.6</a>.  <a href="#name-authenticator-enrollment-se" class="internal xref">Authenticator &lt;-&gt; Enrollment Server (V &lt;-&gt; W)</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.7">
                <p id="section-toc.1-1.4.2.7.1"><a href="#section-4.7" class="auto internal xref">4.7</a>.  <a href="#name-error-handling" class="internal xref">Error Handling</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.8">
                <p id="section-toc.1-1.4.2.8.1"><a href="#section-4.8" class="auto internal xref">4.8</a>.  <a href="#name-reverse-flow-with-u-as-resp" class="internal xref">Reverse flow with U as Responder</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="auto internal xref">5</a>.  <a href="#name-rest-interface-at-w" class="internal xref">REST Interface at W</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="auto internal xref">5.1</a>.  <a href="#name-scheme-https" class="internal xref">Scheme "https"</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a href="#section-5.2" class="auto internal xref">5.2</a>.  <a href="#name-scheme-coaps" class="internal xref">Scheme "coaps"</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.3">
                <p id="section-toc.1-1.5.2.3.1"><a href="#section-5.3" class="auto internal xref">5.3</a>.  <a href="#name-scheme-coap" class="internal xref">Scheme "coap"</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.4">
                <p id="section-toc.1-1.5.2.4.1"><a href="#section-5.4" class="auto internal xref">5.4</a>.  <a href="#name-uris" class="internal xref">URIs</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="auto internal xref">6</a>.  <a href="#name-security-considerations" class="internal xref">Security Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="auto internal xref">7</a>.  <a href="#name-iana-considerations" class="internal xref">IANA Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1">
                <p id="section-toc.1-1.7.2.1.1"><a href="#section-7.1" class="auto internal xref">7.1</a>.  <a href="#name-edhoc-external-authorizatio" class="internal xref">EDHOC External Authorization Data Registry</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.2">
                <p id="section-toc.1-1.7.2.2.1"><a href="#section-7.2" class="auto internal xref">7.2</a>.  <a href="#name-the-well-known-uri-registry" class="internal xref">The Well-Known URI Registry</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.3">
                <p id="section-toc.1-1.7.2.3.1"><a href="#section-7.3" class="auto internal xref">7.3</a>.  <a href="#name-well-known-name-under-arpa-" class="internal xref">Well-Known Name Under ".arpa" Name Space</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.4">
                <p id="section-toc.1-1.7.2.4.1"><a href="#section-7.4" class="auto internal xref">7.4</a>.  <a href="#name-media-types-registry" class="internal xref">Media Types Registry</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.5">
                <p id="section-toc.1-1.7.2.5.1"><a href="#section-7.5" class="auto internal xref">7.5</a>.  <a href="#name-coap-content-formats-regist" class="internal xref">CoAP Content-Formats Registry</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="auto internal xref">8</a>.  <a href="#name-references" class="internal xref">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1">
                <p id="section-toc.1-1.8.2.1.1"><a href="#section-8.1" class="auto internal xref">8.1</a>.  <a href="#name-normative-references" class="internal xref">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.2">
                <p id="section-toc.1-1.8.2.2.1"><a href="#section-8.2" class="auto internal xref">8.2</a>.  <a href="#name-informative-references" class="internal xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#appendix-A" class="auto internal xref">Appendix A</a>.  <a href="#name-optimization-strategies" class="internal xref">Optimization Strategies</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.1">
                <p id="section-toc.1-1.9.2.1.1"><a href="#appendix-A.1" class="auto internal xref">A.1</a>.  <a href="#name-u-broadcasts-message_1" class="internal xref">U broadcasts message_1</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.2">
                <p id="section-toc.1-1.9.2.2.1"><a href="#appendix-A.2" class="auto internal xref">A.2</a>.  <a href="#name-v-advertises-support-for-el" class="internal xref">V advertises support for ELA</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#appendix-B" class="auto internal xref">Appendix B</a>.  <a href="#name-use-with-constrained-join-p" class="internal xref">Use with Constrained Join Protocol (CoJP)</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.1">
                <p id="section-toc.1-1.10.2.1.1"><a href="#appendix-B.1" class="auto internal xref">B.1</a>.  <a href="#name-network-discovery" class="internal xref">Network Discovery</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.2">
                <p id="section-toc.1-1.10.2.2.1"><a href="#appendix-B.2" class="auto internal xref">B.2</a>.  <a href="#name-the-enrollment-protocol-wit" class="internal xref">The Enrollment Protocol with Parameter Provisioning</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#appendix-C" class="auto internal xref">Appendix C</a>.  <a href="#name-example-of-opaque_state" class="internal xref">Example of opaque_state</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a href="#appendix-D" class="auto internal xref">Appendix D</a>.  <a href="#name-examples-of-protocol-execut" class="internal xref">Examples of protocol execution</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.1">
                <p id="section-toc.1-1.12.2.1.1"><a href="#appendix-D.1" class="auto internal xref">D.1</a>.  <a href="#name-minimal" class="internal xref">Minimal</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.2">
                <p id="section-toc.1-1.12.2.2.1"><a href="#appendix-D.2" class="auto internal xref">D.2</a>.  <a href="#name-wrong-gateway" class="internal xref">Wrong gateway</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13">
            <p id="section-toc.1-1.13.1"><a href="#appendix-E" class="auto internal xref"></a><a href="#name-acknowledgments" class="internal xref">Acknowledgments</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14">
            <p id="section-toc.1-1.14.1"><a href="#appendix-F" class="auto internal xref"></a><a href="#name-authors-addresses" class="internal xref">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="intro">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">For constrained IoT deployments <span>[<a href="#RFC7228" class="cite xref">RFC7228</a>]</span> the overhead and processing contributed by security protocols may be significant, which motivates the specification of lightweight protocols that are optimizing, in particular, message overhead (see <span>[<a href="#I-D.ietf-lake-reqs" class="cite xref">I-D.ietf-lake-reqs</a>]</span>).
This document describes Lightweight Authorization using EDHOC (ELA), a procedure for augmenting the lightweight authenticated Diffie-Hellman key exchange EDHOC <span>[<a href="#RFC9528" class="cite xref">RFC9528</a>]</span> with third party-assisted authorization.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">ELA involves a device, a domain authenticator, and an enrollment server.
The device and domain authenticator perform mutual authentication and authorization, assisted by the enrollment server that provides relevant authorization information to the device (a "voucher") and to the authenticator. The high-level model is similar to BRSKI <span>[<a href="#RFC8995" class="cite xref">RFC8995</a>]</span>.<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3">In this document, we consider the target interaction for which authorization is needed to be "enrollment", for example joining a network for the first time (e.g., <span>[<a href="#RFC9031" class="cite xref">RFC9031</a>]</span>), but it can be applied to authorize other target interactions.<a href="#section-1-3" class="pilcrow">¶</a></p>
<p id="section-1-4">The enrollment server may represent the manufacturer of the device, or some other party with information about the device from which a trust anchor has been pre-provisioned into the device.
The (domain) authenticator may represent the service provider or some other party controlling access to the network in which the device is enrolling.<a href="#section-1-4" class="pilcrow">¶</a></p>
<p id="section-1-5">ELA assumes that authentication between device and authenticator is performed with EDHOC <span>[<a href="#RFC9528" class="cite xref">RFC9528</a>]</span>, and defines the integration of a lightweight authorization procedure using the External Authorization Data (EAD) fields defined in EDHOC.<a href="#section-1-5" class="pilcrow">¶</a></p>
<p id="section-1-6">ELA enables a low message count by performing authorization and enrollment in parallel with authentication, instead of in sequence, which is common for network access.
It further reuses protocol elements from EDHOC, leading to reduced message sizes on constrained links.<a href="#section-1-6" class="pilcrow">¶</a></p>
<p id="section-1-7">This protocol is applicable to a wide variety of settings, and can be mapped to different authorization architectures.<a href="#section-1-7" class="pilcrow">¶</a></p>
<div id="terminology">
<section id="section-1.1">
        <h3 id="name-terminology">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-terminology" class="section-name selfRef">Terminology</a>
        </h3>
<p id="section-1.1-1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in BCP 14 <span>[<a href="#RFC2119" class="cite xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="cite xref">RFC8174</a>]</span> when, and only when, they appear in all capitals, as shown here.<a href="#section-1.1-1" class="pilcrow">¶</a></p>
<p id="section-1.1-2">Readers are expected to have an understanding of CBOR <span>[<a href="#RFC8949" class="cite xref">RFC8949</a>]</span>, CDDL <span>[<a href="#RFC8610" class="cite xref">RFC8610</a>]</span>, and EDHOC <span>[<a href="#RFC9528" class="cite xref">RFC9528</a>]</span>.
Appendix C.1 of <span>[<a href="#RFC9528" class="cite xref">RFC9528</a>]</span> contains some basic info about CBOR.<a href="#section-1.1-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="outline">
<section id="section-2">
      <h2 id="name-protocol-outline">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-protocol-outline" class="section-name selfRef">Protocol Outline</a>
      </h2>
<p id="section-2-1">The goal of ELA is to enable a (potentially constrained) device (U) to enroll into a domain over a constrained link.
The device authenticates and enforces authorization of the (non-constrained) domain authenticator (V) with the help of a voucher conveying authorization information.
The voucher has a similar role as in <span>[<a href="#RFC8366" class="cite xref">RFC8366</a>]</span> but should be considerably more compact.
The domain authenticator, in turn, authenticates the device and authorizes its enrollment into the domain.<a href="#section-2-1" class="pilcrow">¶</a></p>
<p id="section-2-2">The procedure is assisted by a (non-constrained) enrollment server (W) located in a non-constrained network behind the domain authenticator, e.g., on the Internet, providing information to the device (conveyed in the voucher) and to the domain authenticator as part of the protocol.<a href="#section-2-2" class="pilcrow">¶</a></p>
<p id="section-2-3">The objective of this document is to specify such a protocol that is lightweight over the constrained link, by reusing elements of EDHOC <span>[<a href="#RFC9528" class="cite xref">RFC9528</a>]</span> and by shifting message overhead to the non-constrained side of the network.
See illustration in <a href="#fig-overview" class="auto internal xref">Figure 1</a>.<a href="#section-2-3" class="pilcrow">¶</a></p>
<p id="section-2-4">Note the cardinality of the involved parties. It is expected that the domain authenticator needs to handle a large unspecified number of devices, but for a given device type or manufacturer it is expected that one or a few nodes host enrollment servers.<a href="#section-2-4" class="pilcrow">¶</a></p>
<span id="name-overview-of-the-message-flo"></span><div id="fig-overview">
<figure id="figure-1">
        <div id="section-2-5.1">
          <div class="alignCenter art-svg artwork" id="section-2-5.1.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="192" width="560" viewBox="0 0 560 192" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
              <path d="M 8,64 L 8,160" fill="none" stroke="black"></path>
              <path d="M 96,64 L 96,160" fill="none" stroke="black"></path>
              <path d="M 136,104 L 136,160" fill="none" stroke="black"></path>
              <path d="M 152,64 L 152,104" fill="none" stroke="black"></path>
              <path d="M 200,64 L 200,160" fill="none" stroke="black"></path>
              <path d="M 328,64 L 328,160" fill="none" stroke="black"></path>
              <path d="M 424,64 L 424,160" fill="none" stroke="black"></path>
              <path d="M 552,64 L 552,160" fill="none" stroke="black"></path>
              <path d="M 8,64 L 96,64" fill="none" stroke="black"></path>
              <path d="M 200,64 L 328,64" fill="none" stroke="black"></path>
              <path d="M 424,64 L 552,64" fill="none" stroke="black"></path>
              <path d="M 96,96 L 144,96" fill="none" stroke="black"></path>
              <path d="M 160,96 L 192,96" fill="none" stroke="black"></path>
              <path d="M 328,96 L 416,96" fill="none" stroke="black"></path>
              <path d="M 104,112 L 128,112" fill="none" stroke="black"></path>
              <path d="M 144,112 L 200,112" fill="none" stroke="black"></path>
              <path d="M 336,112 L 424,112" fill="none" stroke="black"></path>
              <path d="M 96,128 L 192,128" fill="none" stroke="black"></path>
              <path d="M 8,160 L 96,160" fill="none" stroke="black"></path>
              <path d="M 200,160 L 328,160" fill="none" stroke="black"></path>
              <path d="M 424,160 L 552,160" fill="none" stroke="black"></path>
              <polygon class="arrowhead" points="424,96 412,90.4 412,101.6" fill="black" transform="rotate(0,416,96)"></polygon>
              <polygon class="arrowhead" points="344,112 332,106.4 332,117.6" fill="black" transform="rotate(180,336,112)"></polygon>
              <polygon class="arrowhead" points="200,128 188,122.4 188,133.6" fill="black" transform="rotate(0,192,128)"></polygon>
              <polygon class="arrowhead" points="200,96 188,90.4 188,101.6" fill="black" transform="rotate(0,192,96)"></polygon>
              <polygon class="arrowhead" points="112,112 100,106.4 100,117.6" fill="black" transform="rotate(180,104,112)"></polygon>
              <circle cx="136" cy="112" r="6" class="opendot" fill="white" stroke="black"></circle>
              <circle cx="152" cy="96" r="6" class="opendot" fill="white" stroke="black"></circle>
              <g class="text">
                <text x="160" y="36">Voucher</text>
                <text x="148" y="52">Info</text>
                <text x="376" y="68">Voucher</text>
                <text x="376" y="84">Request</text>
                <text x="52" y="100">Device</text>
                <text x="260" y="100">Domain</text>
                <text x="492" y="100">Enrollment</text>
                <text x="264" y="116">Authenticator</text>
                <text x="492" y="116">Server</text>
                <text x="48" y="132">(U)</text>
                <text x="264" y="132">(V)</text>
                <text x="376" y="132">Voucher</text>
                <text x="488" y="132">(W)</text>
                <text x="380" y="148">Response</text>
                <text x="144" y="180">Voucher</text>
              </g>
            </svg><a href="#section-2-5.1.1" class="pilcrow">¶</a>
</div>
</div>
<figcaption><a href="#figure-1" class="selfRef">Figure 1</a>:
<a href="#name-overview-of-the-message-flo" class="selfRef">Overview of the message flow. EDHOC is used on the constrained link between U and V. Voucher Info and Voucher are sent in EDHOC External Authorization Data (EAD). The link between V and W is not constrained.</a>
        </figcaption></figure>
</div>
</section>
</div>
<div id="assumptions">
<section id="section-3">
      <h2 id="name-assumptions">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-assumptions" class="section-name selfRef">Assumptions</a>
      </h2>
<p id="section-3-1">The protocol is based on the following pre-existing relations between the device (U), the domain authenticator (V) and the enrollment server (W), see <a href="#fig-trust" class="auto internal xref">Figure 2</a>.<a href="#section-3-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3-2.1">
          <p id="section-3-2.1.1">U and W have an explicit relation: U is configured with a public key of W, see <a href="#device" class="auto internal xref">Section 3.1</a>.<a href="#section-3-2.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-3-2.2">
          <p id="section-3-2.2.1">V and W have an implicit relation, e.g., based on web PKI with trusted CA certificates, see <a href="#domain-auth" class="auto internal xref">Section 3.2</a>.<a href="#section-3-2.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-3-2.3">
          <p id="section-3-2.3.1">U and V need not have any previous relation. This protocol establishes a relation between U and V.<a href="#section-3-2.3.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-3-3">Each of the three parties can gain protected communication with the other two during the protocol.<a href="#section-3-3" class="pilcrow">¶</a></p>
<p id="section-3-4">V may be able to access credentials over non-constrained networks, but U may be limited to constrained networks. Implementations wishing to leverage the zero-touch capabilities of this protocol are expected to support transmission of credentials from V to U by value during the EDHOC exchange, which will impact the message size depending on the type of credential used.<a href="#section-3-4" class="pilcrow">¶</a></p>
<span id="name-overview-of-pre-existing-re"></span><div id="fig-trust">
<figure id="figure-2">
        <div id="section-3-5.1">
          <div class="alignCenter art-svg artwork" id="section-3-5.1.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="272" width="568" viewBox="0 0 568 272" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
              <path d="M 8,96 L 8,192" fill="none" stroke="black"></path>
              <path d="M 48,64 L 48,96" fill="none" stroke="black"></path>
              <path d="M 48,192 L 48,224" fill="none" stroke="black"></path>
              <path d="M 96,96 L 96,192" fill="none" stroke="black"></path>
              <path d="M 200,96 L 200,192" fill="none" stroke="black"></path>
              <path d="M 264,192 L 264,224" fill="none" stroke="black"></path>
              <path d="M 328,96 L 328,192" fill="none" stroke="black"></path>
              <path d="M 432,96 L 432,192" fill="none" stroke="black"></path>
              <path d="M 496,64 L 496,96" fill="none" stroke="black"></path>
              <path d="M 496,192 L 496,224" fill="none" stroke="black"></path>
              <path d="M 560,96 L 560,192" fill="none" stroke="black"></path>
              <path d="M 64,64 L 480,64" fill="none" stroke="black"></path>
              <path d="M 8,96 L 96,96" fill="none" stroke="black"></path>
              <path d="M 200,96 L 328,96" fill="none" stroke="black"></path>
              <path d="M 432,96 L 560,96" fill="none" stroke="black"></path>
              <path d="M 8,192 L 96,192" fill="none" stroke="black"></path>
              <path d="M 200,192 L 328,192" fill="none" stroke="black"></path>
              <path d="M 432,192 L 560,192" fill="none" stroke="black"></path>
              <path d="M 64,224 L 248,224" fill="none" stroke="black"></path>
              <path d="M 280,224 L 480,224" fill="none" stroke="black"></path>
              <polygon class="arrowhead" points="488,224 476,218.4 476,229.6" fill="black" transform="rotate(0,480,224)"></polygon>
              <polygon class="arrowhead" points="488,64 476,58.4 476,69.6" fill="black" transform="rotate(0,480,64)"></polygon>
              <polygon class="arrowhead" points="288,224 276,218.4 276,229.6" fill="black" transform="rotate(180,280,224)"></polygon>
              <polygon class="arrowhead" points="256,224 244,218.4 244,229.6" fill="black" transform="rotate(0,248,224)"></polygon>
              <polygon class="arrowhead" points="72,224 60,218.4 60,229.6" fill="black" transform="rotate(180,64,224)"></polygon>
              <polygon class="arrowhead" points="72,64 60,58.4 60,69.6" fill="black" transform="rotate(180,64,64)"></polygon>
              <g class="text">
                <text x="108" y="52">Explicit</text>
                <text x="180" y="52">relation</text>
                <text x="244" y="52">(e.g.,</text>
                <text x="292" y="52">from</text>
                <text x="340" y="52">device</text>
                <text x="420" y="52">manufacture)</text>
                <text x="52" y="132">Device</text>
                <text x="148" y="132">con-</text>
                <text x="260" y="132">Domain</text>
                <text x="360" y="132">not</text>
                <text x="396" y="132">con-</text>
                <text x="500" y="132">Enrollment</text>
                <text x="148" y="148">strained</text>
                <text x="264" y="148">Authenticator</text>
                <text x="380" y="148">strained</text>
                <text x="500" y="148">Server</text>
                <text x="48" y="164">(U)</text>
                <text x="144" y="164">network</text>
                <text x="264" y="164">(V)</text>
                <text x="376" y="164">network</text>
                <text x="496" y="164">(W)</text>
                <text x="92" y="244">No</text>
                <text x="140" y="244">previous</text>
                <text x="212" y="244">relation</text>
                <text x="340" y="244">Implicit</text>
                <text x="412" y="244">relation</text>
                <text x="316" y="260">(e.g.,</text>
                <text x="360" y="260">web</text>
                <text x="392" y="260">PKI</text>
                <text x="436" y="260">based)</text>
              </g>
            </svg><a href="#section-3-5.1.1" class="pilcrow">¶</a>
</div>
</div>
<figcaption><a href="#figure-2" class="selfRef">Figure 2</a>:
<a href="#name-overview-of-pre-existing-re" class="selfRef">Overview of pre-existing relations.</a>
        </figcaption></figure>
</div>
<div id="device">
<section id="section-3.1">
        <h3 id="name-device-u">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-device-u" class="section-name selfRef">Device (U)</a>
        </h3>
<p id="section-3.1-1">To authenticate to V, the device (U) runs EDHOC in the role of Initiator with authentication credential CRED_U, for example, an X.509 certificate <span>[<a href="#RFC5280" class="cite xref">RFC5280</a>]</span> or a CBOR Web Token (CWT, <span>[<a href="#RFC8392" class="cite xref">RFC8392</a>]</span>). CRED_U may, for example, be carried by value in ID_CRED_I of EDHOC message_3 or be provisioned to V over a non-constrained network, leveraging a credential identifier in ID_CRED_I (see bottom of <a href="#fig-protocol" class="auto internal xref">Figure 3</a>).<a href="#section-3.1-1" class="pilcrow">¶</a></p>
<p id="section-3.1-2">U also needs to identify itself to W. The device identifier used for this is ID_U. The purpose of ID_U is for W to be able to determine if the device with this identifier is authorized to enroll with V. ID_U may be a reference to CRED_U, like ID_CRED_I in EDHOC (see <span><a href="https://rfc-editor.org/rfc/rfc9528#section-3.5.2" class="relref">Section 3.5.2</a> of [<a href="#RFC9528" class="cite xref">RFC9528</a>]</span>), or a device identifier from a different name space, such as EUI-64 identifiers.<a href="#section-3.1-2" class="pilcrow">¶</a></p>
<p id="section-3.1-3">U is also provisioned with information about W:<a href="#section-3.1-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.1-4.1">
            <p id="section-3.1-4.1.1">A static public DH key of W (G_W) used to establish secure communication with the enrollment server (see <a href="#U-W" class="auto internal xref">Section 4.4</a>).<a href="#section-3.1-4.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-3.1-4.2">
            <p id="section-3.1-4.2.1">Location information about the enrollment server (LOC_W) that can be used by V to reach W. This is typically a URI but may alternatively be only the domain name.<a href="#section-3.1-4.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="domain-auth">
<section id="section-3.2">
        <h3 id="name-domain-authenticator-v">
<a href="#section-3.2" class="section-number selfRef">3.2. </a><a href="#name-domain-authenticator-v" class="section-name selfRef">Domain Authenticator (V)</a>
        </h3>
<p id="section-3.2-1">To authenticate to U, the domain authenticator (V) runs EDHOC in the role of Responder with an authentication credential CRED_V containing a public key of V, see <a href="#V_2" class="auto internal xref">Section 4.5.2.1</a>. This proves to U the possession of the private key corresponding to the public key of CRED_V. CRED_V typically needs to be transported to U in EDHOC (using  ID_CRED_R = CRED_V, see <span><a href="https://rfc-editor.org/rfc/rfc9528#section-3.5.2" class="relref">Section 3.5.2</a> of [<a href="#RFC9528" class="cite xref">RFC9528</a>]</span>) since there is no previous relation between U and V.<a href="#section-3.2-1" class="pilcrow">¶</a></p>
<p id="section-3.2-2">V and W need to establish a secure (confidentiality and integrity protected) connection for the Voucher Request/Response protocol.
Furthermore, W needs to access the same credential CRED_V that V uses with U (to compute the Voucher), and V needs to prove to W the possession of the private key corresponding to the public key of CRED_V.
It is RECOMMENDED that V authenticates to W using the same credential CRED_V as with U.<a href="#section-3.2-2" class="pilcrow">¶</a></p>
<p id="section-3.2-3">Note that the choice of protocols may affect which type of credential and methods should be used by V.
For example, in case V and W select TLS for the secure channel and PoP, then CRED_V is a X.509 certificate, and the EDHOC method used by V is signature-based.
Some of the possible combinations of protocols to secure the connection between V and W are listed in <a href="#creds-table" class="auto internal xref">Table 1</a> below.<a href="#section-3.2-3" class="pilcrow">¶</a></p>
<span id="name-examples-of-how-to-secure-t"></span><div id="creds-table">
<table class="center" id="table-1">
          <caption>
<a href="#table-1" class="selfRef">Table 1</a>:
<a href="#name-examples-of-how-to-secure-t" class="selfRef">Examples of how to secure the connection between V and W.</a>
          </caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">Secure channel between V and W</th>
              <th class="text-left" rowspan="1" colspan="1">Proof-of-Possession from V to W</th>
              <th class="text-left" rowspan="1" colspan="1">Type of CRED_V</th>
              <th class="text-left" rowspan="1" colspan="1">EDHOC method used by V</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">[D]TLS 1.3 with mutual authentication, where V is the client and W is the server.</td>
              <td class="text-left" rowspan="1" colspan="1">Provided by [D]TLS.</td>
              <td class="text-left" rowspan="1" colspan="1">Restricted to types that are supported by both [D]TLS and EDHOC, e.g., X.509 certificates.</td>
              <td class="text-left" rowspan="1" colspan="1">V MUST authenticate using a signature.</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">[D]TLS 1.3, where V is the client and W is the server.</td>
              <td class="text-left" rowspan="1" colspan="1">Run an EDHOC session on top of the TLS-protected channel.</td>
              <td class="text-left" rowspan="1" colspan="1">Any type supported by EDHOC, e.g., X.509, C509, CWT, or CCS.</td>
              <td class="text-left" rowspan="1" colspan="1">Any method may be used.</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">EDHOC and OSCORE, where V is the initiator and W is the responder.</td>
              <td class="text-left" rowspan="1" colspan="1">Already provided by EDHOC during the setup of the secure channel.</td>
              <td class="text-left" rowspan="1" colspan="1">Any type supported by EDHOC.</td>
              <td class="text-left" rowspan="1" colspan="1">Any method may be used.</td>
            </tr>
          </tbody>
        </table>
</div>
<p id="section-3.2-5">Note also that the secure connection between V and W may be long-lived and reused for multiple voucher requests/responses.<a href="#section-3.2-5" class="pilcrow">¶</a></p>
<p id="section-3.2-6">Other details of proof-of-possession related to CRED_V and transport of CRED_V are out of scope of this document.<a href="#section-3.2-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="authz-server">
<section id="section-3.3">
        <h3 id="name-enrollment-server-w">
<a href="#section-3.3" class="section-number selfRef">3.3. </a><a href="#name-enrollment-server-w" class="section-name selfRef">Enrollment Server (W)</a>
        </h3>
<p id="section-3.3-1">The enrollment server (W) is assumed to have the private DH key corresponding to G_W, which is used to establish secure communication with the device (see <a href="#U-W" class="auto internal xref">Section 4.4</a>). W provides to U the authorization decision for enrollment with V in the form of a voucher (see <a href="#voucher" class="auto internal xref">Section 4.4.2</a>). Authorization policies are out of scope for this document.<a href="#section-3.3-1" class="pilcrow">¶</a></p>
<p id="section-3.3-2">Authentication credentials and communication security with V is described in <a href="#domain-auth" class="auto internal xref">Section 3.2</a>. To calculate the voucher, W needs access to message_1 and CRED_V as used in the EDHOC session between U and V, see <a href="#voucher" class="auto internal xref">Section 4.4.2</a>.<a href="#section-3.3-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.3-3.1">
            <p id="section-3.3-3.1.1">W MUST verify that CRED_V is bound to the secure connection between W and V<a href="#section-3.3-3.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-3.3-3.2">
            <p id="section-3.3-3.2.1">W MUST verify that V is in possession of the private key corresponding to the public key of CRED_V<a href="#section-3.3-3.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-3.3-4">W needs to be available during the execution of the protocol between U and V.<a href="#section-3.3-4" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="protocol">
<section id="section-4">
      <h2 id="name-the-protocol">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-the-protocol" class="section-name selfRef">The Protocol</a>
      </h2>
<div id="protocol-overview">
<section id="section-4.1">
        <h3 id="name-overview">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-overview" class="section-name selfRef">Overview</a>
        </h3>
<p id="section-4.1-1">The ELA protocol consist of three security sessions going on in parallel:<a href="#section-4.1-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-4.1-2">
<li id="section-4.1-2.1">
            <p id="section-4.1-2.1.1">The EDHOC session between device (U) and (domain) authenticator (V)<a href="#section-4.1-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-4.1-2.2">
            <p id="section-4.1-2.2.1">Voucher Request/Response between authenticator (V) and enrollment server (W)<a href="#section-4.1-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-4.1-2.3">
            <p id="section-4.1-2.3.1">An exchange of voucher-related information, including the voucher itself, between device (U) and enrollment server (W), mediated by the authenticator (V).<a href="#section-4.1-2.3.1" class="pilcrow">¶</a></p>
</li>
        </ol>
<p id="section-4.1-3"><a href="#fig-protocol" class="auto internal xref">Figure 3</a> provides an overview of the message flow detailed in this section. An outline of EDHOC is given in <span><a href="https://rfc-editor.org/rfc/rfc9528#section-2" class="relref">Section 2</a> of [<a href="#RFC9528" class="cite xref">RFC9528</a>]</span>.<a href="#section-4.1-3" class="pilcrow">¶</a></p>
<span id="name-overview-of-ela-w-assisted-"></span><div id="fig-protocol">
<figure id="figure-3">
          <div id="section-4.1-4.1">
            <div class="alignCenter art-svg artwork" id="section-4.1-4.1.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="864" width="584" viewBox="0 0 584 864" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
                <path d="M 8,48 L 8,224" fill="none" stroke="black"></path>
                <path d="M 8,304 L 8,624" fill="none" stroke="black"></path>
                <path d="M 8,688 L 8,848" fill="none" stroke="black"></path>
                <path d="M 256,48 L 256,224" fill="none" stroke="black"></path>
                <path d="M 256,304 L 256,624" fill="none" stroke="black"></path>
                <path d="M 256,688 L 256,848" fill="none" stroke="black"></path>
                <path d="M 576,48 L 576,224" fill="none" stroke="black"></path>
                <path d="M 576,304 L 576,624" fill="none" stroke="black"></path>
                <path d="M 576,736 L 576,848" fill="none" stroke="black"></path>
                <path d="M 264,96 L 288,96" fill="none" stroke="black"></path>
                <path d="M 312,96 L 328,96" fill="none" stroke="black"></path>
                <path d="M 352,96 L 368,96" fill="none" stroke="black"></path>
                <path d="M 392,96 L 408,96" fill="none" stroke="black"></path>
                <path d="M 432,96 L 448,96" fill="none" stroke="black"></path>
                <path d="M 472,96 L 488,96" fill="none" stroke="black"></path>
                <path d="M 512,96 L 528,96" fill="none" stroke="black"></path>
                <path d="M 552,96 L 568,96" fill="none" stroke="black"></path>
                <path d="M 264,160 L 288,160" fill="none" stroke="black"></path>
                <path d="M 312,160 L 328,160" fill="none" stroke="black"></path>
                <path d="M 352,160 L 368,160" fill="none" stroke="black"></path>
                <path d="M 392,160 L 408,160" fill="none" stroke="black"></path>
                <path d="M 432,160 L 448,160" fill="none" stroke="black"></path>
                <path d="M 472,160 L 488,160" fill="none" stroke="black"></path>
                <path d="M 512,160 L 528,160" fill="none" stroke="black"></path>
                <path d="M 552,160 L 568,160" fill="none" stroke="black"></path>
                <path d="M 8,256 L 576,256" fill="none" stroke="black"></path>
                <path d="M 8,336 L 248,336" fill="none" stroke="black"></path>
                <path d="M 256,400 L 568,400" fill="none" stroke="black"></path>
                <path d="M 264,464 L 576,464" fill="none" stroke="black"></path>
                <path d="M 16,528 L 256,528" fill="none" stroke="black"></path>
                <path d="M 8,608 L 248,608" fill="none" stroke="black"></path>
                <path d="M 8,656 L 576,656" fill="none" stroke="black"></path>
                <path d="M 256,768 L 280,768" fill="none" stroke="black"></path>
                <path d="M 304,768 L 320,768" fill="none" stroke="black"></path>
                <path d="M 344,768 L 360,768" fill="none" stroke="black"></path>
                <path d="M 384,768 L 400,768" fill="none" stroke="black"></path>
                <path d="M 432,768 L 448,768" fill="none" stroke="black"></path>
                <path d="M 472,768 L 488,768" fill="none" stroke="black"></path>
                <path d="M 512,768 L 528,768" fill="none" stroke="black"></path>
                <path d="M 552,768 L 568,768" fill="none" stroke="black"></path>
                <path d="M 264,816 L 280,816" fill="none" stroke="black"></path>
                <path d="M 304,816 L 320,816" fill="none" stroke="black"></path>
                <path d="M 344,816 L 360,816" fill="none" stroke="black"></path>
                <path d="M 384,816 L 400,816" fill="none" stroke="black"></path>
                <path d="M 424,816 L 440,816" fill="none" stroke="black"></path>
                <path d="M 472,816 L 488,816" fill="none" stroke="black"></path>
                <path d="M 512,816 L 528,816" fill="none" stroke="black"></path>
                <path d="M 552,816 L 576,816" fill="none" stroke="black"></path>
                <polygon class="arrowhead" points="576,768 564,762.4 564,773.6" fill="black" transform="rotate(0,568,768)"></polygon>
                <polygon class="arrowhead" points="576,400 564,394.4 564,405.6" fill="black" transform="rotate(0,568,400)"></polygon>
                <polygon class="arrowhead" points="576,160 564,154.4 564,165.6" fill="black" transform="rotate(0,568,160)"></polygon>
                <polygon class="arrowhead" points="576,96 564,90.4 564,101.6" fill="black" transform="rotate(0,568,96)"></polygon>
                <polygon class="arrowhead" points="272,816 260,810.4 260,821.6" fill="black" transform="rotate(180,264,816)"></polygon>
                <polygon class="arrowhead" points="272,464 260,458.4 260,469.6" fill="black" transform="rotate(180,264,464)"></polygon>
                <polygon class="arrowhead" points="272,160 260,154.4 260,165.6" fill="black" transform="rotate(180,264,160)"></polygon>
                <polygon class="arrowhead" points="272,96 260,90.4 260,101.6" fill="black" transform="rotate(180,264,96)"></polygon>
                <polygon class="arrowhead" points="256,608 244,602.4 244,613.6" fill="black" transform="rotate(0,248,608)"></polygon>
                <polygon class="arrowhead" points="256,336 244,330.4 244,341.6" fill="black" transform="rotate(0,248,336)"></polygon>
                <polygon class="arrowhead" points="24,528 12,522.4 12,533.6" fill="black" transform="rotate(180,16,528)"></polygon>
                <g class="text">
                  <text x="8" y="36">U</text>
                  <text x="256" y="36">V</text>
                  <text x="576" y="36">W</text>
                  <text x="360" y="84">Establish</text>
                  <text x="428" y="84">secure</text>
                  <text x="488" y="84">channel</text>
                  <text x="332" y="116">(e.g.,</text>
                  <text x="376" y="116">TLS</text>
                  <text x="412" y="116">with</text>
                  <text x="460" y="116">server</text>
                  <text x="516" y="116">cert.)</text>
                  <text x="360" y="148">Proof-of-possession</text>
                  <text x="468" y="148">w.r.t.</text>
                  <text x="524" y="148">CRED_V</text>
                  <text x="380" y="180">(e.g.,</text>
                  <text x="436" y="180">EDHOC)</text>
                  <text x="228" y="276">CORE</text>
                  <text x="284" y="276">PROTOCOL</text>
                  <text x="104" y="324">EDHOC</text>
                  <text x="168" y="324">message_1</text>
                  <text x="52" y="356">(EAD_1</text>
                  <text x="88" y="356">=</text>
                  <text x="124" y="356">LOC_W,</text>
                  <text x="200" y="356">ENC_U_INFO)</text>
                  <text x="352" y="388">Voucher</text>
                  <text x="416" y="388">Request</text>
                  <text x="476" y="388">(VREQ)</text>
                  <text x="360" y="420">(message_1,</text>
                  <text x="468" y="420">?opaque_state)</text>
                  <text x="352" y="452">Voucher</text>
                  <text x="420" y="452">Response</text>
                  <text x="484" y="452">(VRES)</text>
                  <text x="320" y="484">(message_1,</text>
                  <text x="404" y="484">Voucher,</text>
                  <text x="500" y="484">?opaque_state)</text>
                  <text x="104" y="516">EDHOC</text>
                  <text x="168" y="516">message_2</text>
                  <text x="100" y="548">(EAD_2</text>
                  <text x="136" y="548">=</text>
                  <text x="180" y="548">Voucher)</text>
                  <text x="104" y="596">EDHOC</text>
                  <text x="168" y="596">message_3</text>
                  <text x="540" y="708">Credential</text>
                  <text x="548" y="724">Database</text>
                  <text x="352" y="756">ID_CRED_I</text>
                  <text x="412" y="756">from</text>
                  <text x="472" y="756">message_3</text>
                  <text x="420" y="804">CRED_U</text>
                </g>
              </svg><a href="#section-4.1-4.1.1" class="pilcrow">¶</a>
</div>
</div>
<figcaption><a href="#figure-3" class="selfRef">Figure 3</a>:
<a href="#name-overview-of-ela-w-assisted-" class="selfRef">Overview of ELA: W-assisted authorization of U and V to each other: EDHOC between U and V, and Voucher Request/Response between V and W. Before the protocol, V and W are assumed to have established a secure channel and performed proof-of-possession of relevant keys. Credential lookup of CRED_U may involve W or other credential database.</a>
          </figcaption></figure>
</div>
</section>
</div>
<div id="reuse">
<section id="section-4.2">
        <h3 id="name-reuse-of-edhoc">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-reuse-of-edhoc" class="section-name selfRef">Reuse of EDHOC</a>
        </h3>
<p id="section-4.2-1">The ELA protocol illustrated in <a href="#fig-protocol" class="auto internal xref">Figure 3</a> reuses several components of EDHOC:<a href="#section-4.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2-2.1">
            <p id="section-4.2-2.1.1">G_X, the ephemeral public Diffie-Hellman key of U, is also used in the protocol between U and W.
In case U acts as Responder (see <a href="#reverse-u-responder" class="auto internal xref">Section 4.8</a>), G_Y is used instead.<a href="#section-4.2-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.2-2.2">
            <p id="section-4.2-2.2.1">SUITES_I includes the cipher suite for EDHOC selected by U, and also defines the algorithms used between U and W (see <span><a href="https://rfc-editor.org/rfc/rfc9528#section-3.6" class="relref">Section 3.6</a> of [<a href="#RFC9528" class="cite xref">RFC9528</a>]</span>):<a href="#section-4.2-2.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2-2.2.2.1">
                <p id="section-4.2-2.2.2.1.1">EDHOC AEAD algorithm: used to encrypt ID_U and to generate voucher<a href="#section-4.2-2.2.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-4.2-2.2.2.2">
                <p id="section-4.2-2.2.2.2.1">EDHOC hash algorithm: used for key derivation<a href="#section-4.2-2.2.2.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-4.2-2.2.2.3">
                <p id="section-4.2-2.2.2.3.1">EDHOC key exchange algorithm: used to calculate the shared secret between U and W<a href="#section-4.2-2.2.2.3.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="normal" id="section-4.2-2.3">
            <p id="section-4.2-2.3.1">EAD_1, EAD_2 are the External Authorization Data message fields of message_1 and message_2, respectively, see <span><a href="https://rfc-editor.org/rfc/rfc9528#section-3.8" class="relref">Section 3.8</a> of [<a href="#RFC9528" class="cite xref">RFC9528</a>]</span>.
In case U acts as Responder (see <a href="#reverse-u-responder" class="auto internal xref">Section 4.8</a>), EAD_2 and EAD_3 are used in message_2 and message_3, respectively.
This document specifies two new EAD items, with ead_label = TBD1 and TBD2, see <a href="#iana-ead" class="auto internal xref">Section 7.1</a>.<a href="#section-4.2-2.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.2-2.4">
            <p id="section-4.2-2.4.1">ID_CRED_I and ID_CRED_R are used to identify the authentication credentials CRED_U and CRED_V, respectively. As shown at the bottom of <a href="#fig-protocol" class="auto internal xref">Figure 3</a>, V may use W to obtain CRED_U.
By default, CRED_V is transported in ID_CRED_R in message_2, see <a href="#V_2" class="auto internal xref">Section 4.5.2.1</a>.
In case U is Responder, CRED_V is transported in ID_CRED_I in message_3.<a href="#section-4.2-2.4.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-4.2-3">The protocol also reuses the EDHOC_Extract and EDHOC_Expand key derivation from EDHOC (see <span><a href="https://rfc-editor.org/rfc/rfc9528#section-4" class="relref">Section 4</a> of [<a href="#RFC9528" class="cite xref">RFC9528</a>]</span>).<a href="#section-4.2-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2-4.1">
            <p id="section-4.2-4.1.1">The intermediate pseudo-random key PRK is derived using EDHOC_Extract():<a href="#section-4.2-4.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2-4.1.2.1">
                <p id="section-4.2-4.1.2.1.1">PRK = EDHOC_Extract(salt, IKM)<a href="#section-4.2-4.1.2.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2-4.1.2.1.2.1">
                    <p id="section-4.2-4.1.2.1.2.1.1">where salt = 0x (the zero-length byte string)<a href="#section-4.2-4.1.2.1.2.1.1" class="pilcrow">¶</a></p>
</li>
                  <li class="normal" id="section-4.2-4.1.2.1.2.2">
                    <p id="section-4.2-4.1.2.1.2.2.1">IKM is computed as an ECDH cofactor Diffie-Hellman shared secret from the public key of W, G_W, and the private key corresponding to G_X (or v.v.), see Section 5.7.1.2 of <span>[<a href="#NIST-800-56A" class="cite xref">NIST-800-56A</a>]</span>.<a href="#section-4.2-4.1.2.1.2.2.1" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
        </ul>
<p id="section-4.2-5">The output keying material OKM is derived from PRK using EDHOC_Expand(), which is defined in terms of the EDHOC hash algorithm of the selected cipher suite SS, see <span><a href="https://rfc-editor.org/rfc/rfc9528#section-4.1.2" class="relref">Section 4.1.2</a> of [<a href="#RFC9528" class="cite xref">RFC9528</a>]</span>:<a href="#section-4.2-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2-6.1">
            <p id="section-4.2-6.1.1">OKM = EDHOC_Expand(PRK, info, length)<a href="#section-4.2-6.1.1" class="pilcrow">¶</a></p>
<p id="section-4.2-6.1.2">
where<a href="#section-4.2-6.1.2" class="pilcrow">¶</a></p>
</li>
        </ul>
<div class="lang-cddl sourcecode" id="section-4.2-7">
<pre>
info = (
   info_label : int,
   context : bstr,
   length : uint,
)
</pre><a href="#section-4.2-7" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="stateless-v">
<section id="section-4.3">
        <h3 id="name-stateless-operation-of-v">
<a href="#section-4.3" class="section-number selfRef">4.3. </a><a href="#name-stateless-operation-of-v" class="section-name selfRef">Stateless Operation of V</a>
        </h3>
<p id="section-4.3-1">V may act statelessly with respect to U: the state of the EDHOC session started by U may be dropped at V until authorization from W is received.
Once V has received EDHOC message_1 from U and extracted LOC_W from EAD_1, message_1 is forwarded unmodified to W in the form of a Voucher Request (see <a href="#voucher_request" class="auto internal xref">Section 4.6.1</a>).
V encapsulates the internal state that it needs to later respond to U, and sends that to W together with EDHOC message_1.
This state typically contains addressing information of U (e.g., U's IP address and port number), together with any other implementation-specific parameter needed by V to respond to U.
At this point, V can drop the EDHOC session that was initiated by U.<a href="#section-4.3-1" class="pilcrow">¶</a></p>
<p id="section-4.3-2">The encapsulated state MUST be protected using a uniformly-distributed (pseudo-)random key, known only to itself and specific for the current EDHOC session to prevent replay attacks of old encapsulated state.<a href="#section-4.3-2" class="pilcrow">¶</a></p>
<p id="section-4.3-3">How V serializes and encrypts its internal state is out of scope in this specification.
For example, V may use CBOR and COSE.<a href="#section-4.3-3" class="pilcrow">¶</a></p>
<p id="section-4.3-4">W sends to V the voucher together with the echoed message_1, as received from U, and V's internal state, see <a href="#voucher_response" class="auto internal xref">Section 4.6.2</a>.
This allows V to act as a simple message relay until it has obtained the authorization from W to enroll U.
The reception of a successful Voucher Response at V from W implies the authorization for V to enroll U.
At this point, V can initialize a new EDHOC session with U, based on the message and the state retrieved from the Voucher Response from W.<a href="#section-4.3-4" class="pilcrow">¶</a></p>
<p id="section-4.3-5">Noet that while stateless operation is supported in the default flow, it is not supported in the reverse flow (see <a href="#reverse-u-responder" class="auto internal xref">Section 4.8</a>).<a href="#section-4.3-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="U-W">
<section id="section-4.4">
        <h3 id="name-device-enrollment-server-u-">
<a href="#section-4.4" class="section-number selfRef">4.4. </a><a href="#name-device-enrollment-server-u-" class="section-name selfRef">Device &lt;-&gt; Enrollment Server (U &lt;-&gt; W)</a>
        </h3>
<p id="section-4.4-1">The protocol between U and W is carried between U and V in message_1 and message_2 (<a href="#U-V" class="auto internal xref">Section 4.5</a>), and between V and W in the Voucher Request/Response (<a href="#V-W" class="auto internal xref">Section 4.6</a>). The data is protected between the endpoints using secret keys derived from a Diffie-Hellman shared secret (see <a href="#reuse" class="auto internal xref">Section 4.2</a>) as further detailed in this section.<a href="#section-4.4-1" class="pilcrow">¶</a></p>
<div id="voucher_info">
<section id="section-4.4.1">
          <h4 id="name-voucher-info">
<a href="#section-4.4.1" class="section-number selfRef">4.4.1. </a><a href="#name-voucher-info" class="section-name selfRef">Voucher Info</a>
          </h4>
<p id="section-4.4.1-1">The external authorization data EAD_1 contains an EAD item with ead_label = TBD1 and ead_value = Voucher_Info, which is a CBOR byte string:<a href="#section-4.4.1-1" class="pilcrow">¶</a></p>
<div class="lang-cddl sourcecode" id="section-4.4.1-2">
<pre>
Voucher_Info = bstr .cborseq Voucher_Info_Seq

Voucher_Info_Seq = [ ; used as a CBOR sequence, not array
    LOC_W:      tstr,
    ENC_U_INFO:     bstr
]
</pre><a href="#section-4.4.1-2" class="pilcrow">¶</a>
</div>
<p id="section-4.4.1-3">where<a href="#section-4.4.1-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.4.1-4.1">
              <p id="section-4.4.1-4.1.1">LOC_W is a text string used by V to locate W, e.g., a URI or a domain name.<a href="#section-4.4.1-4.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.4.1-4.2">
              <p id="section-4.4.1-4.2.1">ENC_U_INFO is a byte string containing an encrypted identifier of U and, optionally, opaque application data prepared by U. It is calculated as follows:<a href="#section-4.4.1-4.2.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-4.4.1-5">ENC_U_INFO is encrypted using the EDHOC AEAD algorithm of the selected cipher suite SS specified in SUITE_I of EDHOC message_1.
It consists of 'ciphertext' of COSE_Encrypt0 (<span><a href="https://rfc-editor.org/rfc/rfc9052#section-5.2" class="relref">Section 5.2</a> of [<a href="#RFC9052" class="cite xref">RFC9052</a>]</span>) computed from the following:<a href="#section-4.4.1-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.4.1-6.1">
              <p id="section-4.4.1-6.1.1">The encryption key K_1 and nonce IV_1 are derived as specified below.<a href="#section-4.4.1-6.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.4.1-6.2">
              <p id="section-4.4.1-6.2.1">'protected' is a byte string of size 0<a href="#section-4.4.1-6.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.4.1-6.3">
              <p id="section-4.4.1-6.3.1">'plaintext' and 'external_aad' as below:<a href="#section-4.4.1-6.3.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<div class="lang-cddl sourcecode" id="section-4.4.1-7">
<pre>
plaintext = (
    ID_U:            bstr,
)
</pre><a href="#section-4.4.1-7" class="pilcrow">¶</a>
</div>
<div class="lang-cddl sourcecode" id="section-4.4.1-8">
<pre>
external_aad = [ ; used as a CBOR sequence, not array
    "ELA-voucher-info": tstr, ; fixed label
    METHOD:             int,
    SS:                 int,
    C_I:                bstr
]
</pre><a href="#section-4.4.1-8" class="pilcrow">¶</a>
</div>
<p id="section-4.4.1-9">where<a href="#section-4.4.1-9" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.4.1-10.1">
              <p id="section-4.4.1-10.1.1">"ELA-voucher-info" is a string literal for the Voucher_Info struct.<a href="#section-4.4.1-10.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.4.1-10.2">
              <p id="section-4.4.1-10.2.1">ID_U is an identifier of the device, see <a href="#device" class="auto internal xref">Section 3.1</a>.<a href="#section-4.4.1-10.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.4.1-10.3">
              <p id="section-4.4.1-10.3.1">METHOD is the authentication method of EDHOC message_1.<a href="#section-4.4.1-10.3.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.4.1-10.4">
              <p id="section-4.4.1-10.4.1">SS is the selected cipher suite in SUITES_I of EDHOC message_1, see <a href="#U-V" class="auto internal xref">Section 4.5</a>.<a href="#section-4.4.1-10.4.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.4.1-10.5">
              <p id="section-4.4.1-10.5.1">C_I is the connection identifier of EDHOC message_1.<a href="#section-4.4.1-10.5.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-4.4.1-11">The external_aad is wrapped in an enc_structure as defined in <span><a href="https://rfc-editor.org/rfc/rfc9052#section-5.3" class="relref">Section 5.3</a> of [<a href="#RFC9052" class="cite xref">RFC9052</a>]</span>.<a href="#section-4.4.1-11" class="pilcrow">¶</a></p>
<p id="section-4.4.1-12">The derivation of K_1 = EDHOC_Expand(PRK, info, length) uses the following input to the info struct (see OKM in <a href="#reuse" class="auto internal xref">Section 4.2</a>):<a href="#section-4.4.1-12" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.4.1-13.1">
              <p id="section-4.4.1-13.1.1">info_label = 0<a href="#section-4.4.1-13.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.4.1-13.2">
              <p id="section-4.4.1-13.2.1">context  = h'' (the empty CBOR string)<a href="#section-4.4.1-13.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.4.1-13.3">
              <p id="section-4.4.1-13.3.1">length is length of the key of the EDHOC AEAD algorithm in bytes (which is the length of K_1)<a href="#section-4.4.1-13.3.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-4.4.1-14">The derivation of IV_1 = EDHOC_Expand(PRK, info, length) uses the following input to the info struct (see OKM in <a href="#reuse" class="auto internal xref">Section 4.2</a>):<a href="#section-4.4.1-14" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.4.1-15.1">
              <p id="section-4.4.1-15.1.1">info_label = 1<a href="#section-4.4.1-15.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.4.1-15.2">
              <p id="section-4.4.1-15.2.1">context = h''  (the empty CBOR string)<a href="#section-4.4.1-15.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.4.1-15.3">
              <p id="section-4.4.1-15.3.1">length is length of the nonce of the EDHOC AEAD algorithm in bytes (which is the length of IV_1)<a href="#section-4.4.1-15.3.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</section>
</div>
<div id="voucher">
<section id="section-4.4.2">
          <h4 id="name-voucher">
<a href="#section-4.4.2" class="section-number selfRef">4.4.2. </a><a href="#name-voucher" class="section-name selfRef">Voucher</a>
          </h4>
<p id="section-4.4.2-1">The external authorization data EAD_2 contains an EAD item with ead_label = TBD2 and ead_value = Voucher.<a href="#section-4.4.2-1" class="pilcrow">¶</a></p>
<p id="section-4.4.2-2">The voucher is an assertion to U that W has authorized V.
It is encrypted using the EDHOC AEAD algorithm of the selected cipher suite SS specified in SUITE_I of EDHOC message_1.
It consists of the 'ciphertext' field of a COSE_Encrypt0 object, which is a byte string, as defined below.<a href="#section-4.4.2-2" class="pilcrow">¶</a></p>
<div class="lang-cddl sourcecode" id="section-4.4.2-3">
<pre>
Voucher = bstr
</pre><a href="#section-4.4.2-3" class="pilcrow">¶</a>
</div>
<p id="section-4.4.2-4">Its corresponding plaintext value consists of an opaque field that can be used by W to convey information to U, such as a voucher scope.
The authentication tag present in the ciphertext is also bound to message_1 and the credential of V as described below.<a href="#section-4.4.2-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.4.2-5.1">
              <p id="section-4.4.2-5.1.1">The encryption key K_2 and nonce IV_2 are derived as specified below.<a href="#section-4.4.2-5.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.4.2-5.2">
              <p id="section-4.4.2-5.2.1">'protected' is a byte string of size 0<a href="#section-4.4.2-5.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.4.2-5.3">
              <p id="section-4.4.2-5.3.1">'plaintext' and 'external_aad' as below:<a href="#section-4.4.2-5.3.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<div class="lang-cddl sourcecode" id="section-4.4.2-6">
<pre>
plaintext = (
    ?OPAQUE_INFO: bstr
)
</pre><a href="#section-4.4.2-6" class="pilcrow">¶</a>
</div>
<div class="lang-cddl sourcecode" id="section-4.4.2-7">
<pre>
external_aad = (
    H_handshake:  bstr,
    CRED_V:        bstr,
)
</pre><a href="#section-4.4.2-7" class="pilcrow">¶</a>
</div>
<p id="section-4.4.2-8">where<a href="#section-4.4.2-8" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.4.2-9.1">
              <p id="section-4.4.2-9.1.1">OPAQUE_INFO is an opaque field provided by the application.
If present, it will contain application data that W may want to convey to U, e.g., a voucher scope.
Note that OPAQUE_INFO is opaque when viewed as an information element in EDHOC.
It is opaque to V, while the application in U and W can read its contents.<a href="#section-4.4.2-9.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.4.2-9.2">
              <p id="section-4.4.2-9.2.1">H_handshake is the hash of EDHOC message_1, sent by V as part of the voucher request, see <a href="#voucher_request" class="auto internal xref">Section 4.6.1</a>.<a href="#section-4.4.2-9.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.4.2-9.3">
              <p id="section-4.4.2-9.3.1">CRED_V is the credential used by V to authenticate to U and W, see <a href="#V_2" class="auto internal xref">Section 4.5.2.1</a> and <a href="#creds-table" class="auto internal xref">Table 1</a>.<a href="#section-4.4.2-9.3.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-4.4.2-10">The derivation of K_2 = EDHOC_Expand(PRK, info, length) uses the following input to the info struct (see <a href="#reuse" class="auto internal xref">Section 4.2</a>):<a href="#section-4.4.2-10" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.4.2-11.1">
              <p id="section-4.4.2-11.1.1">info_label = 2<a href="#section-4.4.2-11.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.4.2-11.2">
              <p id="section-4.4.2-11.2.1">context  = h'' (the empty CBOR string)<a href="#section-4.4.2-11.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.4.2-11.3">
              <p id="section-4.4.2-11.3.1">length is length of the key of the EDHOC AEAD algorithm in bytes<a href="#section-4.4.2-11.3.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-4.4.2-12">The derivation of IV_2 = EDHOC_Expand(PRK, info, length) uses the following input to the info struct (see <a href="#reuse" class="auto internal xref">Section 4.2</a>):<a href="#section-4.4.2-12" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.4.2-13.1">
              <p id="section-4.4.2-13.1.1">info_label = 3<a href="#section-4.4.2-13.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.4.2-13.2">
              <p id="section-4.4.2-13.2.1">context = h''  (the empty CBOR string)<a href="#section-4.4.2-13.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.4.2-13.3">
              <p id="section-4.4.2-13.3.1">length is length of the nonce of the EDHOC AEAD algorithm in bytes<a href="#section-4.4.2-13.3.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</section>
</div>
</section>
</div>
<div id="U-V">
<section id="section-4.5">
        <h3 id="name-device-authenticator-u-v">
<a href="#section-4.5" class="section-number selfRef">4.5. </a><a href="#name-device-authenticator-u-v" class="section-name selfRef">Device &lt;-&gt; Authenticator (U &lt;-&gt; V)</a>
        </h3>
<p id="section-4.5-1">This section describes the processing in U and V, which includes the EDHOC protocol, see <a href="#fig-protocol" class="auto internal xref">Figure 3</a>. Normal EDHOC processing is omitted here.<a href="#section-4.5-1" class="pilcrow">¶</a></p>
<div id="m1">
<section id="section-4.5.1">
          <h4 id="name-message-1">
<a href="#section-4.5.1" class="section-number selfRef">4.5.1. </a><a href="#name-message-1" class="section-name selfRef">Message 1</a>
          </h4>
<div id="processing-in-u">
<section id="section-4.5.1.1">
            <h5 id="name-processing-in-u">
<a href="#section-4.5.1.1" class="section-number selfRef">4.5.1.1. </a><a href="#name-processing-in-u" class="section-name selfRef">Processing in U</a>
            </h5>
<p id="section-4.5.1.1-1">U composes EDHOC message_1 using authentication method, identifiers, etc. according to an agreed application profile, see <span><a href="https://rfc-editor.org/rfc/rfc9528#section-3.9" class="relref">Section 3.9</a> of [<a href="#RFC9528" class="cite xref">RFC9528</a>]</span>. The selected cipher suite, in this document denoted SS, applies also to the interaction with W as detailed in <a href="#reuse" class="auto internal xref">Section 4.2</a>, in particular, with respect to the Diffie-Hellman key agreement algorithm used between U and W. As part of the normal EDHOC processing, U generates the ephemeral public key G_X that is reused in the interaction with W, see <a href="#U-W" class="auto internal xref">Section 4.4</a>.<a href="#section-4.5.1.1-1" class="pilcrow">¶</a></p>
<p id="section-4.5.1.1-2">The device sends EDHOC message_1 with EAD item (-TBD1, Voucher_Info) included in EAD_1, where Voucher_Info is specified in <a href="#U-W" class="auto internal xref">Section 4.4</a>. The negative sign indicates that the EAD item is critical, see <span><a href="https://rfc-editor.org/rfc/rfc9528#section-3.8" class="relref">Section 3.8</a> of [<a href="#RFC9528" class="cite xref">RFC9528</a>]</span>.<a href="#section-4.5.1.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="processing-in-v">
<section id="section-4.5.1.2">
            <h5 id="name-processing-in-v">
<a href="#section-4.5.1.2" class="section-number selfRef">4.5.1.2. </a><a href="#name-processing-in-v" class="section-name selfRef">Processing in V</a>
            </h5>
<p id="section-4.5.1.2-1">V receives EDHOC message_1 from U and processes it as specified in <span><a href="https://rfc-editor.org/rfc/rfc9528#section-5.2.3" class="relref">Section 5.2.3</a> of [<a href="#RFC9528" class="cite xref">RFC9528</a>]</span>, with the additional step of processing the EAD item in EAD_1. Since the EAD item is critical, if V does not recognize it or it contains information that V cannot process, then V MUST abort the EDHOC session, see <span><a href="https://rfc-editor.org/rfc/rfc9528#section-3.8" class="relref">Section 3.8</a> of [<a href="#RFC9528" class="cite xref">RFC9528</a>]</span>. Otherwise, the ead_label = TBD1 triggers the voucher request to W as described in <a href="#V-W" class="auto internal xref">Section 4.6</a>. The exchange between V and W needs to be completed successfully for the EDHOC session to be continued.<a href="#section-4.5.1.2-1" class="pilcrow">¶</a></p>
<p id="section-4.5.1.2-2">Note that the selected cipher suite SS is used both in the U &lt;-&gt; W and U &lt;-&gt; V interactions, therefore V must be ready to use the cipher suite SS set by U in message_1.
That is, ELA restricts the cipher suite negotiation in order to provide a streamlined authorization flow from the perspective of U.
Since V has a pre-established trusted channel with W, it has the opportunity to learn which cipher suites should be supported before any authorization attempt begins to take place.<a href="#section-4.5.1.2-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="m2">
<section id="section-4.5.2">
          <h4 id="name-message-2">
<a href="#section-4.5.2" class="section-number selfRef">4.5.2. </a><a href="#name-message-2" class="section-name selfRef">Message 2</a>
          </h4>
<div id="V_2">
<section id="section-4.5.2.1">
            <h5 id="name-processing-in-v-2">
<a href="#section-4.5.2.1" class="section-number selfRef">4.5.2.1. </a><a href="#name-processing-in-v-2" class="section-name selfRef">Processing in V</a>
            </h5>
<p id="section-4.5.2.1-1">V receives the voucher response from W as described in <a href="#V-W" class="auto internal xref">Section 4.6</a>.<a href="#section-4.5.2.1-1" class="pilcrow">¶</a></p>
<p id="section-4.5.2.1-2">V sends EDHOC message_2 to U with the critical EAD item (-TBD2, Voucher) included in EAD_2, i.e., ead_label = TBD2 and ead_value = Voucher, as specified in <a href="#voucher" class="auto internal xref">Section 4.4.2</a>.<a href="#section-4.5.2.1-2" class="pilcrow">¶</a></p>
<p id="section-4.5.2.1-3">The type of CRED_V may depend on the selected mechanism for the establishment of a secure channel between V and W, See <a href="#creds-table" class="auto internal xref">Table 1</a>.<a href="#section-4.5.2.1-3" class="pilcrow">¶</a></p>
<p id="section-4.5.2.1-4">In case the network between U and V is constrained, it is recommended that CRED_V be a CWT Claims Set (CCS) <span>[<a href="#RFC8392" class="cite xref">RFC8392</a>]</span>.
The CCS contains the public authentication key of V encoded as a COSE_Key in the 'cnf' claim, see <span><a href="https://rfc-editor.org/rfc/rfc9528#section-3.5.2" class="relref">Section 3.5.2</a> of [<a href="#RFC9528" class="cite xref">RFC9528</a>]</span>.
ID_CRED_R contains the CWT Claims Set with 'kccs' as COSE header_map, see <span><a href="https://rfc-editor.org/rfc/rfc9528#section-10.6" class="relref">Section 10.6</a> of [<a href="#RFC9528" class="cite xref">RFC9528</a>]</span>.<a href="#section-4.5.2.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="processing-in-u-1">
<section id="section-4.5.2.2">
            <h5 id="name-processing-in-u-2">
<a href="#section-4.5.2.2" class="section-number selfRef">4.5.2.2. </a><a href="#name-processing-in-u-2" class="section-name selfRef">Processing in U</a>
            </h5>
<p id="section-4.5.2.2-1">U receives EDHOC message_2 from V and processes it as specified in <span><a href="https://rfc-editor.org/rfc/rfc9528#section-5.3.3" class="relref">Section 5.3.3</a> of [<a href="#RFC9528" class="cite xref">RFC9528</a>]</span>, with the additional step of processing the EAD item in EAD_2.<a href="#section-4.5.2.2-1" class="pilcrow">¶</a></p>
<p id="section-4.5.2.2-2">If U does not recognize the EAD item or the EAD item contains information that U cannot process, then U MUST abort the EDHOC session, see <span><a href="https://rfc-editor.org/rfc/rfc9528#section-3.8" class="relref">Section 3.8</a> of [<a href="#RFC9528" class="cite xref">RFC9528</a>]</span>. Otherwise, U MUST verify the Voucher using H_message_1, CRED_V, and the keys derived as in <a href="#voucher" class="auto internal xref">Section 4.4.2</a>. If the verification fails then U MUST abort the EDHOC session.<a href="#section-4.5.2.2-2" class="pilcrow">¶</a></p>
<p id="section-4.5.2.2-3">If OPAQUE_INFO is present, it is made available to the application.<a href="#section-4.5.2.2-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="message-3">
<section id="section-4.5.3">
          <h4 id="name-message-3">
<a href="#section-4.5.3" class="section-number selfRef">4.5.3. </a><a href="#name-message-3" class="section-name selfRef">Message 3</a>
          </h4>
<div id="processing-in-u-2">
<section id="section-4.5.3.1">
            <h5 id="name-processing-in-u-3">
<a href="#section-4.5.3.1" class="section-number selfRef">4.5.3.1. </a><a href="#name-processing-in-u-3" class="section-name selfRef">Processing in U</a>
            </h5>
<p id="section-4.5.3.1-1">If all verifications are passed, then U sends EDHOC message_3.<a href="#section-4.5.3.1-1" class="pilcrow">¶</a></p>
<p id="section-4.5.3.1-2">EDHOC message_3 may be combined with an OSCORE-protected application request, see <span>[<a href="#I-D.ietf-core-oscore-edhoc" class="cite xref">I-D.ietf-core-oscore-edhoc</a>]</span>.<a href="#section-4.5.3.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="processing-in-v-1">
<section id="section-4.5.3.2">
            <h5 id="name-processing-in-v-3">
<a href="#section-4.5.3.2" class="section-number selfRef">4.5.3.2. </a><a href="#name-processing-in-v-3" class="section-name selfRef">Processing in V</a>
            </h5>
<p id="section-4.5.3.2-1">V performs the normal EDHOC verifications of message_3. V may retrieve CRED_U from a Credential Database, after having learned ID_CRED_I from U.<a href="#section-4.5.3.2-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="V-W">
<section id="section-4.6">
        <h3 id="name-authenticator-enrollment-se">
<a href="#section-4.6" class="section-number selfRef">4.6. </a><a href="#name-authenticator-enrollment-se" class="section-name selfRef">Authenticator &lt;-&gt; Enrollment Server (V &lt;-&gt; W)</a>
        </h3>
<p id="section-4.6-1">It is assumed that V and W have set up a secure connection, W has accessed the authentication credential CRED_V to be used in the EDHOC session between V and U, and that W has verified that V is in possession of the private key corresponding to CRED_V, see <a href="#domain-auth" class="auto internal xref">Section 3.2</a> and <a href="#authz-server" class="auto internal xref">Section 3.3</a>.
V and W run the Voucher Request/Response protocol over the secure connection.<a href="#section-4.6-1" class="pilcrow">¶</a></p>
<div id="voucher_request">
<section id="section-4.6.1">
          <h4 id="name-voucher-request">
<a href="#section-4.6.1" class="section-number selfRef">4.6.1. </a><a href="#name-voucher-request" class="section-name selfRef">Voucher Request</a>
          </h4>
<div id="processing-in-v-2">
<section id="section-4.6.1.1">
            <h5 id="name-processing-in-v-4">
<a href="#section-4.6.1.1" class="section-number selfRef">4.6.1.1. </a><a href="#name-processing-in-v-4" class="section-name selfRef">Processing in V</a>
            </h5>
<p id="section-4.6.1.1-1">V sends the voucher request to W.
The Voucher Request SHALL be a CBOR array as defined below:<a href="#section-4.6.1.1-1" class="pilcrow">¶</a></p>
<div class="lang-cddl sourcecode" id="section-4.6.1.1-2">
<pre>
Voucher_Request = [
    SS:             int,
    G_U:            bstr,
    Voucher_Info:   bstr,
    H_handshake:    bstr,
    ? opaque_state: bstr
]
</pre><a href="#section-4.6.1.1-2" class="pilcrow">¶</a>
</div>
<p id="section-4.6.1.1-3">where<a href="#section-4.6.1.1-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.6.1.1-4.1">
                <p id="section-4.6.1.1-4.1.1">SS is the selected cipher suite used in the EDHOC session between U and V<a href="#section-4.6.1.1-4.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-4.6.1.1-4.2">
                <p id="section-4.6.1.1-4.2.1">G_U is the ephemeral public key (G_X) of U<a href="#section-4.6.1.1-4.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-4.6.1.1-4.3">
                <p id="section-4.6.1.1-4.3.1">Voucher_Info is as extracted from the EAD_1 field of message_1<a href="#section-4.6.1.1-4.3.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-4.6.1.1-4.4">
                <p id="section-4.6.1.1-4.4.1">H_handshake is the hash of message_1. It is computed using the EDHOC hash algorithm of the selected cipher suite SS specified in SUITE_I of EDHOC message_1.<a href="#section-4.6.1.1-4.4.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-4.6.1.1-4.5">
                <p id="section-4.6.1.1-4.5.1">opaque_state is OPTIONAL and represents the serialized and encrypted opaque state needed by V to statelessly respond to U after the reception of Voucher_Response.<a href="#section-4.6.1.1-4.5.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</section>
</div>
<div id="processing-in-w">
<section id="section-4.6.1.2">
            <h5 id="name-processing-in-w">
<a href="#section-4.6.1.2" class="section-number selfRef">4.6.1.2. </a><a href="#name-processing-in-w" class="section-name selfRef">Processing in W</a>
            </h5>
<p id="section-4.6.1.2-1">W receives and parses the voucher request received over the secure connection with V.
W extracts from Voucher_Request:<a href="#section-4.6.1.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.6.1.2-2.1">
                <p id="section-4.6.1.2-2.1.1">SS - the selected cipher suite, which is the (last) integer of SUITES_I.<a href="#section-4.6.1.2-2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-4.6.1.2-2.2">
                <p id="section-4.6.1.2-2.2.1">G_U - the ephemeral public key of U.<a href="#section-4.6.1.2-2.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-4.6.1.2-2.3">
                <p id="section-4.6.1.2-2.3.1">ENC_U_INFO - the encryption of the device identifier ID_U, contained in the Voucher_Info field of Voucher_Request.<a href="#section-4.6.1.2-2.3.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-4.6.1.2-2.4">
                <p id="section-4.6.1.2-2.4.1">H_handshake - the hash of message_1.<a href="#section-4.6.1.2-2.4.1" class="pilcrow">¶</a></p>
</li>
            </ul>
<p id="section-4.6.1.2-3">W verifies and decrypts ENC_U_INFO using the relevant algorithms of the selected cipher suite SS (see <a href="#reuse" class="auto internal xref">Section 4.2</a>), and obtains ID_U.<a href="#section-4.6.1.2-3" class="pilcrow">¶</a></p>
<p id="section-4.6.1.2-4">W uses H_handshake as a session identifier, and associates it to the device identifier ID_U.
Note that message_1 contains a unique ephemeral key, therefore H_handshake is expected to be unique.<a href="#section-4.6.1.2-4" class="pilcrow">¶</a></p>
<p id="section-4.6.1.2-5">If processing fails up until this point, the protocol SHALL be aborted with an error code signaling a generic issue with the request, see <a href="#rest-voucher-request" class="auto internal xref">Section 5.4.1</a>.<a href="#section-4.6.1.2-5" class="pilcrow">¶</a></p>
<p id="section-4.6.1.2-6">W uses ID_U to look up the associated authorization policies for U and enforces them. This is out of scope for the specification.<a href="#section-4.6.1.2-6" class="pilcrow">¶</a></p>
<p id="section-4.6.1.2-7">If ID_U is known by W, but authorization fails, the protocol SHALL be aborted with an error code signaling an access control issue, see <a href="#err-handling" class="auto internal xref">Section 4.7</a> and <a href="#rest-voucher-request" class="auto internal xref">Section 5.4.1</a>.<a href="#section-4.6.1.2-7" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="voucher_response">
<section id="section-4.6.2">
          <h4 id="name-voucher-response">
<a href="#section-4.6.2" class="section-number selfRef">4.6.2. </a><a href="#name-voucher-response" class="section-name selfRef">Voucher Response</a>
          </h4>
<div id="processing-in-w-1">
<section id="section-4.6.2.1">
            <h5 id="name-processing-in-w-2">
<a href="#section-4.6.2.1" class="section-number selfRef">4.6.2.1. </a><a href="#name-processing-in-w-2" class="section-name selfRef">Processing in W</a>
            </h5>
<p id="section-4.6.2.1-1">W retrieves CRED_V associated with the secure connection with V, and constructs the Voucher for the device with identifier ID_U (see <a href="#voucher" class="auto internal xref">Section 4.4.2</a>).<a href="#section-4.6.2.1-1" class="pilcrow">¶</a></p>
<p id="section-4.6.2.1-2">W generates the voucher response and sends it to V over the secure connection. The Voucher_Response SHALL be a CBOR array as defined below:<a href="#section-4.6.2.1-2" class="pilcrow">¶</a></p>
<div class="lang-cddl sourcecode" id="section-4.6.2.1-3">
<pre>
Voucher_Response = [
    Voucher:        bstr,
    ? opaque_state: bstr
]
</pre><a href="#section-4.6.2.1-3" class="pilcrow">¶</a>
</div>
<p id="section-4.6.2.1-4">where<a href="#section-4.6.2.1-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.6.2.1-5.1">
                <p id="section-4.6.2.1-5.1.1">The Voucher is defined in <a href="#voucher" class="auto internal xref">Section 4.4.2</a>.<a href="#section-4.6.2.1-5.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-4.6.2.1-5.2">
                <p id="section-4.6.2.1-5.2.1">opaque_state is the echoed byte string opaque_state from Voucher_Request, if present.<a href="#section-4.6.2.1-5.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
<p id="section-4.6.2.1-6">W signals the successful generation of the voucher via a status code in the REST interface, as defined in <a href="#rest-voucher-request" class="auto internal xref">Section 5.4.1</a>.<a href="#section-4.6.2.1-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="processing-in-v-3">
<section id="section-4.6.2.2">
            <h5 id="name-processing-in-v-5">
<a href="#section-4.6.2.2" class="section-number selfRef">4.6.2.2. </a><a href="#name-processing-in-v-5" class="section-name selfRef">Processing in V</a>
            </h5>
<p id="section-4.6.2.2-1">V receives the voucher response from W over the secure connection.
If present, V decrypts and verifies opaque_state as received from W. If that verification fails, then the EDHOC session
with U is aborted.
If the voucher response is successfully received from W, then V responds to U with EDHOC message_2 as described in <a href="#V_2" class="auto internal xref">Section 4.5.2.1</a>.<a href="#section-4.6.2.2-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="err-handling">
<section id="section-4.7">
        <h3 id="name-error-handling">
<a href="#section-4.7" class="section-number selfRef">4.7. </a><a href="#name-error-handling" class="section-name selfRef">Error Handling</a>
        </h3>
<p id="section-4.7-1">This section specifies a new EDHOC error code and how it is used in ELA.<a href="#section-4.7-1" class="pilcrow">¶</a></p>
<div id="edhoc-error-access-denied">
<section id="section-4.7.1">
          <h4 id="name-edhoc-error-access-denied">
<a href="#section-4.7.1" class="section-number selfRef">4.7.1. </a><a href="#name-edhoc-error-access-denied" class="section-name selfRef">EDHOC Error "Access denied"</a>
          </h4>
<p id="section-4.7.1-1">This section specifies the new EDHOC error "Access denied", see <a href="#fig-error-codes" class="auto internal xref">Figure 4</a>.<a href="#section-4.7.1-1" class="pilcrow">¶</a></p>
<span id="name-edhoc-error-code-and-error-"></span><div id="fig-error-codes">
<figure id="figure-4">
            <div id="section-4.7.1-2.1">
              <div class="alignLeft art-svg artwork" id="section-4.7.1-2.1.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="112" width="568" viewBox="0 0 568 112" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
                  <path d="M 8,32 L 8,96" fill="none" stroke="black"></path>
                  <path d="M 96,32 L 96,96" fill="none" stroke="black"></path>
                  <path d="M 232,32 L 232,96" fill="none" stroke="black"></path>
                  <path d="M 560,32 L 560,96" fill="none" stroke="black"></path>
                  <path d="M 8,32 L 560,32" fill="none" stroke="black"></path>
                  <path d="M 8,62 L 560,62" fill="none" stroke="black"></path>
                  <path d="M 8,66 L 560,66" fill="none" stroke="black"></path>
                  <path d="M 8,96 L 560,96" fill="none" stroke="black"></path>
                  <g class="text">
                    <text x="52" y="52">ERR_CODE</text>
                    <text x="140" y="52">ERR_INFO</text>
                    <text x="196" y="52">Type</text>
                    <text x="288" y="52">Description</text>
                    <text x="68" y="84">TBD3</text>
                    <text x="160" y="84">error_content</text>
                    <text x="268" y="84">Access</text>
                    <text x="324" y="84">denied</text>
                  </g>
                </svg><a href="#section-4.7.1-2.1.1" class="pilcrow">¶</a>
</div>
</div>
<figcaption><a href="#figure-4" class="selfRef">Figure 4</a>:
<a href="#name-edhoc-error-code-and-error-" class="selfRef">EDHOC error code and error information for ‘Access denied’.</a>
            </figcaption></figure>
</div>
<p id="section-4.7.1-3">Error code TBD3 is used to indicate to the receiver that access control has been applied and the sender has aborted the EDHOC session.
The ERR_INFO field contains error_content which is a CBOR Sequence consisting of an integer and an optional byte string.<a href="#section-4.7.1-3" class="pilcrow">¶</a></p>
<div class="lang-cddl sourcecode" id="section-4.7.1-4">
<pre>
error_content = (
  REJECT_TYPE : int,
  ? REJECT_INFO : bstr,
)
</pre><a href="#section-4.7.1-4" class="pilcrow">¶</a>
</div>
<p id="section-4.7.1-5">The purpose of REJECT_INFO is for the sender to provide verifiable and actionable information to the receiver about the error, so that an automated action may be taken to enable access.<a href="#section-4.7.1-5" class="pilcrow">¶</a></p>
<span id="name-reject_type-and-reject_info"></span><div id="fig-reject">
<figure id="figure-5">
            <div id="section-4.7.1-6.1">
              <div class="alignLeft art-svg artwork" id="section-4.7.1-6.1.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="144" width="568" viewBox="0 0 568 144" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
                  <path d="M 8,32 L 8,128" fill="none" stroke="black"></path>
                  <path d="M 120,32 L 120,128" fill="none" stroke="black"></path>
                  <path d="M 248,32 L 248,128" fill="none" stroke="black"></path>
                  <path d="M 560,32 L 560,128" fill="none" stroke="black"></path>
                  <path d="M 8,32 L 560,32" fill="none" stroke="black"></path>
                  <path d="M 8,62 L 560,62" fill="none" stroke="black"></path>
                  <path d="M 8,66 L 560,66" fill="none" stroke="black"></path>
                  <path d="M 8,96 L 560,96" fill="none" stroke="black"></path>
                  <path d="M 8,128 L 560,128" fill="none" stroke="black"></path>
                  <g class="text">
                    <text x="64" y="52">REJECT_TYPE</text>
                    <text x="176" y="52">REJECT_INFO</text>
                    <text x="304" y="52">Description</text>
                    <text x="104" y="84">0</text>
                    <text x="136" y="84">-</text>
                    <text x="268" y="84">No</text>
                    <text x="328" y="84">REJECT_INFO</text>
                    <text x="104" y="116">1</text>
                    <text x="148" y="116">bstr</text>
                    <text x="304" y="116">REJECT_INFO</text>
                    <text x="372" y="116">from</text>
                    <text x="424" y="116">trusted</text>
                    <text x="480" y="116">third</text>
                    <text x="528" y="116">party</text>
                  </g>
                </svg><a href="#section-4.7.1-6.1.1" class="pilcrow">¶</a>
</div>
</div>
<figcaption><a href="#figure-5" class="selfRef">Figure 5</a>:
<a href="#name-reject_type-and-reject_info" class="selfRef">REJECT_TYPE and REJECT_INFO for ‘Access denied’.</a>
            </figcaption></figure>
</div>
</section>
</div>
<div id="error-handling-in-w-v-and-u">
<section id="section-4.7.2">
          <h4 id="name-error-handling-in-w-v-and-u">
<a href="#section-4.7.2" class="section-number selfRef">4.7.2. </a><a href="#name-error-handling-in-w-v-and-u" class="section-name selfRef">Error handling in W, V, and U</a>
          </h4>
<p id="section-4.7.2-1">ELA uses the EDHOC Error "Access denied" in the following way:<a href="#section-4.7.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.7.2-2.1">
              <p id="section-4.7.2-2.1.1">W generates error_content and transfers it to V via the secure connection.
If REJECT_TYPE is 1, then REJECT_INFO is encrypted from W to U using the EDHOC AEAD algorithm.
W signals the error via an appropriate status code in the REST interface, as defined in <a href="#rest-voucher-request" class="auto internal xref">Section 5.4.1</a>.<a href="#section-4.7.2-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.7.2-2.2">
              <p id="section-4.7.2-2.2.1">V receives error_content, prepares an EDHOC "Access denied" error, and sends it to U.<a href="#section-4.7.2-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.7.2-2.3">
              <p id="section-4.7.2-2.3.1">U receives the error message and extracts the error_content.
If REJECT_TYPE is 1, then U decrypts REJECT_INFO, based on which it may retry to gain access.<a href="#section-4.7.2-2.3.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-4.7.2-3">The encryption of REJECT_INFO follows a procedure analogous to the one defined in <a href="#voucher" class="auto internal xref">Section 4.4.2</a>, with the following differences:<a href="#section-4.7.2-3" class="pilcrow">¶</a></p>
<div class="lang-cddl sourcecode" id="section-4.7.2-4">
<pre>
plaintext = (
    OPAQUE_INFO:     bstr,
 )
</pre><a href="#section-4.7.2-4" class="pilcrow">¶</a>
</div>
<div class="lang-cddl sourcecode" id="section-4.7.2-5">
<pre>
external_aad = (
    H_handshake:    bstr,
 )
</pre><a href="#section-4.7.2-5" class="pilcrow">¶</a>
</div>
<p id="section-4.7.2-6">where<a href="#section-4.7.2-6" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.7.2-7.1">
              <p id="section-4.7.2-7.1.1">OPAQUE_INFO is an opaque field that contains actionable information about the error.
It may contain, for example, a list of suggested Vs through which U should join instead.<a href="#section-4.7.2-7.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.7.2-7.2">
              <p id="section-4.7.2-7.2.1">H_handshake is the hash of EDHOC message_1, calculated from the associated voucher request, see <a href="#voucher_request" class="auto internal xref">Section 4.6.1</a>.<a href="#section-4.7.2-7.2.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</section>
</div>
</section>
</div>
<div id="reverse-u-responder">
<section id="section-4.8">
        <h3 id="name-reverse-flow-with-u-as-resp">
<a href="#section-4.8" class="section-number selfRef">4.8. </a><a href="#name-reverse-flow-with-u-as-resp" class="section-name selfRef">Reverse flow with U as Responder</a>
        </h3>
<p id="section-4.8-1">This section presents a protocol variant in which U is the EDHOC Responder.
This may allow optimizations in certain constrained network technologies.
For example, one use case is having V broadcast message_1, to which U responds with a message_2 whose EAD_2 field contains Voucher_Info.<a href="#section-4.8-1" class="pilcrow">¶</a></p>
<p id="section-4.8-2">Note that this is different from the EDHOC reverse message flow defined in <span><a href="https://rfc-editor.org/rfc/rfc9528#appendix-A.2.2" class="relref">Appendix A.2.2</a> of [<a href="#RFC9528" class="cite xref">RFC9528</a>]</span>, since we make no assumption about whether U or V is a CoAP server.<a href="#section-4.8-2" class="pilcrow">¶</a></p>
<div id="_u-initiator">
<section id="section-4.8.1">
          <h4 id="name-u-is-the-initiator">
<a href="#section-4.8.1" class="section-number selfRef">4.8.1. </a><a href="#name-u-is-the-initiator" class="section-name selfRef">U is the Initiator</a>
          </h4>
<p id="section-4.8.1-1">For clarity, we first present the "default flow" with U as Initiator, as described in <a href="#protocol-overview" class="auto internal xref">Section 4.1</a> and <a href="#U-V" class="auto internal xref">Section 4.5</a>.
Note that Voucher_Info and Voucher are carried in EDHOC message_1 and message_2, respectively.<a href="#section-4.8.1-1" class="pilcrow">¶</a></p>
<span id="name-in-ela-default-flow-u-is-th"></span><div id="fig-u-initiator">
<figure id="figure-6">
            <div id="section-4.8.1-2.1">
              <div class="alignCenter art-svg artwork" id="section-4.8.1-2.1.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="432" width="560" viewBox="0 0 560 432" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
                  <path d="M 8,32 L 8,80" fill="none" stroke="black"></path>
                  <path d="M 56,80 L 56,416" fill="none" stroke="black"></path>
                  <path d="M 104,32 L 104,80" fill="none" stroke="black"></path>
                  <path d="M 256,32 L 256,80" fill="none" stroke="black"></path>
                  <path d="M 304,80 L 304,416" fill="none" stroke="black"></path>
                  <path d="M 352,32 L 352,80" fill="none" stroke="black"></path>
                  <path d="M 552,144 L 552,272" fill="none" stroke="black"></path>
                  <path d="M 8,32 L 104,32" fill="none" stroke="black"></path>
                  <path d="M 256,32 L 352,32" fill="none" stroke="black"></path>
                  <path d="M 8,80 L 104,80" fill="none" stroke="black"></path>
                  <path d="M 256,80 L 352,80" fill="none" stroke="black"></path>
                  <path d="M 56,144 L 296,144" fill="none" stroke="black"></path>
                  <path d="M 304,192 L 544,192" fill="none" stroke="black"></path>
                  <path d="M 312,272 L 544,272" fill="none" stroke="black"></path>
                  <path d="M 64,320 L 296,320" fill="none" stroke="black"></path>
                  <path d="M 56,384 L 296,384" fill="none" stroke="black"></path>
                  <polygon class="arrowhead" points="552,272 540,266.4 540,277.6" fill="black" transform="rotate(0,544,272)"></polygon>
                  <polygon class="arrowhead" points="552,192 540,186.4 540,197.6" fill="black" transform="rotate(0,544,192)"></polygon>
                  <polygon class="arrowhead" points="320,272 308,266.4 308,277.6" fill="black" transform="rotate(180,312,272)"></polygon>
                  <polygon class="arrowhead" points="304,384 292,378.4 292,389.6" fill="black" transform="rotate(0,296,384)"></polygon>
                  <polygon class="arrowhead" points="304,144 292,138.4 292,149.6" fill="black" transform="rotate(0,296,144)"></polygon>
                  <polygon class="arrowhead" points="72,320 60,314.4 60,325.6" fill="black" transform="rotate(180,64,320)"></polygon>
                  <g class="text">
                    <text x="56" y="52">U</text>
                    <text x="304" y="52">V</text>
                    <text x="56" y="68">Initiator</text>
                    <text x="304" y="68">Responder</text>
                    <text x="136" y="132">EDHOC</text>
                    <text x="200" y="132">message_1</text>
                    <text x="552" y="132">W</text>
                    <text x="88" y="164">EAD_1</text>
                    <text x="120" y="164">=</text>
                    <text x="156" y="164">(TBD1,</text>
                    <text x="240" y="164">Voucher_info)</text>
                    <text x="428" y="180">VREQ</text>
                    <text x="332" y="212">(SS,</text>
                    <text x="372" y="212">G_X,</text>
                    <text x="448" y="212">Voucher_Info,</text>
                    <text x="372" y="228">H_message_1,</text>
                    <text x="484" y="228">?opaque_state)</text>
                    <text x="428" y="260">VRES</text>
                    <text x="376" y="292">(Voucher,</text>
                    <text x="476" y="292">?opaque_state)</text>
                    <text x="136" y="308">EDHOC</text>
                    <text x="200" y="308">message_2</text>
                    <text x="104" y="340">EAD_2</text>
                    <text x="136" y="340">=</text>
                    <text x="172" y="340">(TBD2,</text>
                    <text x="236" y="340">Voucher)</text>
                    <text x="136" y="372">EDHOC</text>
                    <text x="200" y="372">message_3</text>
                  </g>
                </svg><a href="#section-4.8.1-2.1.1" class="pilcrow">¶</a>
</div>
</div>
<figcaption><a href="#figure-6" class="selfRef">Figure 6</a>:
<a href="#name-in-ela-default-flow-u-is-th" class="selfRef">In ELA default flow, U is the EDHOC Initiator.</a>
            </figcaption></figure>
</div>
<p id="section-4.8.1-3">In the ELA default flow, once message_2 processing is finalized (including processing of EAD_2), U considers V authenticated through W.<a href="#section-4.8.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="_u-responder">
<section id="section-4.8.2">
          <h4 id="name-u-is-the-responder">
<a href="#section-4.8.2" class="section-number selfRef">4.8.2. </a><a href="#name-u-is-the-responder" class="section-name selfRef">U is the Responder</a>
          </h4>
<p id="section-4.8.2-1">ELA also works with U as the EDHOC Responder, a setup we refer to as the "ELA reverse flow", as shown in <a href="#fig-u-responder" class="auto internal xref">Figure 7</a>.<a href="#section-4.8.2-1" class="pilcrow">¶</a></p>
<p id="section-4.8.2-2">We present this variant as a set of changes to the regular protocol flow.
That is, here we only describe the differences in processing, when compared to the ELA default flow.<a href="#section-4.8.2-2" class="pilcrow">¶</a></p>
<p id="section-4.8.2-3">Here is a summary of the changes needed in the ELA reverse flow:<a href="#section-4.8.2-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.8.2-4.1">
              <p id="section-4.8.2-4.1.1">Voucher_Info and Voucher are transported in EDHOC message_2 and message_3, respectively (instead of message_1 and message_2).<a href="#section-4.8.2-4.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.8.2-4.2">
              <p id="section-4.8.2-4.2.1">The EAD_2 and EAD_3 fields carry EAD items identified with labels TBD1 and TBD2, respectively.<a href="#section-4.8.2-4.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.8.2-4.3">
              <p id="section-4.8.2-4.3.1">The VREQ / VRES protocol takes place between message_2 and message_3.<a href="#section-4.8.2-4.3.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.8.2-4.4">
              <p id="section-4.8.2-4.4.1">The Voucher_Request carries G_Y instead of G_X, and the transcript hash TH_2 instead of the hash H_message_1.<a href="#section-4.8.2-4.4.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.8.2-4.5">
              <p id="section-4.8.2-4.5.1">Stateless operation of V (see <a href="#stateless-v" class="auto internal xref">Section 4.3</a>) is not supported<a href="#section-4.8.2-4.5.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<span id="name-ela-when-u-is-the-edhoc-res"></span><div id="fig-u-responder">
<figure id="figure-7">
            <div id="section-4.8.2-5.1">
              <div class="alignCenter art-svg artwork" id="section-4.8.2-5.1.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="480" width="560" viewBox="0 0 560 480" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
                  <path d="M 8,32 L 8,80" fill="none" stroke="black"></path>
                  <path d="M 56,80 L 56,464" fill="none" stroke="black"></path>
                  <path d="M 104,32 L 104,80" fill="none" stroke="black"></path>
                  <path d="M 256,32 L 256,80" fill="none" stroke="black"></path>
                  <path d="M 304,80 L 304,464" fill="none" stroke="black"></path>
                  <path d="M 352,32 L 352,80" fill="none" stroke="black"></path>
                  <path d="M 552,240 L 552,368" fill="none" stroke="black"></path>
                  <path d="M 8,32 L 104,32" fill="none" stroke="black"></path>
                  <path d="M 256,32 L 352,32" fill="none" stroke="black"></path>
                  <path d="M 8,80 L 104,80" fill="none" stroke="black"></path>
                  <path d="M 256,80 L 352,80" fill="none" stroke="black"></path>
                  <path d="M 64,176 L 296,176" fill="none" stroke="black"></path>
                  <path d="M 56,240 L 296,240" fill="none" stroke="black"></path>
                  <path d="M 304,288 L 544,288" fill="none" stroke="black"></path>
                  <path d="M 312,368 L 544,368" fill="none" stroke="black"></path>
                  <path d="M 64,416 L 296,416" fill="none" stroke="black"></path>
                  <polygon class="arrowhead" points="552,368 540,362.4 540,373.6" fill="black" transform="rotate(0,544,368)"></polygon>
                  <polygon class="arrowhead" points="552,288 540,282.4 540,293.6" fill="black" transform="rotate(0,544,288)"></polygon>
                  <polygon class="arrowhead" points="320,368 308,362.4 308,373.6" fill="black" transform="rotate(180,312,368)"></polygon>
                  <polygon class="arrowhead" points="304,240 292,234.4 292,245.6" fill="black" transform="rotate(0,296,240)"></polygon>
                  <polygon class="arrowhead" points="72,416 60,410.4 60,421.6" fill="black" transform="rotate(180,64,416)"></polygon>
                  <polygon class="arrowhead" points="72,176 60,170.4 60,181.6" fill="black" transform="rotate(180,64,176)"></polygon>
                  <g class="text">
                    <text x="56" y="52">U</text>
                    <text x="304" y="52">V</text>
                    <text x="56" y="68">Initiator</text>
                    <text x="304" y="68">Responder</text>
                    <text x="144" y="116">Trigger</text>
                    <text x="208" y="116">Message</text>
                    <text x="64" y="132">-</text>
                    <text x="80" y="132">-</text>
                    <text x="96" y="132">-</text>
                    <text x="112" y="132">-</text>
                    <text x="128" y="132">-</text>
                    <text x="144" y="132">-</text>
                    <text x="160" y="132">-</text>
                    <text x="176" y="132">-</text>
                    <text x="192" y="132">-</text>
                    <text x="208" y="132">-</text>
                    <text x="224" y="132">-</text>
                    <text x="240" y="132">-</text>
                    <text x="256" y="132">-</text>
                    <text x="272" y="132">-</text>
                    <text x="292" y="132">-&gt;</text>
                    <text x="136" y="164">EDHOC</text>
                    <text x="200" y="164">message_1</text>
                    <text x="136" y="228">EDHOC</text>
                    <text x="200" y="228">message_2</text>
                    <text x="552" y="228">W</text>
                    <text x="88" y="260">EAD_2</text>
                    <text x="120" y="260">=</text>
                    <text x="156" y="260">(TBD1,</text>
                    <text x="240" y="260">Voucher_info)</text>
                    <text x="428" y="276">VREQ</text>
                    <text x="332" y="308">(SS,</text>
                    <text x="372" y="308">G_Y,</text>
                    <text x="448" y="308">Voucher_Info,</text>
                    <text x="344" y="324">TH_2,</text>
                    <text x="428" y="324">?opaque_state)</text>
                    <text x="428" y="356">VRES</text>
                    <text x="376" y="388">(Voucher,</text>
                    <text x="476" y="388">?opaque_state)</text>
                    <text x="120" y="404">EDHOC</text>
                    <text x="184" y="404">message_3</text>
                    <text x="104" y="436">EAD_3</text>
                    <text x="136" y="436">=</text>
                    <text x="172" y="436">(TBD2,</text>
                    <text x="236" y="436">Voucher)</text>
                  </g>
                </svg><a href="#section-4.8.2-5.1.1" class="pilcrow">¶</a>
</div>
</div>
<figcaption><a href="#figure-7" class="selfRef">Figure 7</a>:
<a href="#name-ela-when-u-is-the-edhoc-res" class="selfRef">ELA when U is the EDHOC Responder.</a>
            </figcaption></figure>
</div>
<p id="section-4.8.2-6">The following detail how the processing changes in each of the three security sessions.<a href="#section-4.8.2-6" class="pilcrow">¶</a></p>
<p id="section-4.8.2-7">The way to interpret the subsections below is as follows.
The ELA reverse flow described in this section uses most of the ELA default flow processing (<a href="#protocol-overview" class="auto internal xref">Section 4.1</a> to <a href="#err-handling" class="auto internal xref">Section 4.7</a>), except by the changes detailed in <a href="#reverse-u-w" class="auto internal xref">Section 4.8.2.1</a>,  <a href="#reverse-u-v" class="auto internal xref">Section 4.8.2.2</a>, and  <a href="#reverse-v-w" class="auto internal xref">Section 4.8.2.3</a>.<a href="#section-4.8.2-7" class="pilcrow">¶</a></p>
<div id="reverse-u-w">
<section id="section-4.8.2.1">
            <h5 id="name-reverse-u-w">
<a href="#section-4.8.2.1" class="section-number selfRef">4.8.2.1. </a><a href="#name-reverse-u-w" class="section-name selfRef">Reverse U &lt;-&gt; W</a>
            </h5>
<p id="section-4.8.2.1-1">The protocol between U and W is carried between U and V in message_2 and message_3, and between V and W in the Voucher Request/Response (<a href="#V-W" class="auto internal xref">Section 4.6</a>).<a href="#section-4.8.2.1-1" class="pilcrow">¶</a></p>
<p id="section-4.8.2.1-2">Voucher Info:<a href="#section-4.8.2.1-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.8.2.1-3.1">
                <p id="section-4.8.2.1-3.1.1">The EAD_2 item has ead_label = TBD1 and ead_value = Voucher_Info.<a href="#section-4.8.2.1-3.1.1" class="pilcrow">¶</a></p>
</li>
            </ul>
<p id="section-4.8.2.1-4">Voucher:<a href="#section-4.8.2.1-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.8.2.1-5.1">
                <p id="section-4.8.2.1-5.1.1">H_handshake is the transcript hash TH_2, sent by V as part of the voucher request, see <a href="#reverse-v-w" class="auto internal xref">Section 4.8.2.3</a>.<a href="#section-4.8.2.1-5.1.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</section>
</div>
<div id="reverse-u-v">
<section id="section-4.8.2.2">
            <h5 id="name-reverse-u-v">
<a href="#section-4.8.2.2" class="section-number selfRef">4.8.2.2. </a><a href="#name-reverse-u-v" class="section-name selfRef">Reverse U &lt;-&gt; V</a>
            </h5>
<p id="section-4.8.2.2-1">Message 1:<a href="#section-4.8.2.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.8.2.2-2.1">
                <p id="section-4.8.2.2-2.1.1">V composes message_1 and sends it to U.<a href="#section-4.8.2.2-2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-4.8.2.2-2.2">
                <p id="section-4.8.2.2-2.2.1">U processes message_1 and extracts SS.<a href="#section-4.8.2.2-2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
<p id="section-4.8.2.2-3">Message 2:<a href="#section-4.8.2.2-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.8.2.2-4.1">
                <p id="section-4.8.2.2-4.1.1">U composes message_2 and generates G_Y, which is reused in the interaction with W.<a href="#section-4.8.2.2-4.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-4.8.2.2-4.2">
                <p id="section-4.8.2.2-4.2.1">U sends message_2 with EAD item (-TBD1, Voucher_Info) included in EAD_2.<a href="#section-4.8.2.2-4.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-4.8.2.2-4.3">
                <p id="section-4.8.2.2-4.3.1">V processes message_2 and the EAD item in EAD_2, extracting the Voucher_Info struct.<a href="#section-4.8.2.2-4.3.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-4.8.2.2-4.4">
                <p id="section-4.8.2.2-4.4.1">V sends the voucher request to W.<a href="#section-4.8.2.2-4.4.1" class="pilcrow">¶</a></p>
</li>
            </ul>
<p id="section-4.8.2.2-5">Message 3:<a href="#section-4.8.2.2-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.8.2.2-6.1">
                <p id="section-4.8.2.2-6.1.1">V receives the voucher response from W.<a href="#section-4.8.2.2-6.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-4.8.2.2-6.2">
                <p id="section-4.8.2.2-6.2.1">V sends message_3 with EAD item (-TBD2, Voucher) included in EAD_3.<a href="#section-4.8.2.2-6.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-4.8.2.2-6.3">
                <p id="section-4.8.2.2-6.3.1">Y processes message_3 and the EAD item in EAD_3.<a href="#section-4.8.2.2-6.3.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</section>
</div>
<div id="reverse-v-w">
<section id="section-4.8.2.3">
            <h5 id="name-reverse-v-w">
<a href="#section-4.8.2.3" class="section-number selfRef">4.8.2.3. </a><a href="#name-reverse-v-w" class="section-name selfRef">Reverse V &lt;-&gt; W</a>
            </h5>
<p id="section-4.8.2.3-1">Processing in V:<a href="#section-4.8.2.3-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.8.2.3-2.1">
                <p id="section-4.8.2.3-2.1.1">The Voucher_Request fields are prepared as defined in <a href="#voucher_request" class="auto internal xref">Section 4.6.1</a>, with the following changes:<a href="#section-4.8.2.3-2.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.8.2.3-2.1.2.1">
                    <p id="section-4.8.2.3-2.1.2.1.1">G_U is set to G_Y, which is the ephemeral public key of U as extracted from message_2.<a href="#section-4.8.2.3-2.1.2.1.1" class="pilcrow">¶</a></p>
</li>
                  <li class="normal" id="section-4.8.2.3-2.1.2.2">
                    <p id="section-4.8.2.3-2.1.2.2.1">Voucher_Info is as extracted from the EAD_2 field of message_2.<a href="#section-4.8.2.3-2.1.2.2.1" class="pilcrow">¶</a></p>
</li>
                  <li class="normal" id="section-4.8.2.3-2.1.2.3">
                    <p id="section-4.8.2.3-2.1.2.3.1">H_handshake is the transcript hash TH_2, computed by V as specified in <span><a href="https://rfc-editor.org/rfc/rfc9528#section-5.3.2" class="relref">Section 5.3.2</a> of [<a href="#RFC9528" class="cite xref">RFC9528</a>]</span>.<a href="#section-4.8.2.3-2.1.2.3.1" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
            </ul>
<p id="section-4.8.2.3-3">Processing in W happens as specified in <a href="#voucher_request" class="auto internal xref">Section 4.6.1</a>.<a href="#section-4.8.2.3-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="interoperability-considerations">
<section id="section-4.8.3">
          <h4 id="name-interoperability-considerat">
<a href="#section-4.8.3" class="section-number selfRef">4.8.3. </a><a href="#name-interoperability-considerat" class="section-name selfRef">Interoperability considerations</a>
          </h4>
<p id="section-4.8.3-1">A Device (U) MUST implement one of the ELA flows, and it MAY choose to implement both.<a href="#section-4.8.3-1" class="pilcrow">¶</a></p>
<p id="section-4.8.3-2">V MUST support the regular flow and MAY support the reverse flow.<a href="#section-4.8.3-2" class="pilcrow">¶</a></p>
<p id="section-4.8.3-3">From the point of view of W, there is no difference whether U and V run as EDHOC Initiator or Responder.<a href="#section-4.8.3-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="security-implications">
<section id="section-4.8.4">
          <h4 id="name-security-implications">
<a href="#section-4.8.4" class="section-number selfRef">4.8.4. </a><a href="#name-security-implications" class="section-name selfRef">Security implications</a>
          </h4>
<p id="section-4.8.4-1">When using the reverse flow, U shares its identity before it can learn (1) V's identity and (2) whether or not the Voucher is valid.<a href="#section-4.8.4-1" class="pilcrow">¶</a></p>
<p id="section-4.8.4-2">In the reverse flow, Voucher_Info is confidentiality and integrity protected, while Voucher is also authenticated.
These properties are inherited from EDHOC message_2 and message_3.
This is a higher level of protection than with the regular flow.<a href="#section-4.8.4-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="rest_interface">
<section id="section-5">
      <h2 id="name-rest-interface-at-w">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-rest-interface-at-w" class="section-name selfRef">REST Interface at W</a>
      </h2>
<p id="section-5-1">The interaction between V and W is enabled through a RESTful interface exposed by W.
This RESTful interface MAY be implemented using either HTTP or CoAP.
V SHOULD access the resources exposed by W through the protocol indicated by the scheme in the LOC_W URI.<a href="#section-5-1" class="pilcrow">¶</a></p>
<div id="scheme-https">
<section id="section-5.1">
        <h3 id="name-scheme-https">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-scheme-https" class="section-name selfRef">Scheme "https"</a>
        </h3>
<p id="section-5.1-1">In case the scheme indicates "https", V MUST perform a TLS handshake with W and access the resources defined in <a href="#uris" class="auto internal xref">Section 5.4</a> using HTTP.
If the authentication credential CRED_V can be used in a TLS handshake, e.g., an X.509 certificate of a signature public key, then V SHOULD use it to authenticate to W as a client.
If the authentication credential CRED_V cannot be used in a TLS handshake, e.g., if the public key is a static Diffie-Hellman key, then V SHOULD first perform a TLS handshake with W using available compatible keys.
V MUST then perform an EDHOC session over the TLS connection proving to W the possession of the private key corresponding to CRED_V.
Performing the EDHOC session is only necessary if V did not authenticate with CRED_V in the TLS handshake with W.<a href="#section-5.1-1" class="pilcrow">¶</a></p>
<p id="section-5.1-2">The relationship between V and W is long-lived.  HTTP/1.1 and higher support persistent connections, and SHOULD be used in order to reduce overhead if a flood of new devices need to be onboarded.  Support for TLS session resumptions tickets <span>[<a href="#RFC8446" class="cite xref">RFC8446</a>], <a href="https://rfc-editor.org/rfc/rfc8446#section-2.2" class="relref">Section 2.2</a></span> is appropriate for longer term associations.
While a policy for renewal of the TLS connection should be applied, it is out of scope of this document.<a href="#section-5.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="scheme-coaps">
<section id="section-5.2">
        <h3 id="name-scheme-coaps">
<a href="#section-5.2" class="section-number selfRef">5.2. </a><a href="#name-scheme-coaps" class="section-name selfRef">Scheme "coaps"</a>
        </h3>
<p id="section-5.2-1">In case the scheme indicates "coaps", V SHOULD perform a DTLS handshake with W and access the resources defined in <a href="#uris" class="auto internal xref">Section 5.4</a> using CoAP.
The normative requirements in <a href="#scheme-https" class="auto internal xref">Section 5.1</a> on performing the DTLS handshake and EDHOC session remain the same, except that TLS is replaced with DTLS.
As in <a href="#scheme-https" class="auto internal xref">Section 5.1</a>, it is RECOMMENDED to allow reuse of the DTLS session.<a href="#section-5.2-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="scheme-coap">
<section id="section-5.3">
        <h3 id="name-scheme-coap">
<a href="#section-5.3" class="section-number selfRef">5.3. </a><a href="#name-scheme-coap" class="section-name selfRef">Scheme "coap"</a>
        </h3>
<p id="section-5.3-1">In case the scheme indicates "coap", V SHOULD perform an EDHOC session with W, as specified in <span><a href="https://rfc-editor.org/rfc/rfc9528#appendix-A" class="relref">Appendix A</a> of [<a href="#RFC9528" class="cite xref">RFC9528</a>]</span> and access the resources defined in <a href="#uris" class="auto internal xref">Section 5.4</a> using OSCORE and CoAP.
The authentication credential in this EDHOC session MUST be CRED_V.
As in <a href="#scheme-https" class="auto internal xref">Section 5.1</a>, it is RECOMMENDED to allow reuse of the EDHOC session.<a href="#section-5.3-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="uris">
<section id="section-5.4">
        <h3 id="name-uris">
<a href="#section-5.4" class="section-number selfRef">5.4. </a><a href="#name-uris" class="section-name selfRef">URIs</a>
        </h3>
<p id="section-5.4-1">The URIs defined below are valid for both HTTP and CoAP.
W MUST support the use of the path-prefix "/.well-known/", as defined in <span>[<a href="#RFC8615" class="cite xref">RFC8615</a>]</span>, and the registered name "lake-authz".
A valid URI in case of HTTP thus begins with<a href="#section-5.4-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.4-2.1">
            <p id="section-5.4-2.1.1">"https://www.example.com/.well-known/lake-authz"<a href="#section-5.4-2.1.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-5.4-3">In case of CoAP with DTLS:<a href="#section-5.4-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.4-4.1">
            <p id="section-5.4-4.1.1">"coaps://example.com/.well-known/lake-authz"<a href="#section-5.4-4.1.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-5.4-5">In case of EDHOC and OSCORE:<a href="#section-5.4-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.4-6.1">
            <p id="section-5.4-6.1.1">"coap://example.com/.well-known/lake-authz"<a href="#section-5.4-6.1.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-5.4-7">Each operation specified in the following is indicated by a path-suffix.<a href="#section-5.4-7" class="pilcrow">¶</a></p>
<div id="rest-voucher-request">
<section id="section-5.4.1">
          <h4 id="name-voucher-request-voucherrequ">
<a href="#section-5.4.1" class="section-number selfRef">5.4.1. </a><a href="#name-voucher-request-voucherrequ" class="section-name selfRef">Voucher Request (/voucherrequest)</a>
          </h4>
<p id="section-5.4.1-1">To request a voucher, V MUST issue a request such that:<a href="#section-5.4.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.4.1-2.1">
              <p id="section-5.4.1-2.1.1">Method is POST<a href="#section-5.4.1-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-5.4.1-2.2">
              <p id="section-5.4.1-2.2.1">Payload is the serialization of the Voucher Request object, as specified in <a href="#voucher_request" class="auto internal xref">Section 4.6.1</a>.<a href="#section-5.4.1-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-5.4.1-2.3">
              <p id="section-5.4.1-2.3.1">Content-Format (Content-Type) is set to "application/lake-authz-voucherrequest+cbor"<a href="#section-5.4.1-2.3.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-5.4.1-3">In case of successful processing at W, W MUST issue a response such that:<a href="#section-5.4.1-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.4.1-4.1">
              <p id="section-5.4.1-4.1.1">Status code is 200 OK if using HTTP, or 2.04 Changed if using CoAP<a href="#section-5.4.1-4.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-5.4.1-4.2">
              <p id="section-5.4.1-4.2.1">Payload is the serialized Voucher Response object, as specified in <a href="#voucher_response" class="auto internal xref">Section 4.6.2</a><a href="#section-5.4.1-4.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-5.4.1-4.3">
              <p id="section-5.4.1-4.3.1">Content-Format (Content-Type) is set to "application/lake-authz-voucherresponse+cbor"<a href="#section-5.4.1-4.3.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-5.4.1-5">In case of error, two cases should be considered:<a href="#section-5.4.1-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.4.1-6.1">
              <p id="section-5.4.1-6.1.1">U cannot be identified: this happens either if W fails to process the Voucher Request, or if it succeeds but ID_U is considered unknown to W. In this case, W MUST reply with 400 Bad Request if using HTTP, or 4.00 if using CoAP.<a href="#section-5.4.1-6.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-5.4.1-6.2">
              <p id="section-5.4.1-6.2.1">U is identified but unauthorized: this happens if W is able to process the Voucher Request, and W recognizes ID_U as a known device, but the access policies forbid enrollment. For example, the policy could enforce enrollment within a delimited time window, via a specific V, etc. In this case, W MUST reply with a 403 Forbidden code if using HTTP, or 4.03 if using CoAP; the payload is the serialized error_content object, with Content-Format (Content-Type) set to "application/lake-authz-vouchererror+cbor". The payload MAY be used by V to prepare an EDHOC error "Access Denied", see <a href="#err-handling" class="auto internal xref">Section 4.7</a>.<a href="#section-5.4.1-6.2.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</section>
</div>
<div id="certificate-request-certrequest">
<section id="section-5.4.2">
          <h4 id="name-certificate-request-certreq">
<a href="#section-5.4.2" class="section-number selfRef">5.4.2. </a><a href="#name-certificate-request-certreq" class="section-name selfRef">Certificate Request (/certrequest)</a>
          </h4>
<p id="section-5.4.2-1">V requests the public key certificate of U from W through the "/certrequest" path-suffix.
To request U's authentication credential, V MUST issue a request such that:<a href="#section-5.4.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.4.2-2.1">
              <p id="section-5.4.2-2.1.1">Method is POST<a href="#section-5.4.2-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-5.4.2-2.2">
              <p id="section-5.4.2-2.2.1">Payload is the serialization of the ID_CRED_I object, as received in EDHOC message_3.<a href="#section-5.4.2-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-5.4.2-2.3">
              <p id="section-5.4.2-2.3.1">Content-Format (Content-Type) is set to "application/lake-authz-certrequest+cbor"<a href="#section-5.4.2-2.3.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-5.4.2-3">In case of a successful lookup of the authentication credential at W, W MUST issue a response such that:<a href="#section-5.4.2-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.4.2-4.1">
              <p id="section-5.4.2-4.1.1">Status code is 200 OK if using HTTP, or 2.04 Changed if using CoAP<a href="#section-5.4.2-4.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-5.4.2-4.2">
              <p id="section-5.4.2-4.2.1">Payload is the serialized CRED_U<a href="#section-5.4.2-4.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-5.4.2-4.3">
              <p id="section-5.4.2-4.3.1">Content-Format (Content-Type) is set to "application/lake-authz-certresponse+cbor"<a href="#section-5.4.2-4.3.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="sec-cons">
<section id="section-6">
      <h2 id="name-security-considerations">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-6-1">This specification builds on and reuses many of the security constructions of EDHOC, e.g., shared secret calculation and key derivation. The security considerations of EDHOC <span>[<a href="#RFC9528" class="cite xref">RFC9528</a>]</span> apply with modifications discussed here.<a href="#section-6-1" class="pilcrow">¶</a></p>
<p id="section-6-2">EDHOC provides identity protection of the Initiator, here the device. The encryption of the device identifier ID_U in the first message should consider potential information leaking from the length of ID_U, either by making all identifiers having the same length or the use of a padding scheme.<a href="#section-6-2" class="pilcrow">¶</a></p>
<p id="section-6-3">Although W learns about the identity of U after receiving VREQ, this information must not be disclosed to V, until U has revealed its identity to V with ID_CRED_I in message_3. W may be used for lookup of CRED_U from ID_CRED_I, or this credential lookup function may be separate from the authorization function of W, see <a href="#fig-protocol" class="auto internal xref">Figure 3</a>. The trust model used here is that U decides to which V it reveals its identity. In an alternative trust model where U trusts W to decide to which V it reveals U's identity, CRED_U could be sent in Voucher Response.<a href="#section-6-3" class="pilcrow">¶</a></p>
<p id="section-6-4">As noted in <span><a href="https://rfc-editor.org/rfc/rfc9528#section-9.2" class="relref">Section 9.2</a> of [<a href="#RFC9528" class="cite xref">RFC9528</a>]</span> an ephemeral key may be used to calculate several ECDH shared secrets. In this specification, the ephemeral key G_X is also used to calculate G_XW, the shared secret with the enrollment server.<a href="#section-6-4" class="pilcrow">¶</a></p>
<p id="section-6-5">The private ephemeral key is thus used in the device for calculations of key material relating to both the authenticator and the enrollment server. There are different options for where to implement these calculations. One option is as an addition to EDHOC, i.e., to extend the EDHOC API in the device, so that EDHOC can import the public key of W (G_W) and the device identifier of U (ID_U), and then produce the encryption of ID_U which is included in Voucher_Info in EAD_1.<a href="#section-6-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="iana">
<section id="section-7">
      <h2 id="name-iana-considerations">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<div id="iana-ead">
<section id="section-7.1">
        <h3 id="name-edhoc-external-authorizatio">
<a href="#section-7.1" class="section-number selfRef">7.1. </a><a href="#name-edhoc-external-authorizatio" class="section-name selfRef">EDHOC External Authorization Data Registry</a>
        </h3>
<p id="section-7.1-1">IANA has registered the following entries in the "EDHOC External Authorization Data" registry under the group name "Ephemeral Diffie-
   Hellman Over COSE (EDHOC)".<a href="#section-7.1-1" class="pilcrow">¶</a></p>
<span id="name-addition-to-the-edhoc-ead-r"></span><div id="ead-table">
<table class="center" id="table-2">
          <caption>
<a href="#table-2" class="selfRef">Table 2</a>:
<a href="#name-addition-to-the-edhoc-ead-r" class="selfRef">Addition to the EDHOC EAD registry</a>
          </caption>
<thead>
            <tr>
              <th class="text-right" rowspan="1" colspan="1">Label</th>
              <th class="text-left" rowspan="1" colspan="1">Value Type</th>
              <th class="text-left" rowspan="1" colspan="1">Description</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-right" rowspan="1" colspan="1">TBD1</td>
              <td class="text-left" rowspan="1" colspan="1">bstr</td>
              <td class="text-left" rowspan="1" colspan="1">Voucher_Info structure, prepared by the Device (U).</td>
            </tr>
            <tr>
              <td class="text-right" rowspan="1" colspan="1">TBD2</td>
              <td class="text-left" rowspan="1" colspan="1">bstr</td>
              <td class="text-left" rowspan="1" colspan="1">Voucher structure, prepared by the Enrollment Server (W).</td>
            </tr>
          </tbody>
        </table>
</div>
<p id="section-7.1-3">The ead_label = TBD1 corresponds to the ead_value = Voucher_Info, which can be carried in either EAD_1 or EAD_2, depending on whether U acts as EDHOC Initiator or Responder, see <a href="#reverse-u-responder" class="auto internal xref">Section 4.8</a>.<a href="#section-7.1-3" class="pilcrow">¶</a></p>
<p id="section-7.1-4">The ead_label = TBD2 corresponds to ead_value = Voucher, and can be carried in either EAD_2 or EAD_3, see <a href="#reverse-u-responder" class="auto internal xref">Section 4.8</a>.<a href="#section-7.1-4" class="pilcrow">¶</a></p>
<p id="section-7.1-5">Note for IANA reviewers: the preferred value range is 0-23 (Standards Action with Expert Review).<a href="#section-7.1-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="the-well-known-uri-registry">
<section id="section-7.2">
        <h3 id="name-the-well-known-uri-registry">
<a href="#section-7.2" class="section-number selfRef">7.2. </a><a href="#name-the-well-known-uri-registry" class="section-name selfRef">The Well-Known URI Registry</a>
        </h3>
<p id="section-7.2-1">IANA has registered the following entry in "The Well-Known URI Registry", using the template from <span>[<a href="#RFC8615" class="cite xref">RFC8615</a>]</span>:<a href="#section-7.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.2-2.1">
            <p id="section-7.2-2.1.1">URI suffix: lake-authz<a href="#section-7.2-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-7.2-2.2">
            <p id="section-7.2-2.2.1">Change controller: IETF<a href="#section-7.2-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-7.2-2.3">
            <p id="section-7.2-2.3.1">Specification document: [[this document]]<a href="#section-7.2-2.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-7.2-2.4">
            <p id="section-7.2-2.4.1">Status: permanent<a href="#section-7.2-2.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-7.2-2.5">
            <p id="section-7.2-2.5.1">Related information: None<a href="#section-7.2-2.5.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="well-known-name-under-arpa-name-space">
<section id="section-7.3">
        <h3 id="name-well-known-name-under-arpa-">
<a href="#section-7.3" class="section-number selfRef">7.3. </a><a href="#name-well-known-name-under-arpa-" class="section-name selfRef">Well-Known Name Under ".arpa" Name Space</a>
        </h3>
<p id="section-7.3-1">This document allocates a well-known name under the .arpa name space according to the rules given in <span>[<a href="#RFC3172" class="cite xref">RFC3172</a>]</span> and <span>[<a href="#RFC6761" class="cite xref">RFC6761</a>]</span>.
The name "lake-authz.arpa" is requested.
No subdomains are expected, and addition of any such subdomains requires the publication of an IETF Standards Track RFC.
No A, AAAA, or PTR record is requested.<a href="#section-7.3-1" class="pilcrow">¶</a></p>
<div id="domain-name-reservation-considerations">
<section id="section-7.3.1">
          <h4 id="name-domain-name-reservation-con">
<a href="#section-7.3.1" class="section-number selfRef">7.3.1. </a><a href="#name-domain-name-reservation-con" class="section-name selfRef">Domain Name Reservation Considerations</a>
          </h4>
<p id="section-7.3.1-1">As required by <span>[<a href="#RFC6761" class="cite xref">RFC6761</a>]</span>, the following considerations apply to the reservation of "lake-authz.arpa":<a href="#section-7.3.1-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-7.3.1-2">
<li id="section-7.3.1-2.1">
              <p id="section-7.3.1-2.1.1">Users:
Are human users expected to recognize these names as special and use them differently? In what way?<a href="#section-7.3.1-2.1.1" class="pilcrow">¶</a></p>
</li>
          </ol>
<p id="section-7.3.1-3">No. This name is not intended for direct use or recognition by human users.<a href="#section-7.3.1-3" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-7.3.1-4">
<li id="section-7.3.1-4.1">
              <p id="section-7.3.1-4.1.1">Application Software:
Are writers of application software expected to make their software recognize these names as special and treat them differently? In what way? (For example, if a human user enters such a name, should the application software reject it with an error message?)<a href="#section-7.3.1-4.1.1" class="pilcrow">¶</a></p>
</li>
          </ol>
<p id="section-7.3.1-5">Yes. Applications that implement ELA and use CoAP may include "lake-authz.arpa" in the URI-Host option when the Device (U) does not yet know the address or identity of the Authenticator (V), such as during zero-touch enrollment.<a href="#section-7.3.1-5" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-7.3.1-6">
<li id="section-7.3.1-6.1">
              <p id="section-7.3.1-6.1.1">Name Resolution APIs and Libraries:
Are writers of name resolution APIs and libraries expected to make their software recognize these names as special and treat them differently? If so, how?<a href="#section-7.3.1-6.1.1" class="pilcrow">¶</a></p>
</li>
          </ol>
<p id="section-7.3.1-7">No.<a href="#section-7.3.1-7" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-7.3.1-8">
<li id="section-7.3.1-8.1">
              <p id="section-7.3.1-8.1.1">Caching DNS Servers:
Are developers of caching domain name servers expected to make their implementations recognize these names as special and treat them differently? If so, how?<a href="#section-7.3.1-8.1.1" class="pilcrow">¶</a></p>
</li>
          </ol>
<p id="section-7.3.1-9">No.<a href="#section-7.3.1-9" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-7.3.1-10">
<li id="section-7.3.1-10.1">
              <p id="section-7.3.1-10.1.1">Authoritative DNS Servers:
Are developers of authoritative domain name servers expected to make their implementations recognize these names as special and treat them differently? If so, how?<a href="#section-7.3.1-10.1.1" class="pilcrow">¶</a></p>
</li>
          </ol>
<p id="section-7.3.1-11">No.<a href="#section-7.3.1-11" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-7.3.1-12">
<li id="section-7.3.1-12.1">
              <p id="section-7.3.1-12.1.1">DNS Server Operators:
Does this reserved Special-Use Domain Name have any potential impact on DNS server operators? If they try to configure their authoritative DNS server as authoritative for this reserved name, will compliant name server software reject it as invalid? Do DNS server operators need to know about that and understand why? Even if the name server software doesn't prevent them from using this reserved name, are there other ways that it may not work as expected, of which the DNS server operator should be aware?<a href="#section-7.3.1-12.1.1" class="pilcrow">¶</a></p>
</li>
          </ol>
<p id="section-7.3.1-13">No.<a href="#section-7.3.1-13" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-7.3.1-14">
<li id="section-7.3.1-14.1">
              <p id="section-7.3.1-14.1.1">DNS Registries/Registrars:
How should DNS Registries/Registrars treat requests to register this reserved domain name? Should such requests be denied? Should such requests be allowed, but only to a specially designated entity? (For example, the name "www.example.org" is reserved for documentation examples and is not available for registration; however, the name is in fact registered; and there is even a website at that name, which states circularly that the name is reserved for use in documentation and cannot be registered!)<a href="#section-7.3.1-14.1.1" class="pilcrow">¶</a></p>
</li>
          </ol>
<p id="section-7.3.1-15">Any requests to register this domain name should be denied.<a href="#section-7.3.1-15" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="media-types-registry">
<section id="section-7.4">
        <h3 id="name-media-types-registry">
<a href="#section-7.4" class="section-number selfRef">7.4. </a><a href="#name-media-types-registry" class="section-name selfRef">Media Types Registry</a>
        </h3>
<p id="section-7.4-1">IANA has added the media types "application/lake-authz-voucherrequest+cbor" to the "Media Types" registry.<a href="#section-7.4-1" class="pilcrow">¶</a></p>
<div id="applicationlake-authz-voucherrequestcbor-media-type-registration">
<section id="section-7.4.1">
          <h4 id="name-application-lake-authz-vouc">
<a href="#section-7.4.1" class="section-number selfRef">7.4.1. </a><a href="#name-application-lake-authz-vouc" class="section-name selfRef">application/lake-authz-voucherrequest+cbor Media Type Registration</a>
          </h4>
<ul class="normal">
<li class="normal" id="section-7.4.1-1.1">
              <p id="section-7.4.1-1.1.1">Type name: application<a href="#section-7.4.1-1.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-7.4.1-1.2">
              <p id="section-7.4.1-1.2.1">Subtype name: lake-authz-voucherrequest+cbor<a href="#section-7.4.1-1.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-7.4.1-1.3">
              <p id="section-7.4.1-1.3.1">Required parameters: N/A<a href="#section-7.4.1-1.3.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-7.4.1-1.4">
              <p id="section-7.4.1-1.4.1">Optional parameters: N/A<a href="#section-7.4.1-1.4.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-7.4.1-1.5">
              <p id="section-7.4.1-1.5.1">Encoding considerations: binary (CBOR)<a href="#section-7.4.1-1.5.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-7.4.1-1.6">
              <p id="section-7.4.1-1.6.1">Security considerations: See <a href="#sec-cons" class="auto internal xref">Section 6</a> of this document.<a href="#section-7.4.1-1.6.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-7.4.1-1.7">
              <p id="section-7.4.1-1.7.1">Interoperability considerations: N/A<a href="#section-7.4.1-1.7.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-7.4.1-1.8">
              <p id="section-7.4.1-1.8.1">Published specification: [[this document]] (this document)<a href="#section-7.4.1-1.8.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-7.4.1-1.9">
              <p id="section-7.4.1-1.9.1">Application that use this media type: To be identified<a href="#section-7.4.1-1.9.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-7.4.1-1.10">
              <p id="section-7.4.1-1.10.1">Fragment identifier considerations: N/A<a href="#section-7.4.1-1.10.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-7.4.1-1.11">
              <p id="section-7.4.1-1.11.1">Additional information:<a href="#section-7.4.1-1.11.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.4.1-1.11.2.1">
                  <p id="section-7.4.1-1.11.2.1.1">Magic number(s): N/A<a href="#section-7.4.1-1.11.2.1.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-7.4.1-1.11.2.2">
                  <p id="section-7.4.1-1.11.2.2.1">File extension(s): N/A<a href="#section-7.4.1-1.11.2.2.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-7.4.1-1.11.2.3">
                  <p id="section-7.4.1-1.11.2.3.1">Macintosh file type code(s): N/A<a href="#section-7.4.1-1.11.2.3.1" class="pilcrow">¶</a></p>
</li>
              </ul>
</li>
            <li class="normal" id="section-7.4.1-1.12">
              <p id="section-7.4.1-1.12.1">Person &amp; email address to contact for further information: IETF LAKE Working Group (lake@ietf.org)<a href="#section-7.4.1-1.12.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-7.4.1-1.13">
              <p id="section-7.4.1-1.13.1">Intended usage: COMMON<a href="#section-7.4.1-1.13.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-7.4.1-1.14">
              <p id="section-7.4.1-1.14.1">Restrictions on usage: N/A<a href="#section-7.4.1-1.14.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-7.4.1-1.15">
              <p id="section-7.4.1-1.15.1">Author: LAKE WG<a href="#section-7.4.1-1.15.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-7.4.1-1.16">
              <p id="section-7.4.1-1.16.1">Change Controller: IETF<a href="#section-7.4.1-1.16.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</section>
</div>
</section>
</div>
<div id="coap-content-formats-registry">
<section id="section-7.5">
        <h3 id="name-coap-content-formats-regist">
<a href="#section-7.5" class="section-number selfRef">7.5. </a><a href="#name-coap-content-formats-regist" class="section-name selfRef">CoAP Content-Formats Registry</a>
        </h3>
<p id="section-7.5-1">IANA has added the following Content-Format number in the "CoAP Content-Formats" registry under the registry group "Constrained RESTful Environments (CoRE) Parameters".<a href="#section-7.5-1" class="pilcrow">¶</a></p>
<span id="name-addition-to-the-coap-conten"></span><div id="coap-content-formats">
<table class="center" id="table-3">
          <caption>
<a href="#table-3" class="selfRef">Table 3</a>:
<a href="#name-addition-to-the-coap-conten" class="selfRef">Addition to the CoAP Content-Formats registry</a>
          </caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">Content Type</th>
              <th class="text-left" rowspan="1" colspan="1">Content Encoding</th>
              <th class="text-left" rowspan="1" colspan="1">ID</th>
              <th class="text-left" rowspan="1" colspan="1">Reference</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">application/lake-authz-voucherrequest+cbor</td>
              <td class="text-left" rowspan="1" colspan="1">-</td>
              <td class="text-left" rowspan="1" colspan="1">TBD3</td>
              <td class="text-left" rowspan="1" colspan="1">[[this document]]</td>
            </tr>
          </tbody>
        </table>
</div>
<p id="section-7.5-3">Note for IANA reviewers: the preferred value range is 0-255 (Expert Review).<a href="#section-7.5-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="sec-combined-references">
<section id="section-8">
      <h2 id="name-references">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<div id="sec-normative-references">
<section id="section-8.1">
        <h3 id="name-normative-references">
<a href="#section-8.1" class="section-number selfRef">8.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="NIST-800-56A">[NIST-800-56A]</dt>
        <dd>
<span class="refAuthor">Barker, E.</span>, <span class="refAuthor">Chen, L.</span>, <span class="refAuthor">Roginsky, A.</span>, <span class="refAuthor">Vassilev, A.</span>, and <span class="refAuthor">R. Davis</span>, <span class="refTitle">"Recommendation for Pair-Wise Key-Establishment Schemes Using Discrete Logarithm Cryptography - NIST Special Publication 800-56A, Revision 3"</span>, <time datetime="2018-04" class="refDate">April 2018</time>, <span>&lt;<a href="https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-56Ar3.pdf">https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-56Ar3.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8366">[RFC8366]</dt>
        <dd>
<span class="refAuthor">Watsen, K.</span>, <span class="refAuthor">Richardson, M.</span>, <span class="refAuthor">Pritikin, M.</span>, and <span class="refAuthor">T. Eckert</span>, <span class="refTitle">"A Voucher Artifact for Bootstrapping Protocols"</span>, <span class="seriesInfo">RFC 8366</span>, <span class="seriesInfo">DOI 10.17487/RFC8366</span>, <time datetime="2018-05" class="refDate">May 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8366">https://www.rfc-editor.org/info/rfc8366</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8392">[RFC8392]</dt>
        <dd>
<span class="refAuthor">Jones, M.</span>, <span class="refAuthor">Wahlstroem, E.</span>, <span class="refAuthor">Erdtman, S.</span>, and <span class="refAuthor">H. Tschofenig</span>, <span class="refTitle">"CBOR Web Token (CWT)"</span>, <span class="seriesInfo">RFC 8392</span>, <span class="seriesInfo">DOI 10.17487/RFC8392</span>, <time datetime="2018-05" class="refDate">May 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8392">https://www.rfc-editor.org/info/rfc8392</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8613">[RFC8613]</dt>
        <dd>
<span class="refAuthor">Selander, G.</span>, <span class="refAuthor">Mattsson, J.</span>, <span class="refAuthor">Palombini, F.</span>, and <span class="refAuthor">L. Seitz</span>, <span class="refTitle">"Object Security for Constrained RESTful Environments (OSCORE)"</span>, <span class="seriesInfo">RFC 8613</span>, <span class="seriesInfo">DOI 10.17487/RFC8613</span>, <time datetime="2019-07" class="refDate">July 2019</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8613">https://www.rfc-editor.org/info/rfc8613</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8949">[RFC8949]</dt>
        <dd>
<span class="refAuthor">Bormann, C.</span> and <span class="refAuthor">P. Hoffman</span>, <span class="refTitle">"Concise Binary Object Representation (CBOR)"</span>, <span class="seriesInfo">STD 94</span>, <span class="seriesInfo">RFC 8949</span>, <span class="seriesInfo">DOI 10.17487/RFC8949</span>, <time datetime="2020-12" class="refDate">December 2020</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8949">https://www.rfc-editor.org/info/rfc8949</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9052">[RFC9052]</dt>
        <dd>
<span class="refAuthor">Schaad, J.</span>, <span class="refTitle">"CBOR Object Signing and Encryption (COSE): Structures and Process"</span>, <span class="seriesInfo">STD 96</span>, <span class="seriesInfo">RFC 9052</span>, <span class="seriesInfo">DOI 10.17487/RFC9052</span>, <time datetime="2022-08" class="refDate">August 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9052">https://www.rfc-editor.org/info/rfc9052</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9528">[RFC9528]</dt>
      <dd>
<span class="refAuthor">Selander, G.</span>, <span class="refAuthor">Preuß Mattsson, J.</span>, and <span class="refAuthor">F. Palombini</span>, <span class="refTitle">"Ephemeral Diffie-Hellman Over COSE (EDHOC)"</span>, <span class="seriesInfo">RFC 9528</span>, <span class="seriesInfo">DOI 10.17487/RFC9528</span>, <time datetime="2024-03" class="refDate">March 2024</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9528">https://www.rfc-editor.org/info/rfc9528</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
<div id="sec-informative-references">
<section id="section-8.2">
        <h3 id="name-informative-references">
<a href="#section-8.2" class="section-number selfRef">8.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="I-D.amsuess-core-coap-over-gatt">[I-D.amsuess-core-coap-over-gatt]</dt>
        <dd>
<span class="refAuthor">Amsüss, C.</span>, <span class="refTitle">"CoAP over GATT (Bluetooth Low Energy Generic Attributes)"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-amsuess-core-coap-over-gatt-07</span>, <time datetime="2024-09-25" class="refDate">25 September 2024</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-amsuess-core-coap-over-gatt-07">https://datatracker.ietf.org/doc/html/draft-amsuess-core-coap-over-gatt-07</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-core-oscore-edhoc">[I-D.ietf-core-oscore-edhoc]</dt>
        <dd>
<span class="refAuthor">Palombini, F.</span>, <span class="refAuthor">Tiloca, M.</span>, <span class="refAuthor">Höglund, R.</span>, <span class="refAuthor">Hristozov, S.</span>, and <span class="refAuthor">G. Selander</span>, <span class="refTitle">"Using Ephemeral Diffie-Hellman Over COSE (EDHOC) with the Constrained Application Protocol (CoAP) and Object Security for Constrained RESTful Environments (OSCORE)"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-core-oscore-edhoc-11</span>, <time datetime="2024-04-09" class="refDate">9 April 2024</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-core-oscore-edhoc-11">https://datatracker.ietf.org/doc/html/draft-ietf-core-oscore-edhoc-11</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-lake-reqs">[I-D.ietf-lake-reqs]</dt>
        <dd>
<span class="refAuthor">Vučinić, M.</span>, <span class="refAuthor">Selander, G.</span>, <span class="refAuthor">Mattsson, J. P.</span>, and <span class="refAuthor">D. Garcia-Carillo</span>, <span class="refTitle">"Requirements for a Lightweight AKE for OSCORE"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-lake-reqs-04</span>, <time datetime="2020-06-08" class="refDate">8 June 2020</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-lake-reqs-04">https://datatracker.ietf.org/doc/html/draft-ietf-lake-reqs-04</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="IEEE802.15.4">[IEEE802.15.4]</dt>
        <dd>
<span class="refAuthor">IEEE standard for Information Technology</span>, <span class="refTitle">"IEEE Std 802.15.4 Standard for Low-Rate Wireless Networks"</span>, <span>n.d.</span>. </dd>
<dd class="break"></dd>
<dt id="IEEE802.1X">[IEEE802.1X]</dt>
        <dd>
<span class="refAuthor">IEEE standard for Information Technology</span>, <span class="refTitle">"IEEE Standard for Local and metropolitan area networks - Port-Based Network Access Control"</span>, <time datetime="2010-02" class="refDate">February 2010</time>. </dd>
<dd class="break"></dd>
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC3172">[RFC3172]</dt>
        <dd>
<span class="refAuthor">Huston, G., Ed.</span>, <span class="refTitle">"Management Guidelines &amp; Operational Requirements for the Address and Routing Parameter Area Domain ("arpa")"</span>, <span class="seriesInfo">BCP 52</span>, <span class="seriesInfo">RFC 3172</span>, <span class="seriesInfo">DOI 10.17487/RFC3172</span>, <time datetime="2001-09" class="refDate">September 2001</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc3172">https://www.rfc-editor.org/info/rfc3172</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5280">[RFC5280]</dt>
        <dd>
<span class="refAuthor">Cooper, D.</span>, <span class="refAuthor">Santesson, S.</span>, <span class="refAuthor">Farrell, S.</span>, <span class="refAuthor">Boeyen, S.</span>, <span class="refAuthor">Housley, R.</span>, and <span class="refAuthor">W. Polk</span>, <span class="refTitle">"Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile"</span>, <span class="seriesInfo">RFC 5280</span>, <span class="seriesInfo">DOI 10.17487/RFC5280</span>, <time datetime="2008-05" class="refDate">May 2008</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5280">https://www.rfc-editor.org/info/rfc5280</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6761">[RFC6761]</dt>
        <dd>
<span class="refAuthor">Cheshire, S.</span> and <span class="refAuthor">M. Krochmal</span>, <span class="refTitle">"Special-Use Domain Names"</span>, <span class="seriesInfo">RFC 6761</span>, <span class="seriesInfo">DOI 10.17487/RFC6761</span>, <time datetime="2013-02" class="refDate">February 2013</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6761">https://www.rfc-editor.org/info/rfc6761</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7228">[RFC7228]</dt>
        <dd>
<span class="refAuthor">Bormann, C.</span>, <span class="refAuthor">Ersue, M.</span>, and <span class="refAuthor">A. Keranen</span>, <span class="refTitle">"Terminology for Constrained-Node Networks"</span>, <span class="seriesInfo">RFC 7228</span>, <span class="seriesInfo">DOI 10.17487/RFC7228</span>, <time datetime="2014-05" class="refDate">May 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7228">https://www.rfc-editor.org/info/rfc7228</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7593">[RFC7593]</dt>
        <dd>
<span class="refAuthor">Wierenga, K.</span>, <span class="refAuthor">Winter, S.</span>, and <span class="refAuthor">T. Wolniewicz</span>, <span class="refTitle">"The eduroam Architecture for Network Roaming"</span>, <span class="seriesInfo">RFC 7593</span>, <span class="seriesInfo">DOI 10.17487/RFC7593</span>, <time datetime="2015-09" class="refDate">September 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7593">https://www.rfc-editor.org/info/rfc7593</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8137">[RFC8137]</dt>
        <dd>
<span class="refAuthor">Kivinen, T.</span> and <span class="refAuthor">P. Kinney</span>, <span class="refTitle">"IEEE 802.15.4 Information Element for the IETF"</span>, <span class="seriesInfo">RFC 8137</span>, <span class="seriesInfo">DOI 10.17487/RFC8137</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8137">https://www.rfc-editor.org/info/rfc8137</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
        <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8446">[RFC8446]</dt>
        <dd>
<span class="refAuthor">Rescorla, E.</span>, <span class="refTitle">"The Transport Layer Security (TLS) Protocol Version 1.3"</span>, <span class="seriesInfo">RFC 8446</span>, <span class="seriesInfo">DOI 10.17487/RFC8446</span>, <time datetime="2018-08" class="refDate">August 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8446">https://www.rfc-editor.org/info/rfc8446</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8610">[RFC8610]</dt>
        <dd>
<span class="refAuthor">Birkholz, H.</span>, <span class="refAuthor">Vigano, C.</span>, and <span class="refAuthor">C. Bormann</span>, <span class="refTitle">"Concise Data Definition Language (CDDL): A Notational Convention to Express Concise Binary Object Representation (CBOR) and JSON Data Structures"</span>, <span class="seriesInfo">RFC 8610</span>, <span class="seriesInfo">DOI 10.17487/RFC8610</span>, <time datetime="2019-06" class="refDate">June 2019</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8610">https://www.rfc-editor.org/info/rfc8610</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8615">[RFC8615]</dt>
        <dd>
<span class="refAuthor">Nottingham, M.</span>, <span class="refTitle">"Well-Known Uniform Resource Identifiers (URIs)"</span>, <span class="seriesInfo">RFC 8615</span>, <span class="seriesInfo">DOI 10.17487/RFC8615</span>, <time datetime="2019-05" class="refDate">May 2019</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8615">https://www.rfc-editor.org/info/rfc8615</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8995">[RFC8995]</dt>
        <dd>
<span class="refAuthor">Pritikin, M.</span>, <span class="refAuthor">Richardson, M.</span>, <span class="refAuthor">Eckert, T.</span>, <span class="refAuthor">Behringer, M.</span>, and <span class="refAuthor">K. Watsen</span>, <span class="refTitle">"Bootstrapping Remote Secure Key Infrastructure (BRSKI)"</span>, <span class="seriesInfo">RFC 8995</span>, <span class="seriesInfo">DOI 10.17487/RFC8995</span>, <time datetime="2021-05" class="refDate">May 2021</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8995">https://www.rfc-editor.org/info/rfc8995</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9031">[RFC9031]</dt>
      <dd>
<span class="refAuthor">Vučinić, M., Ed.</span>, <span class="refAuthor">Simon, J.</span>, <span class="refAuthor">Pister, K.</span>, and <span class="refAuthor">M. Richardson</span>, <span class="refTitle">"Constrained Join Protocol (CoJP) for 6TiSCH"</span>, <span class="seriesInfo">RFC 9031</span>, <span class="seriesInfo">DOI 10.17487/RFC9031</span>, <time datetime="2021-05" class="refDate">May 2021</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9031">https://www.rfc-editor.org/info/rfc9031</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
</section>
</div>
<div id="optimization-strat">
<section id="appendix-A">
      <h2 id="name-optimization-strategies">
<a href="#appendix-A" class="section-number selfRef">Appendix A. </a><a href="#name-optimization-strategies" class="section-name selfRef">Optimization Strategies</a>
      </h2>
<p id="appendix-A-1">When ELA is used for zero-touch enrollment of IoT devices, U may have little to no knowledge about V's available in its vicinity.
This may lead to situations where U retries several times at different V's until it finds one that works.
This section presents two optimization strategies for such cases.
They were developed to address scenarios where V's are radio gateways to which U wants to enroll, but may also be applicable to other use cases.<a href="#appendix-A-1" class="pilcrow">¶</a></p>
<div id="strat-anycast">
<section id="appendix-A.1">
        <h3 id="name-u-broadcasts-message_1">
<a href="#appendix-A.1" class="section-number selfRef">A.1. </a><a href="#name-u-broadcasts-message_1" class="section-name selfRef">U broadcasts message_1</a>
        </h3>
<p id="appendix-A.1-1">This strategy consists in U broadcasting EDHOC message_1.
When each of the V's in radio range of U receive message_1, one of the following can happen:<a href="#appendix-A.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A.1-2.1">
            <p id="appendix-A.1-2.1.1">V does not implement EDHOC, and drops the message<a href="#appendix-A.1-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.1-2.2">
            <p id="appendix-A.1-2.2.1">V does not implement ELA, and drops the message (even though the EAD_1 option is critical, broadcast messages should not have error replies)<a href="#appendix-A.1-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.1-2.3">
            <p id="appendix-A.1-2.3.1">V forwards message_1 to W as VREQ, but W does not authorize it, and error handling is applied<a href="#appendix-A.1-2.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.1-2.4">
            <p id="appendix-A.1-2.4.1">V forwards message_1 to W as VREQ, W authorizes it, and the protocol continues normally<a href="#appendix-A.1-2.4.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="appendix-A.1-3">U is expected to receive and process at most one message_2 as response, which contains the Voucher.
In case U receives additional message_2's, they MUST be silently dropped.<a href="#appendix-A.1-3" class="pilcrow">¶</a></p>
<p id="appendix-A.1-4">This strategy may increase the number of messages that need to be processed by V and W, in exchange for reducing resource usage in U.<a href="#appendix-A.1-4" class="pilcrow">¶</a></p>
<p id="appendix-A.1-5">Security concerns related to this strategy, including potential reuse of G_X and double processing of message_2, are discussed in <a href="#sec-cons" class="auto internal xref">Section 6</a>.<a href="#appendix-A.1-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="strat-advertise">
<section id="appendix-A.2">
        <h3 id="name-v-advertises-support-for-el">
<a href="#appendix-A.2" class="section-number selfRef">A.2. </a><a href="#name-v-advertises-support-for-el" class="section-name selfRef">V advertises support for ELA</a>
        </h3>
<p id="appendix-A.2-1">In this strategy, V shares some information (V_INFO) with a potential U, that can help it decide whether to try to enroll with that V.<a href="#appendix-A.2-1" class="pilcrow">¶</a></p>
<p id="appendix-A.2-2">The exact contents of the V_INFO structure, as well as the mechanism used to transport it, will depend on the underlying communication technology and also on application needs.
For example, V_INFO may state that:<a href="#appendix-A.2-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A.2-3.1">
            <p id="appendix-A.2-3.1.1">V implements ELA -- similarly to how EAPOL <span>[<a href="#IEEE802.1X" class="cite xref">IEEE802.1X</a>]</span> frames state support for IEEE 802.1X.<a href="#appendix-A.2-3.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.2-3.2">
            <p id="appendix-A.2-3.2.1">V is part of a certain domain -- similarly to how Eduroam <span>[<a href="#RFC7593" class="cite xref">RFC7593</a>]</span> is used in the SSID field of IEEE 802.11 packets<a href="#appendix-A.2-3.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="appendix-A.2-4">V_INFO can be sent over a network beacon (see <a href="#adv-beacon" class="auto internal xref">Appendix A.2.1</a>), which may require technology specific profiling, e.g., the IEEE 802.15.4 enhanced beacon may be extended according to <span>[<a href="#RFC8137" class="cite xref">RFC8137</a>]</span>.
Alternatively, V_INFO can be sent as part of an EAD field, as shown in <a href="#adv-ead1" class="auto internal xref">Appendix A.2.2</a>.<a href="#appendix-A.2-4" class="pilcrow">¶</a></p>
<p id="appendix-A.2-5">As a guideline for implementers, we define the following field that can be included in a V_INFO structure:<a href="#appendix-A.2-5" class="pilcrow">¶</a></p>
<div class="lang-cddl sourcecode" id="appendix-A.2-6">
<pre>
DOMAIN_ID: bstr
</pre><a href="#appendix-A.2-6" class="pilcrow">¶</a>
</div>
<p id="appendix-A.2-7">The DOMAIN_ID field identifies the domain to which V belongs to, for example an URL or UUID.<a href="#appendix-A.2-7" class="pilcrow">¶</a></p>
<p id="appendix-A.2-8">Below are three examples of how the advertisement strategy may be applied according to different application needs.
The examples include sending V_INFO in network beacons, as part of EAD_1 in reverse message flow, or as part of a periodic CoAP multicast packet.
The advantages, costs, and security impacts of each approach are also discussed.<a href="#appendix-A.2-8" class="pilcrow">¶</a></p>
<div id="adv-beacon">
<section id="appendix-A.2.1">
          <h4 id="name-v_info-in-network-beacons">
<a href="#appendix-A.2.1" class="section-number selfRef">A.2.1. </a><a href="#name-v_info-in-network-beacons" class="section-name selfRef">V_INFO in network beacons</a>
          </h4>
<p id="appendix-A.2.1-1">This approach allows carrying V_INFO in beacons sent over the network layer, as shown in <a href="#fig-adv-beacon" class="auto internal xref">Figure 8</a>.
It requires that the network layer offers a mechanism to configure its beacon packets.
Depending on the network type, a solicitation packet may also be needed, as is the case of non-beaconed IEEE 802.15.4 and BLE with GATT.<a href="#appendix-A.2.1-1" class="pilcrow">¶</a></p>
<span id="name-advertising-ela-using-v_inf"></span><div id="fig-adv-beacon">
<figure id="figure-8">
            <div id="appendix-A.2.1-2.1">
              <div class="alignCenter art-svg artwork" id="appendix-A.2.1-2.1.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="320" width="480" viewBox="0 0 480 320" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
                  <path d="M 8,32 L 8,96" fill="none" stroke="black"></path>
                  <path d="M 72,32 L 72,64" fill="none" stroke="black"></path>
                  <path d="M 72,104 L 72,272" fill="none" stroke="black"></path>
                  <path d="M 144,32 L 144,96" fill="none" stroke="black"></path>
                  <path d="M 336,32 L 336,96" fill="none" stroke="black"></path>
                  <path d="M 400,32 L 400,56" fill="none" stroke="black"></path>
                  <path d="M 400,104 L 400,272" fill="none" stroke="black"></path>
                  <path d="M 472,32 L 472,96" fill="none" stroke="black"></path>
                  <path d="M 8,32 L 144,32" fill="none" stroke="black"></path>
                  <path d="M 336,32 L 472,32" fill="none" stroke="black"></path>
                  <path d="M 8,64 L 144,64" fill="none" stroke="black"></path>
                  <path d="M 336,64 L 472,64" fill="none" stroke="black"></path>
                  <path d="M 8,96 L 144,96" fill="none" stroke="black"></path>
                  <path d="M 336,96 L 472,96" fill="none" stroke="black"></path>
                  <path d="M 376,128 L 392,128" fill="none" stroke="black"></path>
                  <path d="M 80,176 L 400,176" fill="none" stroke="black"></path>
                  <path d="M 72,240 L 392,240" fill="none" stroke="black"></path>
                  <polygon class="arrowhead" points="400,240 388,234.4 388,245.6" fill="black" transform="rotate(0,392,240)"></polygon>
                  <polygon class="arrowhead" points="400,128 388,122.4 388,133.6" fill="black" transform="rotate(0,392,128)"></polygon>
                  <polygon class="arrowhead" points="88,176 76,170.4 76,181.6" fill="black" transform="rotate(180,80,176)"></polygon>
                  <g class="text">
                    <text x="36" y="52">Init</text>
                    <text x="108" y="52">Client</text>
                    <text x="364" y="52">Resp</text>
                    <text x="436" y="52">Server</text>
                    <text x="72" y="84">U</text>
                    <text x="400" y="84">V</text>
                    <text x="88" y="132">-</text>
                    <text x="104" y="132">-</text>
                    <text x="120" y="132">-</text>
                    <text x="136" y="132">-</text>
                    <text x="152" y="132">-</text>
                    <text x="168" y="132">-</text>
                    <text x="184" y="132">-</text>
                    <text x="200" y="132">-</text>
                    <text x="216" y="132">-</text>
                    <text x="232" y="132">-</text>
                    <text x="248" y="132">-</text>
                    <text x="264" y="132">-</text>
                    <text x="280" y="132">-</text>
                    <text x="296" y="132">-</text>
                    <text x="312" y="132">-</text>
                    <text x="328" y="132">-</text>
                    <text x="344" y="132">-</text>
                    <text x="360" y="132">-</text>
                    <text x="148" y="148">Optional</text>
                    <text x="216" y="148">network</text>
                    <text x="300" y="148">solicitation</text>
                    <text x="128" y="196">Network</text>
                    <text x="200" y="196">discovery</text>
                    <text x="280" y="196">(contains</text>
                    <text x="352" y="196">V_INFO)</text>
                    <text x="192" y="228">EDHOC</text>
                    <text x="256" y="228">message_1</text>
                    <text x="168" y="260">(?EAD_1</text>
                    <text x="208" y="260">=</text>
                    <text x="272" y="260">Voucher_Info)</text>
                    <text x="80" y="308">(</text>
                    <text x="104" y="308">...</text>
                    <text x="156" y="308">protocol</text>
                    <text x="232" y="308">continues</text>
                    <text x="308" y="308">normally</text>
                    <text x="360" y="308">...</text>
                    <text x="384" y="308">)</text>
                  </g>
                </svg><a href="#appendix-A.2.1-2.1.1" class="pilcrow">¶</a>
</div>
</div>
<figcaption><a href="#figure-8" class="selfRef">Figure 8</a>:
<a href="#name-advertising-ela-using-v_inf" class="selfRef">Advertising ELA using V_INFO in network-layer beacons.</a>
            </figcaption></figure>
</div>
<p id="appendix-A.2.1-3">This strategy can be used, for example, in IEEE 802.15.4, where an Enhanced Beacon <span>[<a href="#IEEE802.15.4" class="cite xref">IEEE802.15.4</a>]</span> can be used to transmit V_INFO.
Specifically, a new information element for carrying V_INFO can be defined according to <span>[<a href="#RFC8137" class="cite xref">RFC8137</a>]</span>.<a href="#appendix-A.2.1-3" class="pilcrow">¶</a></p>
<p id="appendix-A.2.1-4">This approach has the advantage of requiring minimal changes to the default protocol as presented in <a href="#protocol-overview" class="auto internal xref">Section 4.1</a>, i.e., no reverse flow.
It requires, however, some profiling of the lower layer beacons.<a href="#appendix-A.2.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="adv-ead1">
<section id="appendix-A.2.2">
          <h4 id="name-v_info-in-ead_1">
<a href="#appendix-A.2.2" class="section-number selfRef">A.2.2. </a><a href="#name-v_info-in-ead_1" class="section-name selfRef">V_INFO in EAD_1</a>
          </h4>
<p id="appendix-A.2.2-1">The ELA reverse flow (see <a href="#reverse-u-responder" class="auto internal xref">Section 4.8</a>) allows implementing advertising where U first sends a trigger packet, in the format of a CoAP request that is broadcasted to the newtork.
When a suitable V receives the solicitation, if it implements ELA, it should respond with an EDHOC message_1 whose EAD_1 has label TBD1 and value V_INFO (see Section <a href="#optimization-strat" class="auto internal xref">Appendix A</a>).<a href="#appendix-A.2.2-1" class="pilcrow">¶</a></p>
<span id="name-advertising-ela-using-v_info"></span><div id="fig-adv-ead1">
<figure id="figure-9">
            <div id="appendix-A.2.2-2.1">
              <div class="alignCenter art-svg artwork" id="appendix-A.2.2-2.1.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="272" width="424" viewBox="0 0 424 272" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
                  <path d="M 8,32 L 8,96" fill="none" stroke="black"></path>
                  <path d="M 72,32 L 72,64" fill="none" stroke="black"></path>
                  <path d="M 72,104 L 72,224" fill="none" stroke="black"></path>
                  <path d="M 144,32 L 144,96" fill="none" stroke="black"></path>
                  <path d="M 280,32 L 280,96" fill="none" stroke="black"></path>
                  <path d="M 344,32 L 344,56" fill="none" stroke="black"></path>
                  <path d="M 344,104 L 344,224" fill="none" stroke="black"></path>
                  <path d="M 416,32 L 416,96" fill="none" stroke="black"></path>
                  <path d="M 8,32 L 144,32" fill="none" stroke="black"></path>
                  <path d="M 280,32 L 416,32" fill="none" stroke="black"></path>
                  <path d="M 8,64 L 144,64" fill="none" stroke="black"></path>
                  <path d="M 280,64 L 416,64" fill="none" stroke="black"></path>
                  <path d="M 8,96 L 144,96" fill="none" stroke="black"></path>
                  <path d="M 280,96 L 416,96" fill="none" stroke="black"></path>
                  <path d="M 72,128 L 336,128" fill="none" stroke="black"></path>
                  <path d="M 80,192 L 336,192" fill="none" stroke="black"></path>
                  <polygon class="arrowhead" points="344,128 332,122.4 332,133.6" fill="black" transform="rotate(0,336,128)"></polygon>
                  <polygon class="arrowhead" points="88,192 76,186.4 76,197.6" fill="black" transform="rotate(180,80,192)"></polygon>
                  <g class="text">
                    <text x="36" y="52">Resp</text>
                    <text x="108" y="52">Client</text>
                    <text x="308" y="52">Init</text>
                    <text x="380" y="52">Server</text>
                    <text x="72" y="84">U</text>
                    <text x="344" y="84">V</text>
                    <text x="116" y="148">CoAP</text>
                    <text x="228" y="148">discovery/solicitation</text>
                    <text x="160" y="180">EDHOC</text>
                    <text x="224" y="180">message_1</text>
                    <text x="160" y="212">(?EAD_1</text>
                    <text x="200" y="212">=</text>
                    <text x="240" y="212">V_INFO)</text>
                    <text x="48" y="260">(</text>
                    <text x="72" y="260">...</text>
                    <text x="120" y="260">reverse</text>
                    <text x="172" y="260">flow</text>
                    <text x="232" y="260">continues</text>
                    <text x="308" y="260">normally</text>
                    <text x="360" y="260">...</text>
                    <text x="384" y="260">)</text>
                  </g>
                </svg><a href="#appendix-A.2.2-2.1.1" class="pilcrow">¶</a>
</div>
</div>
<figcaption><a href="#figure-9" class="selfRef">Figure 9</a>:
<a href="#name-advertising-ela-using-v_info" class="selfRef">Advertising ELA using V_INFO in EAD_1, eploying the EDHOC reverse flow with U as responder.</a>
            </figcaption></figure>
</div>
<p id="appendix-A.2.2-3">Note that V will only reply if it supports ELA.
V_INFO can be structured to contain only an optional domain identifier:<a href="#appendix-A.2.2-3" class="pilcrow">¶</a></p>
<div class="lang-cddl sourcecode" id="appendix-A.2.2-4">
<pre>
V_INFO = (
  ?DOMAIN_ID: bstr,
)
</pre><a href="#appendix-A.2.2-4" class="pilcrow">¶</a>
</div>
<p id="appendix-A.2.2-5">This approach enables a simple filtering mechanism, where only V's that support ELA will reply.
It also encrypts Voucher_Info (as part of EAD_2), whereas it is sent in the clear in the original flow.
In addition, it may not require layer-two profiling (in case the network allows transporting data before authorization).
Finally, note that the reverse flow with U as Responder protects the identity of V (instead of U's as in the forward flow).<a href="#appendix-A.2.2-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="adv-coap-mult">
<section id="appendix-A.2.3">
          <h4 id="name-v_info-in-a-coap-multicast-">
<a href="#appendix-A.2.3" class="section-number selfRef">A.2.3. </a><a href="#name-v_info-in-a-coap-multicast-" class="section-name selfRef">V_INFO in a CoAP Multicast Packet</a>
          </h4>
<p id="appendix-A.2.3-1">In this approach, V periodically multicasts a CoAP packet containing V_INFO, see <a href="#fig-adv-coap-mult" class="auto internal xref">Figure 10</a>.
Upon receiving one or more CoAP messages and processing V_INFO, U can decide whether or not to initiate the ELA protocol with a given V.
Next, the application can either keep U acting as a server, and thus employ the EDHOC reverse flow, or implement a CoAP client and use the forward flow.<a href="#appendix-A.2.3-1" class="pilcrow">¶</a></p>
<span id="name-advertising-ela-using-the-n"></span><div id="fig-adv-coap-mult">
<figure id="figure-10">
            <div id="appendix-A.2.3-2.1">
              <div class="alignCenter art-svg artwork" id="appendix-A.2.3-2.1.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="288" width="512" viewBox="0 0 512 288" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
                  <path d="M 8,32 L 8,96" fill="none" stroke="black"></path>
                  <path d="M 80,32 L 80,64" fill="none" stroke="black"></path>
                  <path d="M 80,104 L 80,240" fill="none" stroke="black"></path>
                  <path d="M 160,32 L 160,96" fill="none" stroke="black"></path>
                  <path d="M 352,32 L 352,96" fill="none" stroke="black"></path>
                  <path d="M 424,32 L 424,56" fill="none" stroke="black"></path>
                  <path d="M 424,104 L 424,240" fill="none" stroke="black"></path>
                  <path d="M 504,32 L 504,96" fill="none" stroke="black"></path>
                  <path d="M 8,32 L 160,32" fill="none" stroke="black"></path>
                  <path d="M 352,32 L 504,32" fill="none" stroke="black"></path>
                  <path d="M 8,64 L 160,64" fill="none" stroke="black"></path>
                  <path d="M 352,64 L 504,64" fill="none" stroke="black"></path>
                  <path d="M 8,96 L 160,96" fill="none" stroke="black"></path>
                  <path d="M 352,96 L 504,96" fill="none" stroke="black"></path>
                  <path d="M 88,144 L 424,144" fill="none" stroke="black"></path>
                  <path d="M 80,208 L 416,208" fill="none" stroke="black"></path>
                  <polygon class="arrowhead" points="424,208 412,202.4 412,213.6" fill="black" transform="rotate(0,416,208)"></polygon>
                  <polygon class="arrowhead" points="96,144 84,138.4 84,149.6" fill="black" transform="rotate(180,88,144)"></polygon>
                  <g class="text">
                    <text x="44" y="52">Init</text>
                    <text x="120" y="52">Cli/Ser</text>
                    <text x="388" y="52">Resp</text>
                    <text x="464" y="52">Cli/Ser</text>
                    <text x="80" y="84">U</text>
                    <text x="424" y="84">V</text>
                    <text x="180" y="132">POST</text>
                    <text x="276" y="132">/ela-advertisement</text>
                    <text x="140" y="164">CoAP</text>
                    <text x="200" y="164">multicast</text>
                    <text x="280" y="164">(contains</text>
                    <text x="352" y="164">V_INFO)</text>
                    <text x="216" y="196">EDHOC</text>
                    <text x="280" y="196">message_1</text>
                    <text x="192" y="228">(?EAD_1</text>
                    <text x="232" y="228">=</text>
                    <text x="296" y="228">Voucher_Info)</text>
                    <text x="88" y="276">(</text>
                    <text x="112" y="276">...</text>
                    <text x="164" y="276">protocol</text>
                    <text x="240" y="276">continues</text>
                    <text x="316" y="276">normally</text>
                    <text x="368" y="276">...</text>
                    <text x="392" y="276">)</text>
                  </g>
                </svg><a href="#appendix-A.2.3-2.1.1" class="pilcrow">¶</a>
</div>
</div>
<figcaption><a href="#figure-10" class="selfRef">Figure 10</a>:
<a href="#name-advertising-ela-using-the-n" class="selfRef">Advertising ELA using the network layer.</a>
            </figcaption></figure>
</div>
<p id="appendix-A.2.3-3">The V_INFO structure is sent as part of the CoAP payload.
It is encoded as a CBOR sequence:<a href="#appendix-A.2.3-3" class="pilcrow">¶</a></p>
<div class="lang-cddl sourcecode" id="appendix-A.2.3-4">
<pre>
V_INFO = (
  ?DOMAIN_ID: bstr,
)
</pre><a href="#appendix-A.2.3-4" class="pilcrow">¶</a>
</div>
<p id="appendix-A.2.3-5">One advantage of this approach is that, since U is the initiator, its identity is protected in the context of the EDHOC handshake.
On the other hand, the periodic multicast may have resource usage impacts in the network.<a href="#appendix-A.2.3-5" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="use-with-constrained-join-protocol-cojp">
<section id="appendix-B">
      <h2 id="name-use-with-constrained-join-p">
<a href="#appendix-B" class="section-number selfRef">Appendix B. </a><a href="#name-use-with-constrained-join-p" class="section-name selfRef">Use with Constrained Join Protocol (CoJP)</a>
      </h2>
<p id="appendix-B-1">This section outlines how ELA is used for network enrollment and parameter provisioning.
An IEEE 802.15.4 network is used as an example of how a new device (U) can be enrolled into the domain managed by the domain authenticator (V).<a href="#appendix-B-1" class="pilcrow">¶</a></p>
<span id="name-use-of-draft-ietf-lake-auth"></span><div id="fig-cojp">
<figure id="figure-11">
        <div id="appendix-B-2.1">
          <div class="alignCenter art-svg artwork" id="appendix-B-2.1.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="416" width="560" viewBox="0 0 560 416" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
              <path d="M 8,48 L 8,400" fill="none" stroke="black"></path>
              <path d="M 304,48 L 304,384" fill="none" stroke="black"></path>
              <path d="M 552,48 L 552,384" fill="none" stroke="black"></path>
              <path d="M 280,80 L 296,80" fill="none" stroke="black"></path>
              <path d="M 16,112 L 304,112" fill="none" stroke="black"></path>
              <path d="M 8,160 L 296,160" fill="none" stroke="black"></path>
              <path d="M 304,192 L 544,192" fill="none" stroke="black"></path>
              <path d="M 312,224 L 552,224" fill="none" stroke="black"></path>
              <path d="M 16,256 L 304,256" fill="none" stroke="black"></path>
              <path d="M 8,320 L 296,320" fill="none" stroke="black"></path>
              <path d="M 16,368 L 296,368" fill="none" stroke="black"></path>
              <polygon class="arrowhead" points="552,192 540,186.4 540,197.6" fill="black" transform="rotate(0,544,192)"></polygon>
              <polygon class="arrowhead" points="320,224 308,218.4 308,229.6" fill="black" transform="rotate(180,312,224)"></polygon>
              <polygon class="arrowhead" points="304,320 292,314.4 292,325.6" fill="black" transform="rotate(0,296,320)"></polygon>
              <polygon class="arrowhead" points="304,160 292,154.4 292,165.6" fill="black" transform="rotate(0,296,160)"></polygon>
              <polygon class="arrowhead" points="304,80 292,74.4 292,85.6" fill="black" transform="rotate(0,296,80)"></polygon>
              <polygon class="arrowhead" points="24,368 12,362.4 12,373.6" fill="black" transform="rotate(180,16,368)"></polygon>
              <polygon class="arrowhead" points="24,256 12,250.4 12,261.6" fill="black" transform="rotate(180,16,256)"></polygon>
              <polygon class="arrowhead" points="24,112 12,106.4 12,117.6" fill="black" transform="rotate(180,16,112)"></polygon>
              <g class="text">
                <text x="8" y="36">U</text>
                <text x="304" y="36">V</text>
                <text x="552" y="36">W</text>
                <text x="24" y="84">-</text>
                <text x="40" y="84">-</text>
                <text x="56" y="84">-</text>
                <text x="72" y="84">-</text>
                <text x="88" y="84">-</text>
                <text x="104" y="84">-</text>
                <text x="120" y="84">-</text>
                <text x="136" y="84">-</text>
                <text x="152" y="84">-</text>
                <text x="168" y="84">-</text>
                <text x="184" y="84">-</text>
                <text x="200" y="84">-</text>
                <text x="216" y="84">-</text>
                <text x="232" y="84">-</text>
                <text x="248" y="84">-</text>
                <text x="264" y="84">-</text>
                <text x="76" y="100">Optional</text>
                <text x="144" y="100">network</text>
                <text x="228" y="100">solicitation</text>
                <text x="120" y="132">Network</text>
                <text x="192" y="132">discovery</text>
                <text x="112" y="180">EDHOC</text>
                <text x="176" y="180">message_1</text>
                <text x="368" y="212">Voucher</text>
                <text x="432" y="212">Request</text>
                <text x="492" y="212">(VREQ)</text>
                <text x="368" y="244">Voucher</text>
                <text x="436" y="244">Response</text>
                <text x="500" y="244">(VRES)</text>
                <text x="112" y="276">EDHOC</text>
                <text x="176" y="276">message_2</text>
                <text x="56" y="340">EDHOC</text>
                <text x="120" y="340">message_3</text>
                <text x="168" y="340">+</text>
                <text x="196" y="340">CoJP</text>
                <text x="248" y="340">request</text>
                <text x="124" y="388">CoJP</text>
                <text x="180" y="388">response</text>
              </g>
            </svg><a href="#appendix-B-2.1.1" class="pilcrow">¶</a>
</div>
</div>
<figcaption><a href="#figure-11" class="selfRef">Figure 11</a>:
<a href="#name-use-of-draft-ietf-lake-auth" class="selfRef">Use of draft-ietf-lake-authz with CoJP.</a>
        </figcaption></figure>
</div>
<div id="network-discovery">
<section id="appendix-B.1">
        <h3 id="name-network-discovery">
<a href="#appendix-B.1" class="section-number selfRef">B.1. </a><a href="#name-network-discovery" class="section-name selfRef">Network Discovery</a>
        </h3>
<p id="appendix-B.1-1">When a device first boots, it needs to discover the network it attempts to join.
The network discovery procedure is defined by the link-layer technology in use.
In case of Time-slotted Channel Hopping (TSCH) networks, a mode of <span>[<a href="#IEEE802.15.4" class="cite xref">IEEE802.15.4</a>]</span>, the device scans the radio channels for Enhanced Beacon (EB) frames, a procedure known as passive scan.
EBs carry the information about the network, and particularly the network identifier.
Based on the EB, the network identifier, the information pre-configured into the device, the device makes the decision on whether it should join the network advertised by the received EB frame.
This process is described in <span><a href="https://rfc-editor.org/rfc/rfc9031#section-4.1" class="relref">Section 4.1</a> of [<a href="#RFC9031" class="cite xref">RFC9031</a>]</span>.
In case of other, non-TSCH modes of IEEE 802.15.4, it is possible to use the active scan procedure and send solicitation frames.
These solicitation frames trigger the nearest network coordinator to respond by emitting a beacon frame.
The network coordinator emitting beacons may be multiple link-layer hops away from the domain authenticator (V), in which case it plays the role of a Join Proxy (see <span>[<a href="#RFC9031" class="cite xref">RFC9031</a>]</span>).
The Join Proxy does not participate in the protocol and acts as a transparent router between the device and the domain authenticator.
For simplicity, <a href="#fig-cojp" class="auto internal xref">Figure 11</a> illustrates the case when the device and the domain authenticator are a single hop away and can communicate directly.<a href="#appendix-B.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="the-enrollment-protocol-with-parameter-provisioning">
<section id="appendix-B.2">
        <h3 id="name-the-enrollment-protocol-wit">
<a href="#appendix-B.2" class="section-number selfRef">B.2. </a><a href="#name-the-enrollment-protocol-wit" class="section-name selfRef">The Enrollment Protocol with Parameter Provisioning</a>
        </h3>
<div id="flight-1">
<section id="appendix-B.2.1">
          <h4 id="name-flight-1">
<a href="#appendix-B.2.1" class="section-number selfRef">B.2.1. </a><a href="#name-flight-1" class="section-name selfRef">Flight 1</a>
          </h4>
<p id="appendix-B.2.1-1">Once the device has discovered the network it wants to join, it constructs EDHOC message_1, as described in <a href="#U-V" class="auto internal xref">Section 4.5</a>.
The device SHALL map the message to a CoAP request:<a href="#appendix-B.2.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-B.2.1-2.1">
              <p id="appendix-B.2.1-2.1.1">The request method is POST.<a href="#appendix-B.2.1-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="appendix-B.2.1-2.2">
              <p id="appendix-B.2.1-2.2.1">The type is Confirmable (CON).<a href="#appendix-B.2.1-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="appendix-B.2.1-2.3">
              <p id="appendix-B.2.1-2.3.1">The Proxy-Scheme option is set to "coap".<a href="#appendix-B.2.1-2.3.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="appendix-B.2.1-2.4">
              <p id="appendix-B.2.1-2.4.1">The Uri-Host option is set to "lake-authz.arpa". This is an anycast type of identifier of the domain authenticator (V) that is resolved to its IPv6 address by the Join Proxy.<a href="#appendix-B.2.1-2.4.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="appendix-B.2.1-2.5">
              <p id="appendix-B.2.1-2.5.1">By means of Uri-Path options, the Uri-Path is set to ".well-known/edhoc".<a href="#appendix-B.2.1-2.5.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="appendix-B.2.1-2.6">
              <p id="appendix-B.2.1-2.6.1">The payload is the (true, EDHOC message_1) CBOR sequence, where EDHOC message_1 is constructed as defined in <a href="#U-V" class="auto internal xref">Section 4.5</a>.<a href="#appendix-B.2.1-2.6.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</section>
</div>
<div id="flight-2">
<section id="appendix-B.2.2">
          <h4 id="name-flight-2">
<a href="#appendix-B.2.2" class="section-number selfRef">B.2.2. </a><a href="#name-flight-2" class="section-name selfRef">Flight 2</a>
          </h4>
<p id="appendix-B.2.2-1">The domain authenticator receives message_1 and processes it as described in <a href="#U-V" class="auto internal xref">Section 4.5</a>.
The message triggers the exchange with the enrollment server, as described in <a href="#V-W" class="auto internal xref">Section 4.6</a>.
If the exchange between V and W completes successfully, the domain authenticator prepares EDHOC message_2, as described in <a href="#U-V" class="auto internal xref">Section 4.5</a>.
The authenticator SHALL map the message to a CoAP response:<a href="#appendix-B.2.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-B.2.2-2.1">
              <p id="appendix-B.2.2-2.1.1">The response code is 2.04 Changed.<a href="#appendix-B.2.2-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="appendix-B.2.2-2.2">
              <p id="appendix-B.2.2-2.2.1">The payload is the EDHOC message_2, as defined in <a href="#U-V" class="auto internal xref">Section 4.5</a>.<a href="#appendix-B.2.2-2.2.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</section>
</div>
<div id="flight-3">
<section id="appendix-B.2.3">
          <h4 id="name-flight-3">
<a href="#appendix-B.2.3" class="section-number selfRef">B.2.3. </a><a href="#name-flight-3" class="section-name selfRef">Flight 3</a>
          </h4>
<p id="appendix-B.2.3-1">The device receives EDHOC message_2 and processes it as described in <a href="#U-V" class="auto internal xref">Section 4.5</a>.
Upon successful processing of message_2, the device prepares flight 3, which is an OSCORE-protected CoJP request containing an EDHOC message_3, as described in <span>[<a href="#I-D.ietf-core-oscore-edhoc" class="cite xref">I-D.ietf-core-oscore-edhoc</a>]</span>.
EDHOC message_3 is prepared as described in <a href="#U-V" class="auto internal xref">Section 4.5</a>.
The OSCORE-protected payload is the CoJP Join Request object specified in <span><a href="https://rfc-editor.org/rfc/rfc9031#section-8.4.1" class="relref">Section 8.4.1</a> of [<a href="#RFC9031" class="cite xref">RFC9031</a>]</span>.
OSCORE protection leverages the OSCORE Security Context derived from the EDHOC session, as specified in Appendix A of <span>[<a href="#RFC9528" class="cite xref">RFC9528</a>]</span>.
To that end, <span>[<a href="#I-D.ietf-core-oscore-edhoc" class="cite xref">I-D.ietf-core-oscore-edhoc</a>]</span> specifies that the Sender ID of the client (device) must be set to the connection identifier selected by the domain authenticator, C_R.
OSCORE includes the Sender ID as the kid in the OSCORE option.
The network identifier in the CoJP Join Request object is set to the network identifier obtained from the network discovery phase.
In case of IEEE 802.15.4 networks, this is the PAN ID.<a href="#appendix-B.2.3-1" class="pilcrow">¶</a></p>
<p id="appendix-B.2.3-2">The device SHALL map the message to a CoAP request:<a href="#appendix-B.2.3-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-B.2.3-3.1">
              <p id="appendix-B.2.3-3.1.1">The request method is POST.<a href="#appendix-B.2.3-3.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="appendix-B.2.3-3.2">
              <p id="appendix-B.2.3-3.2.1">The type is Confirmable (CON).<a href="#appendix-B.2.3-3.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="appendix-B.2.3-3.3">
              <p id="appendix-B.2.3-3.3.1">The Proxy-Scheme option is set to "coap".<a href="#appendix-B.2.3-3.3.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="appendix-B.2.3-3.4">
              <p id="appendix-B.2.3-3.4.1">The Uri-Host option is set to "lake-authz.arpa".<a href="#appendix-B.2.3-3.4.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="appendix-B.2.3-3.5">
              <p id="appendix-B.2.3-3.5.1">The Uri-Path option is set to ".well-known/edhoc".<a href="#appendix-B.2.3-3.5.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="appendix-B.2.3-3.6">
              <p id="appendix-B.2.3-3.6.1">The EDHOC option <span>[<a href="#I-D.ietf-core-oscore-edhoc" class="cite xref">I-D.ietf-core-oscore-edhoc</a>]</span> is set and is empty.<a href="#appendix-B.2.3-3.6.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="appendix-B.2.3-3.7">
              <p id="appendix-B.2.3-3.7.1">The payload is prepared as described in <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-core-oscore-edhoc-11#section-3.2" class="relref">Section 3.2</a> of [<a href="#I-D.ietf-core-oscore-edhoc" class="cite xref">I-D.ietf-core-oscore-edhoc</a>]</span>, with EDHOC message_3 and the CoJP Join Request object as the OSCORE-protected payload.<a href="#appendix-B.2.3-3.7.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="appendix-B.2.3-4">Note that the OSCORE Sender IDs are derived from the connection identifiers of the EDHOC session.
This is in contrast with <span>[<a href="#RFC9031" class="cite xref">RFC9031</a>]</span> where ID Context of the OSCORE Security Context is set to the device identifier (pledge identifier).
Since the device identity is exchanged during the EDHOC session, and the certificate of the device is communicated to the authenticator as part of the Voucher Response message, there is no need to transport the device identity in OSCORE messages.
The authenticator playing the role of the <span>[<a href="#RFC9031" class="cite xref">RFC9031</a>]</span> JRC obtains the device identity from the execution of the authorization protocol.<a href="#appendix-B.2.3-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="flight-4">
<section id="appendix-B.2.4">
          <h4 id="name-flight-4">
<a href="#appendix-B.2.4" class="section-number selfRef">B.2.4. </a><a href="#name-flight-4" class="section-name selfRef">Flight 4</a>
          </h4>
<p id="appendix-B.2.4-1">Flight 4 is the OSCORE response carrying CoJP response message.
The message is processed as specified in <span><a href="https://rfc-editor.org/rfc/rfc9031#section-8.4.2" class="relref">Section 8.4.2</a> of [<a href="#RFC9031" class="cite xref">RFC9031</a>]</span>.<a href="#appendix-B.2.4-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="example-of-opaquestate">
<section id="appendix-C">
      <h2 id="name-example-of-opaque_state">
<a href="#appendix-C" class="section-number selfRef">Appendix C. </a><a href="#name-example-of-opaque_state" class="section-name selfRef">Example of opaque_state</a>
      </h2>
<p id="appendix-C-1">As per <a href="#stateless-v" class="auto internal xref">Section 4.3</a>, V may act statelessly and transmit a opaque_state to W during the VREQ call.
The example below contains an IPv4 address, a port number, and a timestamp, serialized as CBOR:<a href="#appendix-C-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="appendix-C-2">
<pre>
83             # array(3)
   84          # array(4)
      18 C0    # unsigned(192)
      18 A8    # unsigned(168)
      00       # unsigned(0)
      05       # unsigned(5)
   19 5A18     # unsigned(23064)
   1A 6867EEE4 # unsigned(1751641828)
</pre><a href="#appendix-C-2" class="pilcrow">¶</a>
</div>
<p id="appendix-C-3">The above plaintext state can be encrypted using COSE.
Speficially, it is useful that the plaintext is not only encrypted but also authenticated.
That can be achieved using COSE_Encrypt0 using an AEAD algorithm.<a href="#appendix-C-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="examples-of-protocol-execution">
<section id="appendix-D">
      <h2 id="name-examples-of-protocol-execut">
<a href="#appendix-D" class="section-number selfRef">Appendix D. </a><a href="#name-examples-of-protocol-execut" class="section-name selfRef">Examples of protocol execution</a>
      </h2>
<p id="appendix-D-1">This section presents high level examples of the protocol execution.<a href="#appendix-D-1" class="pilcrow">¶</a></p>
<p id="appendix-D-2">Note: the examples below include samples of access policies used by W. These are provided for the sake of completeness only, since the authorization mechanism used by W is out of scope in this document.<a href="#appendix-D-2" class="pilcrow">¶</a></p>
<div id="example_minimal">
<section id="appendix-D.1">
        <h3 id="name-minimal">
<a href="#appendix-D.1" class="section-number selfRef">D.1. </a><a href="#name-minimal" class="section-name selfRef">Minimal</a>
        </h3>
<p id="appendix-D.1-1">This is a simple example that demonstrates a successful execution of ELA.<a href="#appendix-D.1-1" class="pilcrow">¶</a></p>
<p id="appendix-D.1-2">Premises:<a href="#appendix-D.1-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-D.1-3.1">
            <p id="appendix-D.1-3.1.1">device u1 has ID_U = key id = 14<a href="#appendix-D.1-3.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.1-3.2">
            <p id="appendix-D.1-3.2.1">the access policy in W specifies, via a list of ID_U, that device u1 can enroll via any domain authenticator, i.e., the list contains ID_U = 14.
In this case, the policy only specifies a restriction in terms of U, effectively allowing enrollment via any V.<a href="#appendix-D.1-3.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="appendix-D.1-4">Execution:<a href="#appendix-D.1-4" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="appendix-D.1-5">
<li id="appendix-D.1-5.1">
            <p id="appendix-D.1-5.1.1">device u1 discovers a gateway (v1) and tries to enroll<a href="#appendix-D.1-5.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="appendix-D.1-5.2">
            <p id="appendix-D.1-5.2.1">gateway v1 identifies the zero-touch join attempt by checking that the label of EAD_1 = TBD1, and prepares a Voucher Request using the information contained in the value of EAD_1<a href="#appendix-D.1-5.2.1" class="pilcrow">¶</a></p>
</li>
          <li id="appendix-D.1-5.3">
            <p id="appendix-D.1-5.3.1">upon receiving the request, W obtains ID_U = 14, authorizes the access, and replies with Voucher Response<a href="#appendix-D.1-5.3.1" class="pilcrow">¶</a></p>
</li>
        </ol>
</section>
</div>
<div id="example_wrong_gateway">
<section id="appendix-D.2">
        <h3 id="name-wrong-gateway">
<a href="#appendix-D.2" class="section-number selfRef">D.2. </a><a href="#name-wrong-gateway" class="section-name selfRef">Wrong gateway</a>
        </h3>
<p id="appendix-D.2-1">In this example, a device u1 tries to enroll a domain via gateway v1, but W denies the request because the pairing (u1, v1) is not configured in its access policies.<a href="#appendix-D.2-1" class="pilcrow">¶</a></p>
<p id="appendix-D.2-2">This example also illustrates how the REJECT_INFO field of the EDHOC error Access Denied could be used, in this case to suggest that the device should select another gateway for the join procedure.<a href="#appendix-D.2-2" class="pilcrow">¶</a></p>
<p id="appendix-D.2-3">Premises:<a href="#appendix-D.2-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-D.2-4.1">
            <p id="appendix-D.2-4.1.1">devices and gateways communicate via Bluetooth Low Energy (BLE), therefore their network identifiers are MAC addresses (EUI-48)<a href="#appendix-D.2-4.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.2-4.2">
            <p id="appendix-D.2-4.2.1">device u1 has ID_U = key id = 14<a href="#appendix-D.2-4.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.2-4.3">
            <p id="appendix-D.2-4.3.1">there are 3 gateways in the radio range of u1:<a href="#appendix-D.2-4.3.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-D.2-4.3.2.1">
                <p id="appendix-D.2-4.3.2.1.1">v1 with MAC address = A2-A1-88-EE-97-75<a href="#appendix-D.2-4.3.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="appendix-D.2-4.3.2.2">
                <p id="appendix-D.2-4.3.2.2.1">v2 with MAC address = 28-0F-70-84-51-E4<a href="#appendix-D.2-4.3.2.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="appendix-D.2-4.3.2.3">
                <p id="appendix-D.2-4.3.2.3.1">v3 with MAC address = 39-63-C9-D0-5C-62<a href="#appendix-D.2-4.3.2.3.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="normal" id="appendix-D.2-4.4">
            <p id="appendix-D.2-4.4.1">the access policy in W specifies, via a mapping of shape (ID_U; MAC1, MAC2, ...) that device u1 can only join via gateway v3, i.e., the mapping is: (14; 39-63-C9-D0-5C-62)<a href="#appendix-D.2-4.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.2-4.5">
            <p id="appendix-D.2-4.5.1">W is able to map the PoP key of the gateways to their respective MAC addresses<a href="#appendix-D.2-4.5.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="appendix-D.2-5">Execution:<a href="#appendix-D.2-5" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="appendix-D.2-6">
<li id="appendix-D.2-6.1">
            <p id="appendix-D.2-6.1.1">device u1 tries to join via gateway v1, which forwards the request to W<a href="#appendix-D.2-6.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="appendix-D.2-6.2">
            <p id="appendix-D.2-6.2.1">W determines that MAC address A2-A1-88-EE-97-75 is not in the access policy mapping, and replies with an error. The error_content has REJECT_TYPE = 1, and the plaintext OPAQUE_INFO (used to compute the encrypted REJECT_INFO) specifies a list of suggested gateways = [h'3963C9D05C62']. The single element in the list is the 6-byte MAC address of v3, serialized as a bstr.<a href="#appendix-D.2-6.2.1" class="pilcrow">¶</a></p>
</li>
          <li id="appendix-D.2-6.3">
            <p id="appendix-D.2-6.3.1">gateway v1 assembles an EDHOC error "Access Denied" with error_content, and sends it to u1<a href="#appendix-D.2-6.3.1" class="pilcrow">¶</a></p>
</li>
          <li id="appendix-D.2-6.4">
            <p id="appendix-D.2-6.4.1">device u1 processes the error, decrypts REJECT_INFO, and retries the protocol via gateway v3<a href="#appendix-D.2-6.4.1" class="pilcrow">¶</a></p>
</li>
        </ol>
</section>
</div>
</section>
</div>
<div id="acknowledgments">
<section id="appendix-E">
      <h2 id="name-acknowledgments">
<a href="#name-acknowledgments" class="section-name selfRef">Acknowledgments</a>
      </h2>
<p id="appendix-E-1">The authors sincerely thank <span class="contact-name">Aurelio Schellenbaum</span> for his contribution in the initial phase of this work, and Marco Tiloca for extensively reviewing the document.
We also thank Christian Amsüss for his active participation in discussions that led to improvements in the document.<a href="#appendix-E-1" class="pilcrow">¶</a></p>
<p id="appendix-E-2">Work on this document has in part been supported by the Horizon Europe Framework Programme project OpenSwarm (grant agreement No. 101093046).<a href="#appendix-E-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-F">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Göran Selander</span></div>
<div dir="auto" class="left"><span class="org">Ericsson AB</span></div>
<div dir="auto" class="left"><span class="country-name">Sweden</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:goran.selander@ericsson.com" class="email">goran.selander@ericsson.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">John Preuß Mattsson</span></div>
<div dir="auto" class="left"><span class="org">Ericsson AB</span></div>
<div dir="auto" class="left"><span class="country-name">Sweden</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:john.mattsson@ericsson.com" class="email">john.mattsson@ericsson.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Mališa Vučinić</span></div>
<div dir="auto" class="left"><span class="org">INRIA</span></div>
<div dir="auto" class="left"><span class="country-name">France</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:malisa.vucinic@inria.fr" class="email">malisa.vucinic@inria.fr</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Geovane Fedrecheski</span></div>
<div dir="auto" class="left"><span class="org">INRIA</span></div>
<div dir="auto" class="left"><span class="country-name">France</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:geovane.fedrecheski@inria.fr" class="email">geovane.fedrecheski@inria.fr</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Michael Richardson</span></div>
<div dir="auto" class="left"><span class="org">Sandelman Software Works</span></div>
<div dir="auto" class="left"><span class="country-name">Canada</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:mcr+ietf@sandelman.ca" class="email">mcr+ietf@sandelman.ca</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
